var vh=Object.defineProperty;var Rh=(s,e,t)=>e in s?vh(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var Oo=(s,e,t)=>Rh(s,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();const Li={PROPERTYCHANGE:"propertychange"},W={CHANGE:"change",ERROR:"error",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",TOUCHMOVE:"touchmove",WHEEL:"wheel"};class _s{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function Sh(s,e,t){let i,n;t=t||_t;let r=0,o=s.length,a=!1;for(;r<o;)i=r+(o-r>>1),n=+t(s[i],e),n<0?r=i+1:(o=i,a=!n);return a?r:~r}function _t(s,e){return s>e?1:s<e?-1:0}function Th(s,e){return s<e?1:s>e?-1:0}function Mr(s,e,t){if(s[0]<=e)return 0;const i=s.length;if(e<=s[i-1])return i-1;if(typeof t=="function"){for(let n=1;n<i;++n){const r=s[n];if(r===e)return n;if(r<e)return t(e,s[n-1],r)>0?n-1:n}return i-1}if(t>0){for(let n=1;n<i;++n)if(s[n]<e)return n-1;return i-1}if(t<0){for(let n=1;n<i;++n)if(s[n]<=e)return n;return i-1}for(let n=1;n<i;++n){if(s[n]==e)return n;if(s[n]<e)return s[n-1]-e<e-s[n]?n-1:n}return i-1}function Ih(s,e,t){for(;e<t;){const i=s[e];s[e]=s[t],s[t]=i,++e,--t}}function Ze(s,e){const t=Array.isArray(e)?e:[e],i=t.length;for(let n=0;n<i;n++)s[s.length]=t[n]}function Wt(s,e){const t=s.length;if(t!==e.length)return!1;for(let i=0;i<t;i++)if(s[i]!==e[i])return!1;return!0}function bh(s,e,t){const i=e||_t;return s.every(function(n,r){if(r===0)return!0;const o=i(s[r-1],n);return!(o>0||o===0)})}function ti(){return!0}function wn(){return!1}function Pi(){}function Ya(s){let e,t,i;return function(){const n=Array.prototype.slice.call(arguments);return(!t||this!==i||!Wt(n,t))&&(i=this,t=n,e=s.apply(this,arguments)),e}}function Ah(s){function e(){let t;try{t=s()}catch(i){return Promise.reject(i)}return t instanceof Promise?t:Promise.resolve(t)}return e()}function zi(s){for(const e in s)delete s[e]}function ii(s){let e;for(e in s)return!1;return!e}class rt{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}class ps extends _s{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const i=this.listeners_||(this.listeners_={}),n=i[e]||(i[e]=[]);n.includes(t)||n.push(t)}dispatchEvent(e){const t=typeof e=="string",i=t?e:e.type,n=this.listeners_&&this.listeners_[i];if(!n)return;const r=t?new rt(e):e;r.target||(r.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});i in o||(o[i]=0,a[i]=0),++o[i];let l;for(let h=0,c=n.length;h<c;++h)if("handleEvent"in n[h]?l=n[h].handleEvent(r):l=n[h].call(this,r),l===!1||r.propagationStopped){l=!1;break}if(--o[i]===0){let h=a[i];for(delete a[i];h--;)this.removeEventListener(i,Pi);delete o[i]}return l}disposeInternal(){this.listeners_&&zi(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return this.listeners_?e?e in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(e,t){if(!this.listeners_)return;const i=this.listeners_[e];if(!i)return;const n=i.indexOf(t);n!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(i[n]=Pi,++this.pendingRemovals_[e]):(i.splice(n,1),i.length===0&&delete this.listeners_[e]))}}function K(s,e,t,i,n){if(n){const o=t;t=function(a){return s.removeEventListener(e,t),o.call(i??this,a)}}else i&&i!==s&&(t=t.bind(i));const r={target:s,type:e,listener:t};return s.addEventListener(e,t),r}function Qn(s,e,t,i){return K(s,e,t,i,!0)}function ee(s){s&&s.target&&(s.target.removeEventListener(s.type,s.listener),zi(s))}class En extends ps{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(W.CHANGE)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){const i=e.length,n=new Array(i);for(let r=0;r<i;++r)n[r]=K(this,e[r],t);return n}return K(this,e,t)}onceInternal(e,t){let i;if(Array.isArray(e)){const n=e.length;i=new Array(n);for(let r=0;r<n;++r)i[r]=Qn(this,e[r],t)}else i=Qn(this,e,t);return t.ol_key=i,i}unInternal(e,t){const i=t.ol_key;if(i)Mh(i);else if(Array.isArray(e))for(let n=0,r=e.length;n<r;++n)this.removeEventListener(e[n],t);else this.removeEventListener(e,t)}}En.prototype.on;En.prototype.once;En.prototype.un;function Mh(s){if(Array.isArray(s))for(let e=0,t=s.length;e<t;++e)ee(s[e]);else ee(s)}function N(){throw new Error("Unimplemented abstract method.")}let Lh=0;function U(s){return s.ol_uid||(s.ol_uid=String(++Lh))}class Do extends rt{constructor(e,t,i){super(e),this.key=t,this.oldValue=i}}class Je extends En{constructor(e){super(),this.on,this.once,this.un,U(this),this.values_=null,e!==void 0&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(e,t){let i;i=`change:${e}`,this.hasListener(i)&&this.dispatchEvent(new Do(i,e,t)),i=Li.PROPERTYCHANGE,this.hasListener(i)&&this.dispatchEvent(new Do(i,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,i){const n=this.values_||(this.values_={});if(i)n[e]=t;else{const r=n[e];n[e]=t,r!==t&&this.notify(e,r)}}setProperties(e,t){for(const i in e)this.set(i,e[i],t)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const i=this.values_[e];delete this.values_[e],ii(this.values_)&&(this.values_=null),t||this.notify(e,i)}}}function q(s,e){if(!s)throw new Error(e)}class ni extends Je{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if(typeof e.getSimplifiedGeometry=="function"){const t=e;this.setGeometry(t)}else{const t=e;this.setProperties(t)}}clone(){const e=new ni(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const i=this.getStyle();return i&&e.setStyle(i),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(ee(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=K(e,W.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?Ph(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function Ph(s){if(typeof s=="function")return s;let e;return Array.isArray(s)?e=s:(q(typeof s.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),e=[s]),function(){return e}}const ce={ADD:"add",REMOVE:"remove"},ko={LENGTH:"length"};class Pn extends rt{constructor(e,t,i){super(e),this.element=t,this.index=i}}class He extends Je{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e||[],this.unique_)for(let i=0,n=this.array_.length;i<n;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,i=e.length;t<i;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let i=0,n=t.length;i<n;++i)e(t[i],i,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(ko.LENGTH)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new Pn(ce.ADD,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){this.unique_&&this.assertUnique_(e);const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let i=0,n=t.length;i<n;++i)if(t[i]===e)return this.removeAt(i)}removeAt(e){if(e<0||e>=this.getLength())return;const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new Pn(ce.REMOVE,t,e)),t}setAt(e,t){const i=this.getLength();if(e>=i){this.insertAt(e,t);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const n=this.array_[e];this.array_[e]=t,this.dispatchEvent(new Pn(ce.REMOVE,n,e)),this.dispatchEvent(new Pn(ce.ADD,t,e))}updateLength_(){this.set(ko.LENGTH,this.array_.length)}assertUnique_(e,t){for(let i=0,n=this.array_.length;i<n;++i)if(this.array_[i]===e&&i!==t)throw new Error("Duplicate item added to a unique collection")}}class Ei extends rt{constructor(e,t,i){super(e),this.map=t,this.frameState=i!==void 0?i:null}}class bt extends Ei{constructor(e,t,i,n,r,o){super(e,t,r),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=n!==void 0?n:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const ie={SINGLECLICK:"singleclick",CLICK:W.CLICK,DBLCLICK:W.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Dt=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",Fh=Dt.includes("firefox"),Oh=Dt.includes("safari")&&!Dt.includes("chrom");Oh&&(Dt.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(Dt));const Dh=Dt.includes("webkit")&&!Dt.includes("edge"),ja=Dt.includes("macintosh"),Za=typeof devicePixelRatio<"u"?devicePixelRatio:1,Ua=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,Ba=typeof Image<"u"&&Image.prototype.decode,Ka=function(){let s=!1;try{const e=Object.defineProperty({},"passive",{get:function(){s=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch{}return s}(),cr={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown"};class kh extends ps{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=K(i,cr.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=K(i,cr.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(W.TOUCHMOVE,this.boundHandleTouchMove_,Ka?{passive:!1}:!1)}emulateClick_(e){let t=new bt(ie.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new bt(ie.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const i=new bt(ie.SINGLECLICK,this.map_,e);this.dispatchEvent(i)},250)}updateActivePointers_(e){const t=e,i=t.pointerId;if(t.type==ie.POINTERUP||t.type==ie.POINTERCANCEL){delete this.trackedTouches_[i];for(const n in this.trackedTouches_)if(this.trackedTouches_[n].target!==t.target){delete this.trackedTouches_[n];break}}else(t.type==ie.POINTERDOWN||t.type==ie.POINTERMOVE)&&(this.trackedTouches_[i]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new bt(ie.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(ee),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const t=new bt(ie.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(K(i,ie.POINTERMOVE,this.handlePointerMove_,this),K(i,ie.POINTERUP,this.handlePointerUp_,this),K(this.element_,ie.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(K(this.element_.getRootNode(),ie.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new bt(ie.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new bt(ie.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(ee(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(W.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(ee(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(ee),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const gt={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},ye={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},L={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4},es=1/0;class Nh{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,zi(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,i=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const n=this.keyFunction_(i);return delete this.queuedElements_[n],i}enqueue(e){q(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const t=this.priorityFunction_(e);return t!=es?(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const t=this.elements_,i=this.priorities_,n=t.length,r=t[e],o=i[e],a=e;for(;e<n>>1;){const l=this.getLeftChildIndex_(e),h=this.getRightChildIndex_(e),c=h<n&&i[h]<i[l]?h:l;t[e]=t[c],i[e]=i[c],e=c}t[e]=r,i[e]=o,this.siftDown_(a,e)}siftDown_(e,t){const i=this.elements_,n=this.priorities_,r=i[t],o=n[t];for(;t>e;){const a=this.getParentIndex_(t);if(n[a]>o)i[t]=i[a],n[t]=n[a],t=a;else break}i[t]=r,n[t]=o}reprioritize(){const e=this.priorityFunction_,t=this.elements_,i=this.priorities_;let n=0;const r=t.length;let o,a,l;for(a=0;a<r;++a)o=t[a],l=e(o),l==es?delete this.queuedElements_[this.keyFunction_(o)]:(i[n]=l,t[n++]=o);t.length=n,i.length=n,this.heapify_()}}class Gh extends Nh{constructor(e,t){super(i=>e.apply(null,i),i=>i[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener(W.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const t=e.target,i=t.getState();if(i===L.LOADED||i===L.ERROR||i===L.EMPTY){i!==L.ERROR&&t.removeEventListener(W.CHANGE,this.boundHandleTileChange_);const n=t.getKey();n in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[n],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let i=0;for(;this.tilesLoading_<e&&i<t&&this.getCount()>0;){const n=this.dequeue()[0],r=n.getKey();n.getState()===L.IDLE&&!(r in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[r]=!0,++this.tilesLoading_,++i,n.load())}}}function Wh(s,e,t,i,n){if(!s||!(t in s.wantedTiles)||!s.wantedTiles[t][e.getKey()])return es;const r=s.viewState.center,o=i[0]-r[0],a=i[1]-r[1];return 65536*Math.log(n)+Math.sqrt(o*o+a*a)/n}const we={ANIMATING:0,INTERACTING:1},Ke={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function re(s,e,t){return Math.min(Math.max(s,e),t)}function zh(s,e,t,i,n,r){const o=n-t,a=r-i;if(o!==0||a!==0){const l=((s-t)*o+(e-i)*a)/(o*o+a*a);l>1?(t=n,i=r):l>0&&(t+=o*l,i+=a*l)}return Qt(s,e,t,i)}function Qt(s,e,t,i){const n=t-s,r=i-e;return n*n+r*r}function Xh(s){const e=s.length;for(let i=0;i<e;i++){let n=i,r=Math.abs(s[i][i]);for(let a=i+1;a<e;a++){const l=Math.abs(s[a][i]);l>r&&(r=l,n=a)}if(r===0)return null;const o=s[n];s[n]=s[i],s[i]=o;for(let a=i+1;a<e;a++){const l=-s[a][i]/s[i][i];for(let h=i;h<e+1;h++)i==h?s[a][h]=0:s[a][h]+=l*s[i][h]}}const t=new Array(e);for(let i=e-1;i>=0;i--){t[i]=s[i][e]/s[i][i];for(let n=i-1;n>=0;n--)s[n][e]-=s[n][i]*t[i]}return t}function No(s){return s*180/Math.PI}function Ft(s){return s*Math.PI/180}function Ii(s,e){const t=s%e;return t*e<0?t+e:t}function De(s,e,t){return s+t*(e-s)}function Lr(s,e){const t=Math.pow(10,e);return Math.round(s*t)/t}function Fn(s,e){return Math.floor(Lr(s,e))}function On(s,e){return Math.ceil(Lr(s,e))}function ur(s,e,t){if(s>=e&&s<t)return s;const i=t-e;return((s-e)%i+i)%i+e}function Go(s,e,t){return function(i,n,r,o,a){if(!i)return;if(!n&&!e)return i;const l=e?0:r[0]*n,h=e?0:r[1]*n,c=a?a[0]:0,u=a?a[1]:0;let d=s[0]+l/2+c,f=s[2]-l/2+c,g=s[1]+h/2+u,m=s[3]-h/2+u;d>f&&(d=(f+d)/2,f=d),g>m&&(g=(m+g)/2,m=g);let _=re(i[0],d,f),p=re(i[1],g,m);if(o&&t&&n){const y=30*n;_+=-y*Math.log(1+Math.max(0,d-i[0])/y)+y*Math.log(1+Math.max(0,i[0]-f)/y),p+=-y*Math.log(1+Math.max(0,g-i[1])/y)+y*Math.log(1+Math.max(0,i[1]-m)/y)}return[_,p]}}function Yh(s){return s}const ae={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Wo(s){const e=Be();for(let t=0,i=s.length;t<i;++t)on(e,s[t]);return e}function Pr(s,e,t){return t?(t[0]=s[0]-e,t[1]=s[1]-e,t[2]=s[2]+e,t[3]=s[3]+e,t):[s[0]-e,s[1]-e,s[2]+e,s[3]+e]}function Va(s,e){return e?(e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e):s.slice()}function oi(s,e,t){let i,n;return e<s[0]?i=s[0]-e:s[2]<e?i=e-s[2]:i=0,t<s[1]?n=s[1]-t:s[3]<t?n=t-s[3]:n=0,i*i+n*n}function Fi(s,e){return Fr(s,e[0],e[1])}function Ri(s,e){return s[0]<=e[0]&&e[2]<=s[2]&&s[1]<=e[1]&&e[3]<=s[3]}function Fr(s,e,t){return s[0]<=e&&e<=s[2]&&s[1]<=t&&t<=s[3]}function dr(s,e){const t=s[0],i=s[1],n=s[2],r=s[3],o=e[0],a=e[1];let l=ae.UNKNOWN;return o<t?l=l|ae.LEFT:o>n&&(l=l|ae.RIGHT),a<i?l=l|ae.BELOW:a>r&&(l=l|ae.ABOVE),l===ae.UNKNOWN&&(l=ae.INTERSECTING),l}function Be(){return[1/0,1/0,-1/0,-1/0]}function kt(s,e,t,i,n){return n?(n[0]=s,n[1]=e,n[2]=t,n[3]=i,n):[s,e,t,i]}function xn(s){return kt(1/0,1/0,-1/0,-1/0,s)}function Ha(s,e){const t=s[0],i=s[1];return kt(t,i,t,i,e)}function Or(s,e,t,i,n){const r=xn(n);return $a(r,s,e,t,i)}function an(s,e){return s[0]==e[0]&&s[2]==e[2]&&s[1]==e[1]&&s[3]==e[3]}function qa(s,e){return e[0]<s[0]&&(s[0]=e[0]),e[2]>s[2]&&(s[2]=e[2]),e[1]<s[1]&&(s[1]=e[1]),e[3]>s[3]&&(s[3]=e[3]),s}function on(s,e){e[0]<s[0]&&(s[0]=e[0]),e[0]>s[2]&&(s[2]=e[0]),e[1]<s[1]&&(s[1]=e[1]),e[1]>s[3]&&(s[3]=e[1])}function $a(s,e,t,i,n){for(;t<i;t+=n)jh(s,e[t],e[t+1]);return s}function jh(s,e,t){s[0]=Math.min(s[0],e),s[1]=Math.min(s[1],t),s[2]=Math.max(s[2],e),s[3]=Math.max(s[3],t)}function Ja(s,e){let t;return t=e(ys(s)),t||(t=e(ws(s)),t)||(t=e(Es(s)),t)||(t=e(ai(s)),t)?t:!1}function fr(s){let e=0;return xs(s)||(e=Q(s)*ve(s)),e}function ys(s){return[s[0],s[1]]}function ws(s){return[s[2],s[1]]}function Nt(s){return[(s[0]+s[2])/2,(s[1]+s[3])/2]}function Zh(s,e){let t;if(e==="bottom-left")t=ys(s);else if(e==="bottom-right")t=ws(s);else if(e==="top-left")t=ai(s);else if(e==="top-right")t=Es(s);else throw new Error("Invalid corner");return t}function gr(s,e,t,i,n){const[r,o,a,l,h,c,u,d]=Qa(s,e,t,i);return kt(Math.min(r,a,h,u),Math.min(o,l,c,d),Math.max(r,a,h,u),Math.max(o,l,c,d),n)}function Qa(s,e,t,i){const n=e*i[0]/2,r=e*i[1]/2,o=Math.cos(t),a=Math.sin(t),l=n*o,h=n*a,c=r*o,u=r*a,d=s[0],f=s[1];return[d-l+u,f-h-c,d-l-u,f-h+c,d+l-u,f+h+c,d+l+u,f+h-c,d-l+u,f-h-c]}function ve(s){return s[3]-s[1]}function ei(s,e,t){const i=t||Be();return Ae(s,e)?(s[0]>e[0]?i[0]=s[0]:i[0]=e[0],s[1]>e[1]?i[1]=s[1]:i[1]=e[1],s[2]<e[2]?i[2]=s[2]:i[2]=e[2],s[3]<e[3]?i[3]=s[3]:i[3]=e[3]):xn(i),i}function ai(s){return[s[0],s[3]]}function Es(s){return[s[2],s[3]]}function Q(s){return s[2]-s[0]}function Ae(s,e){return s[0]<=e[2]&&s[2]>=e[0]&&s[1]<=e[3]&&s[3]>=e[1]}function xs(s){return s[2]<s[0]||s[3]<s[1]}function Uh(s,e){return e?(e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e):s}function Bh(s,e,t){let i=!1;const n=dr(s,e),r=dr(s,t);if(n===ae.INTERSECTING||r===ae.INTERSECTING)i=!0;else{const o=s[0],a=s[1],l=s[2],h=s[3],c=e[0],u=e[1],d=t[0],f=t[1],g=(f-u)/(d-c);let m,_;r&ae.ABOVE&&!(n&ae.ABOVE)&&(m=d-(f-h)/g,i=m>=o&&m<=l),!i&&r&ae.RIGHT&&!(n&ae.RIGHT)&&(_=f-(d-l)*g,i=_>=a&&_<=h),!i&&r&ae.BELOW&&!(n&ae.BELOW)&&(m=d-(f-a)/g,i=m>=o&&m<=l),!i&&r&ae.LEFT&&!(n&ae.LEFT)&&(_=f-(d-o)*g,i=_>=a&&_<=h)}return i}function el(s,e){const t=e.getExtent(),i=Nt(s);if(e.canWrapX()&&(i[0]<t[0]||i[0]>=t[2])){const n=Q(t),o=Math.floor((i[0]-t[0])/n)*n;s[0]-=o,s[2]-=o}return s}function tl(s,e,t){if(e.canWrapX()){const i=e.getExtent();if(!isFinite(s[0])||!isFinite(s[2]))return[[i[0],s[1],i[2],s[3]]];el(s,e);const n=Q(i);if(Q(s)>n&&!t)return[[i[0],s[1],i[2],s[3]]];if(s[0]<i[0])return[[s[0]+n,s[1],i[2],s[3]],[i[0],s[1],s[2],s[3]]];if(s[2]>i[2])return[[s[0],s[1],i[2],s[3]],[i[0],s[1],s[2]-n,s[3]]]}return[s]}function Kh(s,e){return s[0]+=+e[0],s[1]+=+e[1],s}function ts(s,e){let t=!0;for(let i=s.length-1;i>=0;--i)if(s[i]!=e[i]){t=!1;break}return t}function Dr(s,e){const t=Math.cos(e),i=Math.sin(e),n=s[0]*t-s[1]*i,r=s[1]*t+s[0]*i;return s[0]=n,s[1]=r,s}function Vh(s,e){return s[0]*=e,s[1]*=e,s}function il(s,e){if(e.canWrapX()){const t=Q(e.getExtent()),i=Hh(s,e,t);i&&(s[0]-=i*t)}return s}function Hh(s,e,t){const i=e.getExtent();let n=0;return e.canWrapX()&&(s[0]<i[0]||s[0]>i[2])&&(t=t||Q(i),n=Math.floor((s[0]-i[0])/t)),n}function nl(s){return Math.pow(s,3)}function Xi(s){return 1-nl(1-s)}function qh(s){return 3*s*s-2*s*s*s}function $h(s){return s}const Jh=63710088e-1;function zo(s,e,t){t=t||Jh;const i=Ft(s[1]),n=Ft(e[1]),r=(n-i)/2,o=Ft(e[0]-s[0])/2,a=Math.sin(r)*Math.sin(r)+Math.sin(o)*Math.sin(o)*Math.cos(i)*Math.cos(n);return 2*t*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function sl(...s){console.warn(...s)}const kr={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class Nr{constructor(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent!==void 0?e.extent:null,this.worldExtent_=e.worldExtent!==void 0?e.worldExtent:null,this.axisOrientation_=e.axisOrientation!==void 0?e.axisOrientation:"enu",this.global_=e.global!==void 0?e.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||kr[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(e){this.defaultTileGrid_=e}setExtent(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)}setWorldExtent(e){this.worldExtent_=e}setGetPointResolution(e){this.getPointResolutionFunc_=e}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const Cn=6378137,Si=Math.PI*Cn,Qh=[-Si,-Si,Si,Si],ec=[-180,-85,180,85],Dn=Cn*Math.log(Math.tan(Math.PI/2));class fi extends Nr{constructor(e){super({code:e,units:"m",extent:Qh,global:!0,worldExtent:ec,getPointResolution:function(t,i){return t/Math.cosh(i[1]/Cn)}})}}const Xo=[new fi("EPSG:3857"),new fi("EPSG:102100"),new fi("EPSG:102113"),new fi("EPSG:900913"),new fi("http://www.opengis.net/def/crs/EPSG/0/3857"),new fi("http://www.opengis.net/gml/srs/epsg.xml#3857")];function tc(s,e,t,i){const n=s.length;t=t>1?t:2,i=i??t,e===void 0&&(t>2?e=s.slice():e=new Array(n));for(let r=0;r<n;r+=i){e[r]=Si*s[r]/180;let o=Cn*Math.log(Math.tan(Math.PI*(+s[r+1]+90)/360));o>Dn?o=Dn:o<-Dn&&(o=-Dn),e[r+1]=o}return e}function ic(s,e,t,i){const n=s.length;t=t>1?t:2,i=i??t,e===void 0&&(t>2?e=s.slice():e=new Array(n));for(let r=0;r<n;r+=i)e[r]=180*s[r]/Si,e[r+1]=360*Math.atan(Math.exp(s[r+1]/Cn))/Math.PI-90;return e}const nc=6378137,Yo=[-180,-90,180,90],sc=Math.PI*nc/180;class Bt extends Nr{constructor(e,t){super({code:e,units:"degrees",extent:Yo,axisOrientation:t,global:!0,metersPerUnit:sc,worldExtent:Yo})}}const jo=[new Bt("CRS:84"),new Bt("EPSG:4326","neu"),new Bt("urn:ogc:def:crs:OGC:1.3:CRS84"),new Bt("urn:ogc:def:crs:OGC:2:84"),new Bt("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Bt("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Bt("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let mr={};function rc(s){return mr[s]||mr[s.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function oc(s,e){mr[s]=e}let bi={};function ln(s,e,t){const i=s.getCode(),n=e.getCode();i in bi||(bi[i]={}),bi[i][n]=t}function Xs(s,e){return s in bi&&e in bi[s]?bi[s][e]:null}const is=.9996,Ue=.00669438,Cs=Ue*Ue,vs=Cs*Ue,Ht=Ue/(1-Ue),Zo=Math.sqrt(1-Ue),Oi=(1-Zo)/(1+Zo),rl=Oi*Oi,Gr=rl*Oi,Wr=Gr*Oi,ol=Wr*Oi,al=1-Ue/4-3*Cs/64-5*vs/256,ac=3*Ue/8+3*Cs/32+45*vs/1024,lc=15*Cs/256+45*vs/1024,hc=35*vs/3072,cc=3/2*Oi-27/32*Gr+269/512*ol,uc=21/16*rl-55/32*Wr,dc=151/96*Gr-417/128*ol,fc=1097/512*Wr,ns=6378137;function gc(s,e,t){const i=s-5e5,o=(t.north?e:e-1e7)/is/(ns*al),a=o+cc*Math.sin(2*o)+uc*Math.sin(4*o)+dc*Math.sin(6*o)+fc*Math.sin(8*o),l=Math.sin(a),h=l*l,c=Math.cos(a),u=l/c,d=u*u,f=d*d,g=1-Ue*h,m=Math.sqrt(1-Ue*h),_=ns/m,p=(1-Ue)/g,y=Ht*c**2,x=y*y,w=i/(_*is),E=w*w,R=E*w,I=R*w,v=I*w,S=v*w,A=a-u/p*(E/2-I/24*(5+3*d+10*y-4*x-9*Ht))+S/720*(61+90*d+298*y+45*f-252*Ht-3*x);let O=(w-R/6*(1+2*d+y)+v/120*(5-2*y+28*d-3*x+8*Ht+24*f))/c;return O=ur(O+Ft(ll(t.number)),-Math.PI,Math.PI),[No(O),No(A)]}const Uo=-80,Bo=84,mc=-180,_c=180;function pc(s,e,t){s=ur(s,mc,_c),e<Uo?e=Uo:e>Bo&&(e=Bo);const i=Ft(e),n=Math.sin(i),r=Math.cos(i),o=n/r,a=o*o,l=a*a,h=Ft(s),c=ll(t.number),u=Ft(c),d=ns/Math.sqrt(1-Ue*n**2),f=Ht*r**2,g=r*ur(h-u,-Math.PI,Math.PI),m=g*g,_=m*g,p=_*g,y=p*g,x=y*g,w=ns*(al*i-ac*Math.sin(2*i)+lc*Math.sin(4*i)-hc*Math.sin(6*i)),E=is*d*(g+_/6*(1-a+f)+y/120*(5-18*a+l+72*f-58*Ht))+5e5;let R=is*(w+d*o*(m/2+p/24*(5-a+9*f+4*f**2)+x/720*(61-58*a+l+600*f-330*Ht)));return t.north||(R+=1e7),[E,R]}function ll(s){return(s-1)*6-180+3}const yc=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function hl(s){let e=0;for(const n of yc){const r=s.match(n);if(r){e=parseInt(r[1]);break}}if(!e)return null;let t=0,i=!1;return e>32700&&e<32761?t=e-32700:e>32600&&e<32661&&(i=!0,t=e-32600),t?{number:t,north:i}:null}function Ko(s,e){return function(t,i,n,r){const o=t.length;n=n>1?n:2,r=r??n,i||(n>2?i=t.slice():i=new Array(o));for(let a=0;a<o;a+=r){const l=t[a],h=t[a+1],c=s(l,h,e);i[a]=c[0],i[a+1]=c[1]}return i}}function wc(s){return hl(s)?new Nr({code:s,units:"m"}):null}function Ec(s){const e=hl(s.getCode());return e?{forward:Ko(pc,e),inverse:Ko(gc,e)}:null}const xc=[Ec],Cc=[wc];let _r=!0;function vc(s){_r=!1}function zr(s,e){if(e!==void 0){for(let t=0,i=s.length;t<i;++t)e[t]=s[t];e=e}else e=s.slice();return e}function pr(s){oc(s.getCode(),s),ln(s,s,zr)}function Rc(s){s.forEach(pr)}function se(s){if(typeof s!="string")return s;const e=rc(s);if(e)return e;for(const t of Cc){const i=t(s);if(i)return i}return null}function Vo(s,e,t,i){s=se(s);let n;const r=s.getPointResolutionFunc();if(r)n=r(e,t);else{const o=s.getUnits();if(o=="degrees"||i=="degrees")n=e;else{const a=Yr(s,se("EPSG:4326"));if(!a&&o!=="degrees")n=e*s.getMetersPerUnit();else{let h=[t[0]-e/2,t[1],t[0]+e/2,t[1],t[0],t[1]-e/2,t[0],t[1]+e/2];h=a(h,h,2);const c=zo(h.slice(0,2),h.slice(2,4)),u=zo(h.slice(4,6),h.slice(6,8));n=(c+u)/2}const l=s.getMetersPerUnit();l!==void 0&&(n/=l)}}return n}function Ho(s){Rc(s),s.forEach(function(e){s.forEach(function(t){e!==t&&ln(e,t,zr)})})}function Sc(s,e,t,i){s.forEach(function(n){e.forEach(function(r){ln(n,r,t),ln(r,n,i)})})}function Xr(s,e){return s?typeof s=="string"?se(s):s:se(e)}function Tc(s){return function(e,t,i,n){const r=e.length;i=i!==void 0?i:2,n=n??i,t=t!==void 0?t:new Array(r);for(let o=0;o<r;o+=n){const a=s(e.slice(o,o+i)),l=a.length;for(let h=0,c=n;h<c;++h)t[o+h]=h>=l?e[o+h]:a[h]}return t}}function Jn(s,e){if(s===e)return!0;const t=s.getUnits()===e.getUnits();return(s.getCode()===e.getCode()||Yr(s,e)===zr)&&t}function Yr(s,e){const t=s.getCode(),i=e.getCode();let n=Xs(t,i);if(n)return n;let r=null,o=null;for(const l of xc)r||(r=l(s)),o||(o=l(e));if(!r&&!o)return null;const a="EPSG:4326";if(o)if(r)n=Ys(r.inverse,o.forward);else{const l=Xs(t,a);l&&(n=Ys(l,o.forward))}else{const l=Xs(a,i);l&&(n=Ys(r.inverse,l))}return n&&(pr(s),pr(e),ln(s,e,n)),n}function Ys(s,e){return function(t,i,n,r){return i=s(t,i,n,r),e(i,i,n,r)}}function hn(s,e){const t=se(s),i=se(e);return Yr(t,i)}function cl(s,e,t){const i=hn(e,t);if(!i){const n=se(e).getCode(),r=se(t).getCode();throw new Error(`No transform available between ${n} and ${r}`)}return i(s,void 0,s.length)}function yr(s,e){return s}function dt(s,e){return _r&&!ts(s,[0,0])&&s[0]>=-180&&s[0]<=180&&s[1]>=-90&&s[1]<=90&&(_r=!1,sl("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),s}function ul(s,e){return s}function Mt(s,e){return s}function Ic(){Ho(Xo),Ho(jo),Sc(jo,Xo,tc,ic)}Ic();new Array(6);function qe(){return[1,0,0,1,0,0]}function bc(s,e){return s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],s[4]=e[4],s[5]=e[5],s}function le(s,e){const t=e[0],i=e[1];return e[0]=s[0]*t+s[2]*i+s[4],e[1]=s[1]*t+s[3]*i+s[5],e}function wt(s,e,t,i,n,r,o,a){const l=Math.sin(r),h=Math.cos(r);return s[0]=i*h,s[1]=n*l,s[2]=-i*l,s[3]=n*h,s[4]=o*i*h-a*i*l+e,s[5]=o*n*l+a*n*h+t,s}function dl(s,e){const t=Ac(e);q(t!==0,"Transformation matrix cannot be inverted");const i=e[0],n=e[1],r=e[2],o=e[3],a=e[4],l=e[5];return s[0]=o/t,s[1]=-n/t,s[2]=-r/t,s[3]=i/t,s[4]=(r*l-o*a)/t,s[5]=-(i*l-n*a)/t,s}function Ac(s){return s[0]*s[3]-s[1]*s[2]}const qo=[1e6,1e6,1e6,1e6,2,2];function Mc(s){return"matrix("+s.map((t,i)=>Math.round(t*qo[i])/qo[i]).join(", ")+")"}function Ot(s,e,t,i,n,r,o){r=r||[],o=o||2;let a=0;for(let l=e;l<t;l+=i){const h=s[l],c=s[l+1];r[a++]=n[0]*h+n[2]*c+n[4],r[a++]=n[1]*h+n[3]*c+n[5];for(let u=2;u<o;u++)r[a++]=s[l+u]}return r&&r.length!=a&&(r.length=a),r}function fl(s,e,t,i,n,r,o){o=o||[];const a=Math.cos(n),l=Math.sin(n),h=r[0],c=r[1];let u=0;for(let d=e;d<t;d+=i){const f=s[d]-h,g=s[d+1]-c;o[u++]=h+f*a-g*l,o[u++]=c+f*l+g*a;for(let m=d+2;m<d+i;++m)o[u++]=s[m]}return o&&o.length!=u&&(o.length=u),o}function Lc(s,e,t,i,n,r,o,a){a=a||[];const l=o[0],h=o[1];let c=0;for(let u=e;u<t;u+=i){const d=s[u]-l,f=s[u+1]-h;a[c++]=l+n*d,a[c++]=h+r*f;for(let g=u+2;g<u+i;++g)a[c++]=s[g]}return a&&a.length!=c&&(a.length=c),a}function Pc(s,e,t,i,n,r,o){o=o||[];let a=0;for(let l=e;l<t;l+=i){o[a++]=s[l]+n,o[a++]=s[l+1]+r;for(let h=l+2;h<l+i;++h)o[a++]=s[h]}return o&&o.length!=a&&(o.length=a),o}const $o=qe(),Fc=[NaN,NaN];class gl extends Je{constructor(){super(),this.extent_=Be(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=Ya((e,t,i)=>{if(!i)return this.getSimplifiedGeometry(t);const n=this.clone();return n.applyTransform(i),n.getSimplifiedGeometry(t)})}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return N()}closestPointXY(e,t,i,n){return N()}containsXY(e,t){return this.closestPointXY(e,t,Fc,Number.MIN_VALUE)===0}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return N()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&xn(t),this.extentRevision_=this.getRevision()}return Uh(this.extent_,e)}rotate(e,t){N()}scale(e,t,i){N()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return N()}getType(){return N()}applyTransform(e){N()}intersectsExtent(e){return N()}translate(e,t){N()}transform(e,t){const i=se(e),n=i.getUnits()=="tile-pixels"?function(r,o,a){const l=i.getExtent(),h=i.getWorldExtent(),c=ve(h)/ve(l);wt($o,h[0],h[3],c,-c,0,0,0);const u=Ot(r,0,r.length,a,$o,o),d=hn(i,t);return d?d(u,u,a):u}:hn(i,t);return this.applyTransform(n),this}}class li extends gl{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(e){return Or(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return N()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=Jo(e),this.layout=e,this.flatCoordinates=t}setCoordinates(e,t){N()}setLayout(e,t,i){let n;if(e)n=Jo(e);else{for(let r=0;r<i;++r){if(t.length===0){this.layout="XY",this.stride=2;return}t=t[0]}n=t.length,e=hi(n)}this.layout=e,this.stride=n}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(e,t){const i=this.getFlatCoordinates();if(i){const n=this.getStride();fl(i,0,i.length,n,e,t,i),this.changed()}}scale(e,t,i){t===void 0&&(t=e),i||(i=Nt(this.getExtent()));const n=this.getFlatCoordinates();if(n){const r=this.getStride();Lc(n,0,n.length,r,e,t,i,n),this.changed()}}translate(e,t){const i=this.getFlatCoordinates();if(i){const n=this.getStride();Pc(i,0,i.length,n,e,t,i),this.changed()}}}function hi(s){let e;return s==2?e="XY":s==3?e="XYZ":s==4&&(e="XYZM"),e}function Jo(s){let e;return s=="XY"?e=2:s=="XYZ"||s=="XYM"?e=3:s=="XYZM"&&(e=4),e}function Oc(s,e,t){const i=s.getFlatCoordinates();if(!i)return null;const n=s.getStride();return Ot(i,0,i.length,n,e,t)}function ml(s,e,t,i){let n=0;const r=s[t-i],o=s[t-i+1];let a=0,l=0;for(;e<t;e+=i){const h=s[e]-r,c=s[e+1]-o;n+=l*h-a*c,a=h,l=c}return n/2}function _l(s,e,t,i){let n=0;for(let r=0,o=t.length;r<o;++r){const a=t[r];n+=ml(s,e,a,i),e=a}return n}function Dc(s,e,t,i){let n=0;for(let r=0,o=t.length;r<o;++r){const a=t[r];n+=_l(s,e,a,i),e=a[a.length-1]}return n}function Qo(s,e,t,i,n,r,o){const a=s[e],l=s[e+1],h=s[t]-a,c=s[t+1]-l;let u;if(h===0&&c===0)u=e;else{const d=((n-a)*h+(r-l)*c)/(h*h+c*c);if(d>1)u=t;else if(d>0){for(let f=0;f<i;++f)o[f]=De(s[e+f],s[t+f],d);o.length=i;return}else u=e}for(let d=0;d<i;++d)o[d]=s[u+d];o.length=i}function jr(s,e,t,i,n){let r=s[e],o=s[e+1];for(e+=i;e<t;e+=i){const a=s[e],l=s[e+1],h=Qt(r,o,a,l);h>n&&(n=h),r=a,o=l}return n}function Zr(s,e,t,i,n){for(let r=0,o=t.length;r<o;++r){const a=t[r];n=jr(s,e,a,i,n),e=a}return n}function kc(s,e,t,i,n){for(let r=0,o=t.length;r<o;++r){const a=t[r];n=Zr(s,e,a,i,n),e=a[a.length-1]}return n}function Ur(s,e,t,i,n,r,o,a,l,h,c){if(e==t)return h;let u,d;if(n===0){if(d=Qt(o,a,s[e],s[e+1]),d<h){for(u=0;u<i;++u)l[u]=s[e+u];return l.length=i,d}return h}c=c||[NaN,NaN];let f=e+i;for(;f<t;)if(Qo(s,f-i,f,i,o,a,c),d=Qt(o,a,c[0],c[1]),d<h){for(h=d,u=0;u<i;++u)l[u]=c[u];l.length=i,f+=i}else f+=i*Math.max((Math.sqrt(d)-Math.sqrt(h))/n|0,1);if(r&&(Qo(s,t-i,e,i,o,a,c),d=Qt(o,a,c[0],c[1]),d<h)){for(h=d,u=0;u<i;++u)l[u]=c[u];l.length=i}return h}function Br(s,e,t,i,n,r,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=t.length;u<d;++u){const f=t[u];h=Ur(s,e,f,i,n,r,o,a,l,h,c),e=f}return h}function Nc(s,e,t,i,n,r,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=t.length;u<d;++u){const f=t[u];h=Br(s,e,f,i,n,r,o,a,l,h,c),e=f[f.length-1]}return h}function Gc(s,e,t,i){for(let n=0,r=t.length;n<r;++n)s[e++]=t[n];return e}function Rs(s,e,t,i){for(let n=0,r=t.length;n<r;++n){const o=t[n];for(let a=0;a<i;++a)s[e++]=o[a]}return e}function vn(s,e,t,i,n){n=n||[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=Rs(s,e,t[o],i);n[r++]=l,e=l}return n.length=r,n}function pl(s,e,t,i,n){n=n||[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=vn(s,e,t[o],i,n[r]);l.length===0&&(l[0]=e),n[r++]=l,e=l[l.length-1]}return n.length=r,n}function Lt(s,e,t,i,n){n=n!==void 0?n:[];let r=0;for(let o=e;o<t;o+=i)n[r++]=s.slice(o,o+i);return n.length=r,n}function cn(s,e,t,i,n){n=n!==void 0?n:[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];n[r++]=Lt(s,e,l,i,n[r]),e=l}return n.length=r,n}function wr(s,e,t,i,n){n=n!==void 0?n:[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];n[r++]=l.length===1&&l[0]===e?[]:cn(s,e,l,i,n[r]),e=l[l.length-1]}return n.length=r,n}function Ss(s,e,t,i,n,r,o){const a=(t-e)/i;if(a<3){for(;e<t;e+=i)r[o++]=s[e],r[o++]=s[e+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[e,t-i];let c=0;for(;h.length>0;){const u=h.pop(),d=h.pop();let f=0;const g=s[d],m=s[d+1],_=s[u],p=s[u+1];for(let y=d+i;y<u;y+=i){const x=s[y],w=s[y+1],E=zh(x,w,g,m,_,p);E>f&&(c=y,f=E)}f>n&&(l[(c-e)/i]=1,d+i<c&&h.push(d,c),c+i<u&&h.push(c,u))}for(let u=0;u<a;++u)l[u]&&(r[o++]=s[e+u*i],r[o++]=s[e+u*i+1]);return o}function yl(s,e,t,i,n,r,o,a){for(let l=0,h=t.length;l<h;++l){const c=t[l];o=Ss(s,e,c,i,n,r,o),a.push(o),e=c}return o}function Vt(s,e){return e*Math.round(s/e)}function Wc(s,e,t,i,n,r,o){if(e==t)return o;let a=Vt(s[e],n),l=Vt(s[e+1],n);e+=i,r[o++]=a,r[o++]=l;let h,c;do if(h=Vt(s[e],n),c=Vt(s[e+1],n),e+=i,e==t)return r[o++]=h,r[o++]=c,o;while(h==a&&c==l);for(;e<t;){const u=Vt(s[e],n),d=Vt(s[e+1],n);if(e+=i,u==h&&d==c)continue;const f=h-a,g=c-l,m=u-a,_=d-l;if(f*_==g*m&&(f<0&&m<f||f==m||f>0&&m>f)&&(g<0&&_<g||g==_||g>0&&_>g)){h=u,c=d;continue}r[o++]=h,r[o++]=c,a=h,l=c,h=u,c=d}return r[o++]=h,r[o++]=c,o}function Kr(s,e,t,i,n,r,o,a){for(let l=0,h=t.length;l<h;++l){const c=t[l];o=Wc(s,e,c,i,n,r,o),a.push(o),e=c}return o}function zc(s,e,t,i,n,r,o,a){for(let l=0,h=t.length;l<h;++l){const c=t[l],u=[];o=Kr(s,e,c,i,n,r,o,u),a.push(u),e=c[c.length-1]}return o}class un extends li{constructor(e,t){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}clone(){return new un(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,t,i,n){return n<oi(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(jr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ur(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,i,n))}getArea(){return ml(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Lt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const t=[];return t.length=Ss(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new un(t,"XY")}getType(){return"LinearRing"}intersectsExtent(e){return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Rs(this.flatCoordinates,0,e,this.stride),this.changed()}}class Di extends li{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){const e=new Di(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,n){const r=this.flatCoordinates,o=Qt(e,t,r[0],r[1]);if(o<n){const a=this.stride;for(let l=0;l<a;++l)i[l]=r[l];return i.length=a,o}return n}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(e){return Ha(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return Fr(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Gc(this.flatCoordinates,0,e,this.stride),this.changed()}}function Xc(s,e,t,i,n){return!Ja(n,function(o){return!qt(s,e,t,i,o[0],o[1])})}function qt(s,e,t,i,n,r){let o=0,a=s[t-i],l=s[t-i+1];for(;e<t;e+=i){const h=s[e],c=s[e+1];l<=r?c>r&&(h-a)*(r-l)-(n-a)*(c-l)>0&&o++:c<=r&&(h-a)*(r-l)-(n-a)*(c-l)<0&&o--,a=h,l=c}return o!==0}function Vr(s,e,t,i,n,r){if(t.length===0||!qt(s,e,t[0],i,n,r))return!1;for(let o=1,a=t.length;o<a;++o)if(qt(s,t[o-1],t[o],i,n,r))return!1;return!0}function Yc(s,e,t,i,n,r){if(t.length===0)return!1;for(let o=0,a=t.length;o<a;++o){const l=t[o];if(Vr(s,e,l,i,n,r))return!0;e=l[l.length-1]}return!1}function Hr(s,e,t,i,n,r,o){let a,l,h,c,u,d,f;const g=n[r+1],m=[];for(let y=0,x=t.length;y<x;++y){const w=t[y];for(c=s[w-i],d=s[w-i+1],a=e;a<w;a+=i)u=s[a],f=s[a+1],(g<=d&&f<=g||d<=g&&g<=f)&&(h=(g-d)/(f-d)*(u-c)+c,m.push(h)),c=u,d=f}let _=NaN,p=-1/0;for(m.sort(_t),c=m[0],a=1,l=m.length;a<l;++a){u=m[a];const y=Math.abs(u-c);y>p&&(h=(c+u)/2,Vr(s,e,t,i,h,g)&&(_=h,p=y)),c=u}return isNaN(_)&&(_=n[r]),o?(o.push(_,g,p),o):[_,g,p]}function wl(s,e,t,i,n){let r=[];for(let o=0,a=t.length;o<a;++o){const l=t[o];r=Hr(s,e,l,i,n,2*o,r),e=l[l.length-1]}return r}function El(s,e,t,i,n){let r;for(e+=i;e<t;e+=i)if(r=n(s.slice(e-i,e),s.slice(e,e+i)),r)return r;return!1}function Ts(s,e,t,i,n,r){return r=r??$a(Be(),s,e,t,i),Ae(n,r)?r[0]>=n[0]&&r[2]<=n[2]||r[1]>=n[1]&&r[3]<=n[3]?!0:El(s,e,t,i,function(o,a){return Bh(n,o,a)}):!1}function jc(s,e,t,i,n){for(let r=0,o=t.length;r<o;++r){if(Ts(s,e,t[r],i,n))return!0;e=t[r]}return!1}function xl(s,e,t,i,n){return!!(Ts(s,e,t,i,n)||qt(s,e,t,i,n[0],n[1])||qt(s,e,t,i,n[0],n[3])||qt(s,e,t,i,n[2],n[1])||qt(s,e,t,i,n[2],n[3]))}function Cl(s,e,t,i,n){if(!xl(s,e,t[0],i,n))return!1;if(t.length===1)return!0;for(let r=1,o=t.length;r<o;++r)if(Xc(s,t[r-1],t[r],i,n)&&!Ts(s,t[r-1],t[r],i,n))return!1;return!0}function Zc(s,e,t,i,n){for(let r=0,o=t.length;r<o;++r){const a=t[r];if(Cl(s,e,a,i,n))return!0;e=a[a.length-1]}return!1}function Uc(s,e,t,i){for(;e<t-i;){for(let n=0;n<i;++n){const r=s[e+n];s[e+n]=s[t-i+n],s[t-i+n]=r}e+=i,t-=i}}function qr(s,e,t,i){let n=0,r=s[t-i],o=s[t-i+1];for(;e<t;e+=i){const a=s[e],l=s[e+1];n+=(a-r)*(l+o),r=a,o=l}return n===0?void 0:n>0}function $r(s,e,t,i,n){n=n!==void 0?n:!1;for(let r=0,o=t.length;r<o;++r){const a=t[r],l=qr(s,e,a,i);if(r===0){if(n&&l||!n&&!l)return!1}else if(n&&!l||!n&&l)return!1;e=a}return!0}function vl(s,e,t,i,n){for(let r=0,o=t.length;r<o;++r){const a=t[r];if(!$r(s,e,a,i,n))return!1;a.length&&(e=a[a.length-1])}return!0}function ss(s,e,t,i,n){n=n!==void 0?n:!1;for(let r=0,o=t.length;r<o;++r){const a=t[r],l=qr(s,e,a,i);(r===0?n&&l||!n&&!l:n&&!l||!n&&l)&&Uc(s,e,a,i),e=a}return e}function Er(s,e,t,i,n){for(let r=0,o=t.length;r<o;++r)e=ss(s,e,t[r],i,n);return e}function Bc(s,e){const t=[];let i=0,n=0,r;for(let o=0,a=e.length;o<a;++o){const l=e[o],h=qr(s,i,l,2);if(r===void 0&&(r=h),h===r)t.push(e.slice(n,o+1));else{if(t.length===0)continue;t[t.length-1].push(e[n])}n=o+1,i=l}return t}class Gt extends li{constructor(e,t,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,t!==void 0&&i?(this.setFlatCoordinates(t,e),this.ends_=i):this.setCoordinates(e,t)}appendLinearRing(e){this.flatCoordinates?Ze(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new Gt(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,n){return n<oi(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Zr(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Br(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,i,n))}containsXY(e,t){return Vr(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)}getArea(){return _l(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),ss(t,0,this.ends_,this.stride,e)):t=this.flatCoordinates,cn(t,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=Nt(this.getExtent());this.flatInteriorPoint_=Hr(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Di(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new un(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const e=this.layout,t=this.flatCoordinates,i=this.ends_,n=[];let r=0;for(let o=0,a=i.length;o<a;++o){const l=i[o],h=new un(t.slice(r,l),e);n.push(h),r=l}return n}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;$r(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=ss(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=Kr(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,i),new Gt(t,"XY",i)}getType(){return"Polygon"}intersectsExtent(e){return Cl(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=vn(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}function ea(s){if(xs(s))throw new Error("Cannot create polygon from empty extent");const e=s[0],t=s[1],i=s[2],n=s[3],r=[e,t,e,n,i,n,i,t,e,t];return new Gt(r,"XY",[r.length])}function Jr(s,e,t,i){const n=Q(e)/t[0],r=ve(e)/t[1];return i?Math.min(s,Math.max(n,r)):Math.min(s,Math.min(n,r))}function Qr(s,e,t){let i=Math.min(s,e);const n=50;return i*=Math.log(1+n*Math.max(0,s/e-1))/n+1,t&&(i=Math.max(i,t),i/=Math.log(1+n*Math.max(0,t/s-1))/n+1),re(i,t/2,e*2)}function Kc(s,e,t,i){return e=e!==void 0?e:!0,function(n,r,o,a){if(n!==void 0){const l=s[0],h=s[s.length-1],c=t?Jr(l,t,o,i):l;if(a)return e?Qr(n,c,h):re(n,h,c);const u=Math.min(c,n),d=Math.floor(Mr(s,u,r));return s[d]>c&&d<s.length-1?s[d+1]:s[d]}}}function Vc(s,e,t,i,n,r){return i=i!==void 0?i:!0,t=t!==void 0?t:0,function(o,a,l,h){if(o!==void 0){const c=n?Jr(e,n,l,r):e;if(h)return i?Qr(o,c,t):re(o,t,c);const u=1e-9,d=Math.ceil(Math.log(e/c)/Math.log(s)-u),f=-a*(.5-u)+.5,g=Math.min(c,o),m=Math.floor(Math.log(e/g)/Math.log(s)+f),_=Math.max(d,m),p=e/Math.pow(s,_);return re(p,t,c)}}}function ta(s,e,t,i,n){return t=t!==void 0?t:!0,function(r,o,a,l){if(r!==void 0){const h=i?Jr(s,i,a,n):s;return!t||!l?re(r,e,h):Qr(r,h,e)}}}function eo(s){if(s!==void 0)return 0}function ia(s){if(s!==void 0)return s}function Hc(s){const e=2*Math.PI/s;return function(t,i){if(i)return t;if(t!==void 0)return t=Math.floor(t/e+.5)*e,t}}function qc(s){const e=Ft(5);return function(t,i){return i||t===void 0?t:Math.abs(t)<=e?0:t}}const $c=42,to=256,js=0;class it extends Je{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Xr(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&vc(),e.center&&(e.center=dt(e.center,this.projection_)),e.extent&&(e.extent=Mt(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const t=Object.assign({},e);for(const a in Ke)delete t[a];this.setProperties(t,!0);const i=Qc(e);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=i.minZoom;const n=Jc(e),r=i.constraint,o=eu(e);this.constraints_={center:n,resolution:r,rotation:o},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const i=this.getCenterInternal();if(i){const n=e||[0,0,0,0];t=t||[0,0,0,0];const r=this.getResolution(),o=r/2*(n[3]-t[3]+t[1]-n[1]),a=r/2*(n[0]-t[0]+t[2]-n[2]);this.setCenterInternal([i[0]+o,i[1]-a])}}getUpdatedOptions_(e){const t=this.getProperties();return t.resolution!==void 0?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let i=0;i<t.length;++i){let n=arguments[i];n.center&&(n=Object.assign({},n),n.center=dt(n.center,this.getProjection())),n.anchor&&(n=Object.assign({},n),n.anchor=dt(n.anchor,this.getProjection())),t[i]=n}this.animateInternal.apply(this,t)}animateInternal(e){let t=arguments.length,i;t>1&&typeof arguments[t-1]=="function"&&(i=arguments[t-1],--t);let n=0;for(;n<t&&!this.isDef();++n){const c=arguments[n];c.center&&this.setCenterInternal(c.center),c.zoom!==void 0?this.setZoom(c.zoom):c.resolution&&this.setResolution(c.resolution),c.rotation!==void 0&&this.setRotation(c.rotation)}if(n===t){i&&kn(i,!0);return}let r=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;n<t;++n){const c=arguments[n],u={start:r,complete:!1,anchor:c.anchor,duration:c.duration!==void 0?c.duration:1e3,easing:c.easing||qh,callback:i};if(c.center&&(u.sourceCenter=o,u.targetCenter=c.center.slice(),o=u.targetCenter),c.zoom!==void 0?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(c.zoom),a=u.targetResolution):c.resolution&&(u.sourceResolution=a,u.targetResolution=c.resolution,a=u.targetResolution),c.rotation!==void 0){u.sourceRotation=l;const d=Ii(c.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+d,l=u.targetRotation}tu(u)?u.complete=!0:r+=u.duration,h.push(u)}this.animations_.push(h),this.setHint(we.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[we.ANIMATING]>0}getInteracting(){return this.hints_[we.INTERACTING]>0}cancelAnimations(){this.setHint(we.ANIMATING,-this.hints_[we.ANIMATING]);let e;for(let t=0,i=this.animations_.length;t<i;++t){const n=this.animations_[t];if(n[0].callback&&kn(n[0].callback,!1),!e)for(let r=0,o=n.length;r<o;++r){const a=n[r];if(!a.complete){e=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let i=this.animations_.length-1;i>=0;--i){const n=this.animations_[i];let r=!0;for(let o=0,a=n.length;o<a;++o){const l=n[o];if(l.complete)continue;const h=e-l.start;let c=l.duration>0?h/l.duration:1;c>=1?(l.complete=!0,c=1):r=!1;const u=l.easing(c);if(l.sourceCenter){const d=l.sourceCenter[0],f=l.sourceCenter[1],g=l.targetCenter[0],m=l.targetCenter[1];this.nextCenter_=l.targetCenter;const _=d+u*(g-d),p=f+u*(m-f);this.targetCenter_=[_,p]}if(l.sourceResolution&&l.targetResolution){const d=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const f=this.getViewportSize_(this.getRotation()),g=this.constraints_.resolution(d,0,f,!0);this.targetCenter_=this.calculateCenterZoom(g,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=d,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const d=u===1?Ii(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const f=this.constraints_.rotation(d,!0);this.targetCenter_=this.calculateCenterRotate(f,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=d}if(this.applyTargetState_(!0),t=!0,!l.complete)break}if(r){this.animations_[i]=null,this.setHint(we.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=n[0].callback;o&&kn(o,!0)}}this.animations_=this.animations_.filter(Boolean),t&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let i;const n=this.getCenterInternal();return n!==void 0&&(i=[n[0]-t[0],n[1]-t[1]],Dr(i,e-this.getRotation()),Kh(i,t)),i}calculateCenterZoom(e,t){let i;const n=this.getCenterInternal(),r=this.getResolution();if(n!==void 0&&r!==void 0){const o=t[0]-e*(t[0]-n[0])/r,a=t[1]-e*(t[1]-n[1])/r;i=[o,a]}return i}getViewportSize_(e){const t=this.viewportSize_;if(e){const i=t[0],n=t[1];return[Math.abs(i*Math.cos(e))+Math.abs(n*Math.sin(e)),Math.abs(i*Math.sin(e))+Math.abs(n*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&yr(e,this.getProjection())}getCenterInternal(){return this.get(Ke.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const t=this.calculateExtentInternal(e);return ul(t,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();q(t,"The view center is not defined");const i=this.getResolution();q(i!==void 0,"The view resolution is not defined");const n=this.getRotation();return q(n!==void 0,"The view rotation is not defined"),gr(t,i,n,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(Ke.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(Mt(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const i=Q(e)/t[0],n=ve(e)/t[1];return Math.max(i,n)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,n=Math.log(t/i)/Math.log(e);return function(r){return t/Math.pow(e,r*n)}}getRotation(){return this.get(Ke.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),i=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,r=Math.log(i/n)/t;return function(o){return Math.log(i/o)/t/r}}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e);const i=this.padding_;return i&&(t=[t[0]-i[1]-i[3],t[1]-i[0]-i[2]]),t}getState(){const e=this.getProjection(),t=this.getResolution(),i=this.getRotation();let n=this.getCenterInternal();const r=this.padding_;if(r){const o=this.getViewportSizeMinusPadding_();n=Zs(n,this.getViewportSize_(),[o[0]/2+r[3],o[1]/2+r[0]],t,i)}return{center:n.slice(0),projection:e!==void 0?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const t=this.getResolution();return t!==void 0&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t=this.minZoom_||0,i,n;if(this.resolutions_){const r=Mr(this.resolutions_,e,1);t=r,i=this.resolutions_[r],r==this.resolutions_.length-1?n=2:n=i/this.resolutions_[r+1]}else i=this.maxResolution_,n=this.zoomFactor_;return t+Math.log(i/e)/Math.log(n)}getResolutionForZoom(e){var t;if((t=this.resolutions_)!=null&&t.length){if(this.resolutions_.length===1)return this.resolutions_[0];const i=re(Math.floor(e),0,this.resolutions_.length-2),n=this.resolutions_[i]/this.resolutions_[i+1];return this.resolutions_[i]/Math.pow(n,re(e-i,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let i;if(q(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(e)){q(!xs(e),"Cannot fit empty extent provided as `geometry`");const n=Mt(e,this.getProjection());i=ea(n)}else if(e.getType()==="Circle"){const n=Mt(e.getExtent(),this.getProjection());i=ea(n),i.rotate(this.getRotation(),Nt(n))}else i=e;this.fitInternal(i,t)}rotatedExtentForGeometry(e){const t=this.getRotation(),i=Math.cos(t),n=Math.sin(-t),r=e.getFlatCoordinates(),o=e.getStride();let a=1/0,l=1/0,h=-1/0,c=-1/0;for(let u=0,d=r.length;u<d;u+=o){const f=r[u]*i-r[u+1]*n,g=r[u]*n+r[u+1]*i;a=Math.min(a,f),l=Math.min(l,g),h=Math.max(h,f),c=Math.max(c,g)}return[a,l,h,c]}fitInternal(e,t){t=t||{};let i=t.size;i||(i=this.getViewportSizeMinusPadding_());const n=t.padding!==void 0?t.padding:[0,0,0,0],r=t.nearest!==void 0?t.nearest:!1;let o;t.minResolution!==void 0?o=t.minResolution:t.maxZoom!==void 0?o=this.getResolutionForZoom(t.maxZoom):o=0;const a=this.rotatedExtentForGeometry(e);let l=this.getResolutionForExtentInternal(a,[i[0]-n[1]-n[3],i[1]-n[0]-n[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,r?0:1);const h=this.getRotation(),c=Math.sin(h),u=Math.cos(h),d=Nt(a);d[0]+=(n[1]-n[3])/2*l,d[1]+=(n[0]-n[2])/2*l;const f=d[0]*u-d[1]*c,g=d[1]*u+d[0]*c,m=this.getConstrainedCenter([f,g],l),_=t.callback?t.callback:Pi;t.duration!==void 0?this.animateInternal({resolution:l,center:m,duration:t.duration,easing:t.easing},_):(this.targetResolution_=l,this.targetCenter_=m,this.applyTargetState_(!1,!0),kn(_,!0))}centerOn(e,t,i){this.centerOnInternal(dt(e,this.getProjection()),t,i)}centerOnInternal(e,t,i){this.setCenterInternal(Zs(e,t,i,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,i,n){let r;const o=this.padding_;if(o&&e){const a=this.getViewportSizeMinusPadding_(-i),l=Zs(e,n,[a[0]/2+o[3],a[1]/2+o[0]],t,i);r=[e[0]-l[0],e[1]-l[1]]}return r}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(e){const t=yr(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&dt(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const i=this.getAnimating()||this.getInteracting(),n=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*e,0,n,i);t&&(this.targetCenter_=this.calculateCenterZoom(r,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=dt(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const i=this.getAnimating()||this.getInteracting(),n=this.constraints_.rotation(this.targetRotation_+e,i);t&&(this.targetCenter_=this.calculateCenterRotate(n,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&dt(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const i=this.getAnimating()||this.getInteracting()||t,n=this.constraints_.rotation(this.targetRotation_,i),r=this.getViewportSize_(n),o=this.constraints_.resolution(this.targetResolution_,0,r,i),a=this.constraints_.center(this.targetCenter_,o,r,i,this.calculateCenterShift(this.targetCenter_,o,n,r));this.get(Ke.ROTATION)!==n&&this.set(Ke.ROTATION,n),this.get(Ke.RESOLUTION)!==o&&(this.set(Ke.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(Ke.CENTER)||!ts(this.get(Ke.CENTER),a))&&this.set(Ke.CENTER,a),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,i){e=e!==void 0?e:200;const n=t||0,r=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(r),a=this.constraints_.resolution(this.targetResolution_,n,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,r,o));if(e===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=r,this.targetCenter_=l,this.applyTargetState_();return}i=i||(e===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==r||!this.getCenterInternal()||!ts(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:l,resolution:a,duration:e,easing:Xi,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(we.INTERACTING,1)}endInteraction(e,t,i){i=i&&dt(i,this.getProjection()),this.endInteractionInternal(e,t,i)}endInteractionInternal(e,t,i){this.getInteracting()&&(this.setHint(we.INTERACTING,-1),this.resolveConstraints(e,t,i))}getConstrainedCenter(e,t){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),i)}getConstrainedZoom(e,t){const i=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(i,t))}getConstrainedResolution(e,t){t=t||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,i)}}function kn(s,e){setTimeout(function(){s(e)},0)}function Jc(s){if(s.extent!==void 0){const t=s.smoothExtentConstraint!==void 0?s.smoothExtentConstraint:!0;return Go(s.extent,s.constrainOnlyCenter,t)}const e=Xr(s.projection,"EPSG:3857");if(s.multiWorld!==!0&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,Go(t,!1,!1)}return Yh}function Qc(s){let e,t,i,o=s.minZoom!==void 0?s.minZoom:js,a=s.maxZoom!==void 0?s.maxZoom:28;const l=s.zoomFactor!==void 0?s.zoomFactor:2,h=s.multiWorld!==void 0?s.multiWorld:!1,c=s.smoothResolutionConstraint!==void 0?s.smoothResolutionConstraint:!0,u=s.showFullExtent!==void 0?s.showFullExtent:!1,d=Xr(s.projection,"EPSG:3857"),f=d.getExtent();let g=s.constrainOnlyCenter,m=s.extent;if(!h&&!m&&d.isGlobal()&&(g=!1,m=f),s.resolutions!==void 0){const _=s.resolutions;t=_[o],i=_[a]!==void 0?_[a]:_[_.length-1],s.constrainResolution?e=Kc(_,c,!g&&m,u):e=ta(t,i,c,!g&&m,u)}else{const p=(f?Math.max(Q(f),ve(f)):360*kr.degrees/d.getMetersPerUnit())/to/Math.pow(2,js),y=p/Math.pow(2,28-js);t=s.maxResolution,t!==void 0?o=0:t=p/Math.pow(l,o),i=s.minResolution,i===void 0&&(s.maxZoom!==void 0?s.maxResolution!==void 0?i=t/Math.pow(l,a):i=p/Math.pow(l,a):i=y),a=o+Math.floor(Math.log(t/i)/Math.log(l)),i=t/Math.pow(l,a-o),s.constrainResolution?e=Vc(l,t,i,c,!g&&m,u):e=ta(t,i,c,!g&&m,u)}return{constraint:e,maxResolution:t,minResolution:i,minZoom:o,zoomFactor:l}}function eu(s){if(s.enableRotation!==void 0?s.enableRotation:!0){const t=s.constrainRotation;return t===void 0||t===!0?qc():t===!1?ia:typeof t=="number"?Hc(t):ia}return eo}function tu(s){return!(s.sourceCenter&&s.targetCenter&&!ts(s.sourceCenter,s.targetCenter)||s.sourceResolution!==s.targetResolution||s.sourceRotation!==s.targetRotation)}function Zs(s,e,t,i,n){const r=Math.cos(-n);let o=Math.sin(-n),a=s[0]*r-s[1]*o,l=s[1]*r+s[0]*o;a+=(e[0]/2-t[0])*i,l+=(t[1]-e[1]/2)*i,o=-o;const h=a*r-l*o,c=l*r+a*o;return[h,c]}const Nn="ol-hidden",iu="ol-selectable",Is="ol-unselectable",io="ol-control",na="ol-collapsed",nu=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),sa=["style","variant","weight","size","lineHeight","family"],Rl=function(s){const e=s.match(nu);if(!e)return null;const t={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let i=0,n=sa.length;i<n;++i){const r=e[i+1];r!==void 0&&(t[sa[i]]=r)}return t.families=t.family.split(/,\s?/),t};function ue(s,e,t,i){let n;return t&&t.length?n=t.shift():Ua?n=new OffscreenCanvas(s||300,e||300):n=document.createElement("canvas"),s&&(n.width=s),e&&(n.height=e),n.getContext("2d",i)}let Us;function rs(){return Us||(Us=ue(1,1)),Us}function bs(s){const e=s.canvas;e.width=1,e.height=1,s.clearRect(0,0,1,1)}function su(s){let e=s.offsetWidth;const t=getComputedStyle(s);return e+=parseInt(t.marginLeft,10)+parseInt(t.marginRight,10),e}function ru(s){let e=s.offsetHeight;const t=getComputedStyle(s);return e+=parseInt(t.marginTop,10)+parseInt(t.marginBottom,10),e}function ra(s,e){const t=e.parentNode;t&&t.replaceChild(s,e)}function Sl(s){for(;s.lastChild;)s.lastChild.remove()}function ou(s,e){const t=s.childNodes;for(let i=0;;++i){const n=t[i],r=e[i];if(!n&&!r)break;if(n!==r){if(!n){s.appendChild(r);continue}if(!r){s.removeChild(n),--i;continue}s.insertBefore(r,n)}}}class no extends Je{constructor(e){super();const t=e.element;t&&!e.target&&!t.style.pointerEvents&&(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){var e;(e=this.element)==null||e.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(e){var t;this.map_&&((t=this.element)==null||t.remove());for(let i=0,n=this.listenerKeys.length;i<n;++i)ee(this.listenerKeys[i]);if(this.listenerKeys.length=0,this.map_=e,e){const i=this.target_??e.getOverlayContainerStopEvent();this.element&&i.appendChild(this.element),this.render!==Pi&&this.listenerKeys.push(K(e,gt.POSTRENDER,this.render,this)),e.render()}}render(e){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}}class au extends no{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.attributions_=e.attributions;const t=e.className!==void 0?e.className:"ol-attribution",i=e.tipLabel!==void 0?e.tipLabel:"Attributions",n=e.expandClassName!==void 0?e.expandClassName:t+"-expand",r=e.collapseLabel!==void 0?e.collapseLabel:"›",o=e.collapseClassName!==void 0?e.collapseClassName:t+"-collapse";typeof r=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r,this.collapseLabel_.className=o):this.collapseLabel_=r;const a=e.label!==void 0?e.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=n):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(W.CLICK,this.handleClick_.bind(this),!1);const h=t+" "+Is+" "+io+(this.collapsed_&&this.collapsible_?" "+na:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=h,c.appendChild(this.toggleButton_),c.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t=this.getMap().getAllLayers(),i=new Set(t.flatMap(n=>n.getAttributions(e)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(n=>i.add(n)):i.add(this.attributions_)),!this.overrideCollapsible_){const n=!t.some(r=>{var o;return((o=r.getSource())==null?void 0:o.getAttributionsCollapsible())===!1});this.setCollapsible(n)}return Array.from(i)}async updateElement_(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=await Promise.all(this.collectSourceAttributions_(e).map(n=>Ah(()=>n))),i=t.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!Wt(t,this.renderedAttributions_)){Sl(this.ulElement_);for(let n=0,r=t.length;n<r;++n){const o=document.createElement("li");o.innerHTML=t[n],this.ulElement_.appendChild(o)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(na),this.collapsed_?ra(this.collapseLabel_,this.label_):ra(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}}class lu extends no{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const t=e.className!==void 0?e.className:"ol-rotate",i=e.label!==void 0?e.label:"⇧",n=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof i=="string"?(this.label_=document.createElement("span"),this.label_.className=n,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(n));const r=e.tipLabel?e.tipLabel:"Reset rotation",o=document.createElement("button");o.className=t+"-reset",o.setAttribute("type","button"),o.title=r,o.appendChild(this.label_),o.addEventListener(W.CLICK,this.handleClick_.bind(this),!1);const a=t+" "+Is+" "+io,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Nn)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const i=t.getRotation();i!==void 0&&(this.duration_>0&&i%(2*Math.PI)!==0?t.animate({rotation:0,duration:this.duration_,easing:Xi}):t.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const i=t.viewState.rotation;if(i!=this.rotation_){const n="rotate("+i+"rad)";if(this.autoHide_){const r=this.element.classList.contains(Nn);!r&&i===0?this.element.classList.add(Nn):r&&i!==0&&this.element.classList.remove(Nn)}this.label_.style.transform=n}this.rotation_=i}}class hu extends no{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const t=e.className!==void 0?e.className:"ol-zoom",i=e.delta!==void 0?e.delta:1,n=e.zoomInClassName!==void 0?e.zoomInClassName:t+"-in",r=e.zoomOutClassName!==void 0?e.zoomOutClassName:t+"-out",o=e.zoomInLabel!==void 0?e.zoomInLabel:"+",a=e.zoomOutLabel!==void 0?e.zoomOutLabel:"–",l=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",h=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=n,c.setAttribute("type","button"),c.title=l,c.appendChild(typeof o=="string"?document.createTextNode(o):o),c.addEventListener(W.CLICK,this.handleClick_.bind(this,i),!1);const u=document.createElement("button");u.className=r,u.setAttribute("type","button"),u.title=h,u.appendChild(typeof a=="string"?document.createTextNode(a):a),u.addEventListener(W.CLICK,this.handleClick_.bind(this,-i),!1);const d=t+" "+Is+" "+io,f=this.element;f.className=d,f.appendChild(c),f.appendChild(u),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const i=this.getMap().getView();if(!i)return;const n=i.getZoom();if(n!==void 0){const r=i.getConstrainedZoom(n+e);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:r,duration:this.duration_,easing:Xi})):i.setZoom(r)}}}function cu(s){s=s||{};const e=new He;return(s.zoom!==void 0?s.zoom:!0)&&e.push(new hu(s.zoomOptions)),(s.rotate!==void 0?s.rotate:!0)&&e.push(new lu(s.rotateOptions)),(s.attribution!==void 0?s.attribution:!0)&&e.push(new au(s.attributionOptions)),e}class uu{constructor(e,t,i){this.decay_=e,this.minVelocity_=t,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let i=t-3;for(;i>0&&this.points_[i+2]>e;)i-=3;const n=this.points_[t+2]-this.points_[i+2];if(n<1e3/60)return!1;const r=this.points_[t]-this.points_[i],o=this.points_[t+1]-this.points_[i+1];return this.angle_=Math.atan2(o,r),this.initialVelocity_=Math.sqrt(r*r+o*o)/n,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const oa={ACTIVE:"active"};class Yi extends Je{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(oa.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(oa.ACTIVE,e)}setMap(e){this.map_=e}}function du(s,e,t){const i=s.getCenterInternal();if(i){const n=[i[0]+e[0],i[1]+e[1]];s.animateInternal({duration:t!==void 0?t:250,easing:$h,center:s.getConstrainedCenter(n)})}}function so(s,e,t,i){const n=s.getZoom();if(n===void 0)return;const r=s.getConstrainedZoom(n+e),o=s.getResolutionForZoom(r);s.getAnimating()&&s.cancelAnimations(),s.animate({resolution:o,anchor:t,duration:i!==void 0?i:250,easing:Xi})}class fu extends Yi{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let t=!1;if(e.type==ie.DBLCLICK){const i=e.originalEvent,n=e.map,r=e.coordinate,o=i.shiftKey?-this.delta_:this.delta_,a=n.getView();so(a,o,r,this.duration_),i.preventDefault(),t=!0}return!t}}function xr(s){const e=arguments;return function(t){let i=!0;for(let n=0,r=e.length;n<r&&(i=i&&e[n](t),!!i);++n);return i}}const gu=function(s){const e=s.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},mu=function(s){const e=s.map.getTargetElement(),t=e.getRootNode(),i=s.map.getOwnerDocument().activeElement;return t instanceof ShadowRoot?t.host.contains(i):e.contains(i)},Tl=function(s){const e=s.map.getTargetElement(),t=e.getRootNode();return(t instanceof ShadowRoot?t.host:e).hasAttribute("tabindex")?mu(s):!0},_u=ti,Il=function(s){const e=s.originalEvent;return e.button==0&&!(Dh&&ja&&e.ctrlKey)},aa=wn,bl=function(s){return s.type==ie.SINGLECLICK},Al=function(s){const e=s.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},pu=function(s){const e=s.originalEvent;return ja?e.metaKey:e.ctrlKey},Ml=function(s){const e=s.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Ll=function(s){const e=s.originalEvent,t=e.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"&&!e.target.isContentEditable},Bs=function(s){const e=s.originalEvent;return q(e!==void 0,"mapBrowserEvent must originate from a pointer event"),e.pointerType=="mouse"},yu=function(s){const e=s.originalEvent;return q(e!==void 0,"mapBrowserEvent must originate from a pointer event"),e.isPrimary&&e.button===0};class Rn extends Yi{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==ie.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==ie.POINTERUP){const i=this.handleUpEvent(e);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(e.type==ie.POINTERDOWN){const i=this.handleDownEvent(e);this.handlingDownUpSequence=i,t=this.stopDown(i)}else e.type==ie.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function ro(s){const e=s.length;let t=0,i=0;for(let n=0;n<e;n++)t+=s[n].clientX,i+=s[n].clientY;return{clientX:t/e,clientY:i/e}}class wu extends Rn{constructor(e){super({stopDown:wn}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:xr(Al,yu);this.condition_=e.onFocusOnly?xr(Tl,t):t,this.noKinetic_=!1}handleDragEvent(e){const t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());const i=this.targetPointers,n=t.getEventPixel(ro(i));if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(n[0],n[1]),this.lastCentroid){const r=[this.lastCentroid[0]-n[0],n[1]-this.lastCentroid[1]],a=e.map.getView();Vh(r,a.getResolution()),Dr(r,a.getRotation()),a.adjustCenterInternal(r)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=n,this.lastPointersCount_=i.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,i=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const n=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),o=i.getCenterInternal(),a=t.getPixelFromCoordinateInternal(o),l=t.getCoordinateFromPixelInternal([a[0]-n*Math.cos(r),a[1]-n*Math.sin(r)]);i.animateInternal({center:i.getConstrainedCenter(l),duration:500,easing:Xi})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const i=e.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class Eu extends Rn{constructor(e){e=e||{},super({stopDown:wn}),this.condition_=e.condition?e.condition:gu,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!Bs(e))return;const t=e.map,i=t.getView();if(i.getConstraints().rotation===eo)return;const n=t.getSize(),r=e.pixel,o=Math.atan2(n[1]/2-r[1],r[0]-n[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;i.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(e){return Bs(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return Bs(e)&&Il(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class xu extends _s{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,i="px",n=this.element_.style;n.left=Math.min(e[0],t[0])+i,n.top=Math.min(e[1],t[1])+i,n.width=Math.abs(t[0]-e[0])+i,n.height=Math.abs(t[1]-e[1])+i}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const e=this.startPixel_,t=this.endPixel_,n=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);n[4]=n[0].slice(),this.geometry_?this.geometry_.setCoordinates([n]):this.geometry_=new Gt([n])}getGeometry(){return this.geometry_}}const gi={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class Hi extends rt{constructor(e,t,i){super(e),this.coordinate=t,this.mapBrowserEvent=i}}class Cu extends Rn{constructor(e){super(),this.on,this.once,this.un,e=e??{},this.box_=new xu(e.className||"ol-dragbox"),this.minArea_=e.minArea??64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition??Il,this.boxEndCondition_=e.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,i){const n=i[0]-t[0],r=i[1]-t[1];return n*n+r*r>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.startPixel_&&(this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new Hi(gi.BOXDRAG,e.coordinate,e)))}handleUpEvent(e){if(!this.startPixel_)return!1;const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new Hi(t?gi.BOXEND:gi.BOXCANCEL,e.coordinate,e)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Hi(gi.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}setActive(e){e||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new Hi(gi.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(e)}setMap(e){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new Hi(gi.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(e)}}class vu extends Cu{constructor(e){e=e||{};const t=e.condition?e.condition:Ml;super({condition:t,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1}onBoxEnd(e){const i=this.getMap().getView();let n=this.getGeometry();if(this.out_){const r=i.rotatedExtentForGeometry(n),o=i.getResolutionForExtentInternal(r),a=i.getResolution()/o;n=n.clone(),n.scale(a*a)}i.fitInternal(n,{duration:this.duration_,easing:Xi})}}const Kt={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class Ru extends Yi{constructor(e){super(),e=e||{},this.defaultCondition_=function(t){return Al(t)&&Ll(t)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==W.KEYDOWN){const i=e.originalEvent,n=i.key;if(this.condition_(e)&&(n==Kt.DOWN||n==Kt.LEFT||n==Kt.RIGHT||n==Kt.UP)){const o=e.map.getView(),a=o.getResolution()*this.pixelDelta_;let l=0,h=0;n==Kt.DOWN?h=-a:n==Kt.LEFT?l=-a:n==Kt.RIGHT?l=a:h=a;const c=[l,h];Dr(c,o.getRotation()),du(o,c,this.duration_),i.preventDefault(),t=!0}}return!t}}class Su extends Yi{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(t){return!pu(t)&&Ll(t)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let t=!1;if(e.type==W.KEYDOWN||e.type==W.KEYPRESS){const i=e.originalEvent,n=i.key;if(this.condition_(e)&&(n==="+"||n==="-")){const r=e.map,o=n==="+"?this.delta_:-this.delta_,a=r.getView();so(a,o,void 0,this.duration_),i.preventDefault(),t=!0}}return!t}}class Tu extends Yi{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution!==void 0?e.constrainResolution:!1;const t=e.condition?e.condition:_u;this.condition_=e.onFocusOnly?xr(Tl,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();if(!e)return;e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(e){if(!this.condition_(e)||e.type!==W.WHEEL)return!0;const i=e.map,n=e.originalEvent;n.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.pixel);let r;if(e.type==W.WHEEL&&(r=n.deltaY,Fh&&n.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(r/=Za),n.deltaMode===WheelEvent.DOM_DELTA_LINE&&(r*=40)),r===0)return!1;this.lastDelta_=r;const o=Date.now();this.startTime_===void 0&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?"trackpad":"wheel");const a=i.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-r/this.deltaPerZoom_,this.lastAnchor_?i.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=o,!1;this.totalDelta_+=r;const l=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),l),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let i=-re(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),so(t,i,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}}class Iu extends Rn{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=wn),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let t=0;const i=this.targetPointers[0],n=this.targetPointers[1],r=Math.atan2(n.clientY-i.clientY,n.clientX-i.clientX);if(this.lastAngle_!==void 0){const l=r-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=l}this.lastAngle_=r;const o=e.map,a=o.getView();a.getConstraints().rotation!==eo&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(ro(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}class bu extends Rn{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=wn),super(t),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const i=this.targetPointers[0],n=this.targetPointers[1],r=i.clientX-n.clientX,o=i.clientY-n.clientY,a=Math.sqrt(r*r+o*o);this.lastDistance_!==void 0&&(t=this.lastDistance_/a),this.lastDistance_=a;const l=e.map,h=l.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(ro(this.targetPointers))),l.render(),h.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const i=e.map.getView(),n=this.lastScaleDelta_>1?1:-1;return i.endInteraction(this.duration_,n),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}function Au(s){s=s||{};const e=new He,t=new uu(-.005,.05,100);return(s.altShiftDragRotate!==void 0?s.altShiftDragRotate:!0)&&e.push(new Eu),(s.doubleClickZoom!==void 0?s.doubleClickZoom:!0)&&e.push(new fu({delta:s.zoomDelta,duration:s.zoomDuration})),(s.dragPan!==void 0?s.dragPan:!0)&&e.push(new wu({onFocusOnly:s.onFocusOnly,kinetic:t})),(s.pinchRotate!==void 0?s.pinchRotate:!0)&&e.push(new Iu),(s.pinchZoom!==void 0?s.pinchZoom:!0)&&e.push(new bu({duration:s.zoomDuration})),(s.keyboard!==void 0?s.keyboard:!0)&&(e.push(new Ru),e.push(new Su({delta:s.zoomDelta,duration:s.zoomDuration}))),(s.mouseWheelZoom!==void 0?s.mouseWheelZoom:!0)&&e.push(new Tu({onFocusOnly:s.onFocusOnly,duration:s.zoomDuration})),(s.shiftDragZoom!==void 0?s.shiftDragZoom:!0)&&e.push(new vu({duration:s.zoomDuration})),e}const J={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class Pl extends Je{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[J.OPACITY]=e.opacity!==void 0?e.opacity:1,q(typeof t[J.OPACITY]=="number","Layer opacity must be a number"),t[J.VISIBLE]=e.visible!==void 0?e.visible:!0,t[J.Z_INDEX]=e.zIndex,t[J.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,t[J.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,t[J.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,t[J.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=t.className!==void 0?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:e===void 0?!0:e},i=this.getZIndex();return t.opacity=re(Math.round(this.getOpacity()*100)/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=i===void 0&&!t.managed?1/0:i,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return N()}getLayerStatesArray(e){return N()}getExtent(){return this.get(J.EXTENT)}getMaxResolution(){return this.get(J.MAX_RESOLUTION)}getMinResolution(){return this.get(J.MIN_RESOLUTION)}getMinZoom(){return this.get(J.MIN_ZOOM)}getMaxZoom(){return this.get(J.MAX_ZOOM)}getOpacity(){return this.get(J.OPACITY)}getSourceState(){return N()}getVisible(){return this.get(J.VISIBLE)}getZIndex(){return this.get(J.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(J.EXTENT,e)}setMaxResolution(e){this.set(J.MAX_RESOLUTION,e)}setMinResolution(e){this.set(J.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(J.MAX_ZOOM,e)}setMinZoom(e){this.set(J.MIN_ZOOM,e)}setOpacity(e){q(typeof e=="number","Layer opacity must be a number"),this.set(J.OPACITY,e)}setVisible(e){this.set(J.VISIBLE,e)}setZIndex(e){this.set(J.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}class At extends rt{constructor(e,t){super(e),this.layer=t}}const Ks={LAYERS:"layers"};class ji extends Pl{constructor(e){e=e||{};const t=Object.assign({},e);delete t.layers;let i=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Ks.LAYERS,this.handleLayersChanged_),i?Array.isArray(i)?i=new He(i.slice(),{unique:!0}):q(typeof i.getArray=="function","Expected `layers` to be an array or a `Collection`"):i=new He(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(ee),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(K(e,ce.ADD,this.handleLayersAdd_,this),K(e,ce.REMOVE,this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(ee);zi(this.listenerKeys_);const t=e.getArray();for(let i=0,n=t.length;i<n;i++){const r=t[i];this.registerLayerListeners_(r),this.dispatchEvent(new At("addlayer",r))}this.changed()}registerLayerListeners_(e){const t=[K(e,Li.PROPERTYCHANGE,this.handleLayerChange_,this),K(e,W.CHANGE,this.handleLayerChange_,this)];e instanceof ji&&t.push(K(e,"addlayer",this.handleLayerGroupAdd_,this),K(e,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[U(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new At("addlayer",e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new At("removelayer",e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new At("addlayer",t)),this.changed()}handleLayersRemove_(e){const t=e.element,i=U(t);this.listenerKeys_[i].forEach(ee),delete this.listenerKeys_[i],this.dispatchEvent(new At("removelayer",t)),this.changed()}getLayers(){return this.get(Ks.LAYERS)}setLayers(e){const t=this.getLayers();if(t){const i=t.getArray();for(let n=0,r=i.length;n<r;++n)this.dispatchEvent(new At("removelayer",i[n]))}this.set(Ks.LAYERS,e)}getLayersArray(e){return e=e!==void 0?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){const t=e!==void 0?e:[],i=t.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(t)});const n=this.getLayerState();let r=n.zIndex;!e&&n.zIndex===void 0&&(r=0);for(let o=i,a=t.length;o<a;o++){const l=t[o];l.opacity*=n.opacity,l.visible=l.visible&&n.visible,l.maxResolution=Math.min(l.maxResolution,n.maxResolution),l.minResolution=Math.max(l.minResolution,n.minResolution),l.minZoom=Math.max(l.minZoom,n.minZoom),l.maxZoom=Math.min(l.maxZoom,n.maxZoom),n.extent!==void 0&&(l.extent!==void 0?l.extent=ei(l.extent,n.extent):l.extent=n.extent),l.zIndex===void 0&&(l.zIndex=r)}return t}getSourceState(){return"ready"}}const Ye={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};class As extends Pl{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(J.SOURCE,this.handleSourcePropertyChange_);const i=e.source?e.source:null;this.setSource(i)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(J.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(ee(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=K(e,W.CHANGE,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0)),this.clearRenderer()),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}isVisible(e){let t;const i=this.getMapInternal();!e&&i&&(e=i.getView()),e instanceof it?t={viewState:e.getState(),extent:e.calculateExtent()}:t=e,!t.layerStatesArray&&i&&(t.layerStatesArray=i.getLayerGroup().getLayerStatesArray());let n;if(t.layerStatesArray){if(n=t.layerStatesArray.find(o=>o.layer===this),!n)return!1}else n=this.getLayerState();const r=this.getExtent();return oo(n,t.viewState)&&(!r||Ae(r,t.extent))}getAttributions(e){var r;if(!this.isVisible(e))return[];const t=(r=this.getSource())==null?void 0:r.getAttributions();if(!t)return[];const i=e instanceof it?e.getViewStateAndExtent():e;let n=t(i);return Array.isArray(n)||(n=[n]),n}render(e,t){const i=this.getRenderer();return i.prepareFrame(e)?(this.rendered=!0,i.renderFrame(e,t)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(e,t){}renderDeferred(e){const t=this.getRenderer();t&&t.renderDeferred(e)}setMapInternal(e){e||this.unrender(),this.set(J.MAP,e)}getMapInternal(){return this.get(J.MAP)}setMap(e){this.mapPrecomposeKey_&&(ee(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(ee(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=K(e,Ye.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=K(this,W.CHANGE,e.render,e),this.changed())}handlePrecompose_(e){const t=e.frameState.layerStatesArray,i=this.getLayerState(!1);q(!t.some(n=>n.layer===i.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),t.push(i)}setSource(e){this.set(J.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}}function oo(s,e){if(!s.visible)return!1;const t=e.resolution;if(t<s.minResolution||t>=s.maxResolution)return!1;const i=e.zoom;return i>s.minZoom&&i<=s.maxZoom}function Mu(s,e,t,i,n){Fl(s,e,t||0,i||s.length-1,n||Lu)}function Fl(s,e,t,i,n){for(;i>t;){if(i-t>600){var r=i-t+1,o=e-t+1,a=Math.log(r),l=.5*Math.exp(2*a/3),h=.5*Math.sqrt(a*l*(r-l)/r)*(o-r/2<0?-1:1),c=Math.max(t,Math.floor(e-o*l/r+h)),u=Math.min(i,Math.floor(e+(r-o)*l/r+h));Fl(s,e,c,u,n)}var d=s[e],f=t,g=i;for(qi(s,t,e),n(s[i],d)>0&&qi(s,t,i);f<g;){for(qi(s,f,g),f++,g--;n(s[f],d)<0;)f++;for(;n(s[g],d)>0;)g--}n(s[t],d)===0?qi(s,t,g):(g++,qi(s,g,i)),g<=e&&(t=g+1),e<=g&&(i=g-1)}}function qi(s,e,t){var i=s[e];s[e]=s[t],s[t]=i}function Lu(s,e){return s<e?-1:s>e?1:0}let Ol=class{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const i=[];if(!Wn(e,t))return i;const n=this.toBBox,r=[];for(;t;){for(let o=0;o<t.children.length;o++){const a=t.children[o],l=t.leaf?n(a):a;Wn(e,l)&&(t.leaf?i.push(a):Hs(e,l)?this._all(a,i):r.push(a))}t=r.pop()}return i}collides(e){let t=this.data;if(!Wn(e,t))return!1;const i=[];for(;t;){for(let n=0;n<t.children.length;n++){const r=t.children[n],o=t.leaf?this.toBBox(r):r;if(Wn(e,o)){if(t.leaf||Hs(e,o))return!0;i.push(r)}}t=i.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let i=0;i<e.length;i++)this.insert(e[i]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const i=this.data;this.data=t,t=i}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=xi([]),this}remove(e,t){if(!e)return this;let i=this.data;const n=this.toBBox(e),r=[],o=[];let a,l,h;for(;i||r.length;){if(i||(i=r.pop(),l=r[r.length-1],a=o.pop(),h=!0),i.leaf){const c=Pu(e,i.children,t);if(c!==-1)return i.children.splice(c,1),r.push(i),this._condense(r),this}!h&&!i.leaf&&Hs(i,n)?(r.push(i),o.push(a),a=0,l=i,i=i.children[0]):l?(a++,i=l.children[a],h=!1):i=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const i=[];for(;e;)e.leaf?t.push(...e.children):i.push(...e.children),e=i.pop();return t}_build(e,t,i,n){const r=i-t+1;let o=this._maxEntries,a;if(r<=o)return a=xi(e.slice(t,i+1)),mi(a,this.toBBox),a;n||(n=Math.ceil(Math.log(r)/Math.log(o)),o=Math.ceil(r/Math.pow(o,n-1))),a=xi([]),a.leaf=!1,a.height=n;const l=Math.ceil(r/o),h=l*Math.ceil(Math.sqrt(o));la(e,t,i,h,this.compareMinX);for(let c=t;c<=i;c+=h){const u=Math.min(c+h-1,i);la(e,c,u,l,this.compareMinY);for(let d=c;d<=u;d+=l){const f=Math.min(d+l-1,u);a.children.push(this._build(e,d,f,n-1))}}return mi(a,this.toBBox),a}_chooseSubtree(e,t,i,n){for(;n.push(t),!(t.leaf||n.length-1===i);){let r=1/0,o=1/0,a;for(let l=0;l<t.children.length;l++){const h=t.children[l],c=Vs(h),u=Du(e,h)-c;u<o?(o=u,r=c<r?c:r,a=h):u===o&&c<r&&(r=c,a=h)}t=a||t.children[0]}return t}_insert(e,t,i){const n=i?e:this.toBBox(e),r=[],o=this._chooseSubtree(n,this.data,t,r);for(o.children.push(e),en(o,n);t>=0&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(n,r,t)}_split(e,t){const i=e[t],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);const o=this._chooseSplitIndex(i,r,n),a=xi(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,mi(i,this.toBBox),mi(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(i,a)}_splitRoot(e,t){this.data=xi([e,t]),this.data.height=e.height+1,this.data.leaf=!1,mi(this.data,this.toBBox)}_chooseSplitIndex(e,t,i){let n,r=1/0,o=1/0;for(let a=t;a<=i-t;a++){const l=Qi(e,0,a,this.toBBox),h=Qi(e,a,i,this.toBBox),c=ku(l,h),u=Vs(l)+Vs(h);c<r?(r=c,n=a,o=u<o?u:o):c===r&&u<o&&(o=u,n=a)}return n||i-t}_chooseSplitAxis(e,t,i){const n=e.leaf?this.compareMinX:Fu,r=e.leaf?this.compareMinY:Ou,o=this._allDistMargin(e,t,i,n),a=this._allDistMargin(e,t,i,r);o<a&&e.children.sort(n)}_allDistMargin(e,t,i,n){e.children.sort(n);const r=this.toBBox,o=Qi(e,0,t,r),a=Qi(e,i-t,i,r);let l=Gn(o)+Gn(a);for(let h=t;h<i-t;h++){const c=e.children[h];en(o,e.leaf?r(c):c),l+=Gn(o)}for(let h=i-t-1;h>=t;h--){const c=e.children[h];en(a,e.leaf?r(c):c),l+=Gn(a)}return l}_adjustParentBBoxes(e,t,i){for(let n=i;n>=0;n--)en(t[n],e)}_condense(e){for(let t=e.length-1,i;t>=0;t--)e[t].children.length===0?t>0?(i=e[t-1].children,i.splice(i.indexOf(e[t]),1)):this.clear():mi(e[t],this.toBBox)}};function Pu(s,e,t){if(!t)return e.indexOf(s);for(let i=0;i<e.length;i++)if(t(s,e[i]))return i;return-1}function mi(s,e){Qi(s,0,s.children.length,e,s)}function Qi(s,e,t,i,n){n||(n=xi(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let r=e;r<t;r++){const o=s.children[r];en(n,s.leaf?i(o):o)}return n}function en(s,e){return s.minX=Math.min(s.minX,e.minX),s.minY=Math.min(s.minY,e.minY),s.maxX=Math.max(s.maxX,e.maxX),s.maxY=Math.max(s.maxY,e.maxY),s}function Fu(s,e){return s.minX-e.minX}function Ou(s,e){return s.minY-e.minY}function Vs(s){return(s.maxX-s.minX)*(s.maxY-s.minY)}function Gn(s){return s.maxX-s.minX+(s.maxY-s.minY)}function Du(s,e){return(Math.max(e.maxX,s.maxX)-Math.min(e.minX,s.minX))*(Math.max(e.maxY,s.maxY)-Math.min(e.minY,s.minY))}function ku(s,e){const t=Math.max(s.minX,e.minX),i=Math.max(s.minY,e.minY),n=Math.min(s.maxX,e.maxX),r=Math.min(s.maxY,e.maxY);return Math.max(0,n-t)*Math.max(0,r-i)}function Hs(s,e){return s.minX<=e.minX&&s.minY<=e.minY&&e.maxX<=s.maxX&&e.maxY<=s.maxY}function Wn(s,e){return e.minX<=s.maxX&&e.minY<=s.maxY&&e.maxX>=s.minX&&e.maxY>=s.minY}function xi(s){return{children:s,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function la(s,e,t,i,n){const r=[e,t];for(;r.length;){if(t=r.pop(),e=r.pop(),t-e<=i)continue;const o=e+Math.ceil((t-e)/i/2)*i;Mu(s,o,e,t,n),r.push(e,o,o,t)}}function Nu(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var qs,ha;function Gu(){return ha||(ha=1,qs={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}),qs}var Wu=Gu();const ca=Nu(Wu);var ua={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function zu(s){var c,u;var e,t=[],i=1,n;if(typeof s=="number")return{space:"rgb",values:[s>>>16,(s&65280)>>>8,s&255],alpha:1};if(typeof s=="number")return{space:"rgb",values:[s>>>16,(s&65280)>>>8,s&255],alpha:1};if(s=String(s).toLowerCase(),ca[s])t=ca[s].slice(),n="rgb";else if(s==="transparent")i=0,n="rgb",t=[0,0,0];else if(s[0]==="#"){var r=s.slice(1),o=r.length,a=o<=4;i=1,a?(t=[parseInt(r[0]+r[0],16),parseInt(r[1]+r[1],16),parseInt(r[2]+r[2],16)],o===4&&(i=parseInt(r[3]+r[3],16)/255)):(t=[parseInt(r[0]+r[1],16),parseInt(r[2]+r[3],16),parseInt(r[4]+r[5],16)],o===8&&(i=parseInt(r[6]+r[7],16)/255)),t[0]||(t[0]=0),t[1]||(t[1]=0),t[2]||(t[2]=0),n="rgb"}else if(e=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(s)){var l=e[1];n=l.replace(/a$/,"");var h=n==="cmyk"?4:n==="gray"?1:3;t=e[2].trim().split(/\s*[,\/]\s*|\s+/),n==="color"&&(n=t.shift()),t=t.map(function(d,f){if(d[d.length-1]==="%")return d=parseFloat(d)/100,f===3?d:n==="rgb"?d*255:n[0]==="h"||n[0]==="l"&&!f?d*100:n==="lab"?d*125:n==="lch"?f<2?d*150:d*360:n[0]==="o"&&!f?d:n==="oklab"?d*.4:n==="oklch"?f<2?d*.4:d*360:d;if(n[f]==="h"||f===2&&n[n.length-1]==="h"){if(ua[d]!==void 0)return ua[d];if(d.endsWith("deg"))return parseFloat(d);if(d.endsWith("turn"))return parseFloat(d)*360;if(d.endsWith("grad"))return parseFloat(d)*360/400;if(d.endsWith("rad"))return parseFloat(d)*180/Math.PI}return d==="none"?0:parseFloat(d)}),i=t.length>h?t.pop():1}else/[0-9](?:\s|\/|,)/.test(s)&&(t=s.match(/([0-9]+)/g).map(function(d){return parseFloat(d)}),n=((u=(c=s.match(/([a-z])/ig))==null?void 0:c.join(""))==null?void 0:u.toLowerCase())||"rgb");return{space:n,values:t,alpha:i}}const dn={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]},$s={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(s){var e=s[0]/360,t=s[1]/100,i=s[2]/100,n,r,o,a,l,h=0;if(t===0)return l=i*255,[l,l,l];for(r=i<.5?i*(1+t):i+t-i*t,n=2*i-r,a=[0,0,0];h<3;)o=e+1/3*-(h-1),o<0?o++:o>1&&o--,l=6*o<1?n+(r-n)*6*o:2*o<1?r:3*o<2?n+(r-n)*(2/3-o)*6:n,a[h++]=l*255;return a}};dn.hsl=function(s){var e=s[0]/255,t=s[1]/255,i=s[2]/255,n=Math.min(e,t,i),r=Math.max(e,t,i),o=r-n,a,l,h;return r===n?a=0:e===r?a=(t-i)/o:t===r?a=2+(i-e)/o:i===r&&(a=4+(e-t)/o),a=Math.min(a*60,360),a<0&&(a+=360),h=(n+r)/2,r===n?l=0:h<=.5?l=o/(r+n):l=o/(2-r-n),[a,l*100,h*100]};function Xu(s){Array.isArray(s)&&s.raw&&(s=String.raw(...arguments)),s instanceof Number&&(s=+s);var e,t=zu(s);if(!t.space)return[];const i=t.space[0]==="h"?$s.min:dn.min,n=t.space[0]==="h"?$s.max:dn.max;return e=Array(3),e[0]=Math.min(Math.max(t.values[0],i[0]),n[0]),e[1]=Math.min(Math.max(t.values[1],i[1]),n[1]),e[2]=Math.min(Math.max(t.values[2],i[2]),n[2]),t.space[0]==="h"&&(e=$s.rgb(e)),e.push(Math.min(Math.max(t.alpha,0),1)),e}var de={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};de.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}};de.max=de.whitepoint[2].D65;de.rgb=function(s,e){e=e||de.whitepoint[2].E;var t=s[0]/e[0],i=s[1]/e[1],n=s[2]/e[2],r,o,a;return r=t*3.240969941904521+i*-1.537383177570093+n*-.498610760293,o=t*-.96924363628087+i*1.87596750150772+n*.041555057407175,a=t*.055630079696993+i*-.20397695888897+n*1.056971514242878,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:r=r*12.92,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:o=o*12.92,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:a=a*12.92,r=Math.min(Math.max(0,r),1),o=Math.min(Math.max(0,o),1),a=Math.min(Math.max(0,a),1),[r*255,o*255,a*255]};dn.xyz=function(s,e){var t=s[0]/255,i=s[1]/255,n=s[2]/255;t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92;var r=t*.41239079926595+i*.35758433938387+n*.18048078840183,o=t*.21263900587151+i*.71516867876775+n*.072192315360733,a=t*.019330818715591+i*.11919477979462+n*.95053215224966;return e=e||de.whitepoint[2].E,[r*e[0],o*e[1],a*e[2]]};const ao={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(s,e,t){var i,n,r,o,a,l,h,c,u,d,f,g,m;if(r=s[0],o=s[1],a=s[2],r===0)return[0,0,0];var _=.0011070564598794539;return e=e||"D65",t=t||2,u=de.whitepoint[t][e][0],d=de.whitepoint[t][e][1],f=de.whitepoint[t][e][2],g=4*u/(u+15*d+3*f),m=9*d/(u+15*d+3*f),i=o/(13*r)+g||0,n=a/(13*r)+m||0,h=r>8?d*Math.pow((r+16)/116,3):d*r*_,l=h*9*i/(4*n)||0,c=h*(12-3*i-20*n)/(4*n)||0,[l,h,c]}};de.luv=function(s,e,t){var i,n,r,o,a,l,h,c,u,d,f,g,m,_=.008856451679035631,p=903.2962962962961;e=e||"D65",t=t||2,u=de.whitepoint[t][e][0],d=de.whitepoint[t][e][1],f=de.whitepoint[t][e][2],g=4*u/(u+15*d+3*f),m=9*d/(u+15*d+3*f),l=s[0],h=s[1],c=s[2],i=4*l/(l+15*h+3*c)||0,n=9*h/(l+15*h+3*c)||0;var y=h/d;return r=y<=_?p*y:116*Math.pow(y,1/3)-16,o=13*r*(i-g),a=13*r*(n-m),[r,o,a]};var Dl={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(s){var e=s[0],t=s[1],i=s[2],n,r,o;return o=i/360*2*Math.PI,n=t*Math.cos(o),r=t*Math.sin(o),[e,n,r]},xyz:function(s){return ao.xyz(Dl.luv(s))}};ao.lchuv=function(s){var e=s[0],t=s[1],i=s[2],n=Math.sqrt(t*t+i*i),r=Math.atan2(i,t),o=r*360/2/Math.PI;return o<0&&(o+=360),[e,n,o]};de.lchuv=function(s){return ao.lchuv(de.luv(s))};const lo=[NaN,NaN,NaN,0];function Yu(s){return typeof s=="string"?s:co(s)}const ju=1024,$i={};let Js=0;function Zu(s){if(s.length===4)return s;const e=s.slice();return e[3]=1,e}function da(s){const e=de.lchuv(dn.xyz(s));return e[3]=s[3],e}function Uu(s){const e=de.rgb(Dl.xyz(s));return e[3]=s[3],e}function ho(s){if(s==="none")return lo;if($i.hasOwnProperty(s))return $i[s];if(Js>=ju){let t=0;for(const i in $i)(t++&3)===0&&(delete $i[i],--Js)}const e=Xu(s);if(e.length!==4)throw new Error('failed to parse "'+s+'" as color');for(const t of e)if(isNaN(t))throw new Error('failed to parse "'+s+'" as color');return kl(e),$i[s]=e,++Js,e}function ki(s){return Array.isArray(s)?s:ho(s)}function kl(s){return s[0]=re(s[0]+.5|0,0,255),s[1]=re(s[1]+.5|0,0,255),s[2]=re(s[2]+.5|0,0,255),s[3]=re(s[3],0,1),s}function co(s){let e=s[0];e!=(e|0)&&(e=e+.5|0);let t=s[1];t!=(t|0)&&(t=t+.5|0);let i=s[2];i!=(i|0)&&(i=i+.5|0);const n=s[3]===void 0?1:Math.round(s[3]*1e3)/1e3;return"rgba("+e+","+t+","+i+","+n+")"}function fa(s){return s[0]>0&&s[1]>0}function Bu(s,e,t){return t===void 0&&(t=[0,0]),t[0]=s[0]*e+.5|0,t[1]=s[1]*e+.5|0,t}function Le(s,e){return Array.isArray(s)?s:(e===void 0?e=[s,s]:(e[0]=s,e[1]=s),e)}let ci=0;const Ce=1<<ci++,B=1<<ci++,Ie=1<<ci++,Ve=1<<ci++,si=1<<ci++,tn=1<<ci++,zn=Math.pow(2,ci)-1,uo={[Ce]:"boolean",[B]:"number",[Ie]:"string",[Ve]:"color",[si]:"number[]",[tn]:"size"},Ku=Object.keys(uo).map(Number).sort(_t);function Vu(s){return s in uo}function nn(s){const e=[];for(const t of Ku)sn(s,t)&&e.push(uo[t]);return e.length===0?"untyped":e.length<3?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e[e.length-1]}function sn(s,e){return(s&e)===e}function vt(s,e){return s===e}class oe{constructor(e,t){if(!Vu(e))throw new Error(`literal expressions must have a specific type, got ${nn(e)}`);this.type=e,this.value=t}}class Hu{constructor(e,t,...i){this.type=e,this.operator=t,this.args=i}}function Nl(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function fe(s,e,t){switch(typeof s){case"boolean":{if(vt(e,Ie))return new oe(Ie,s?"true":"false");if(!sn(e,Ce))throw new Error(`got a boolean, but expected ${nn(e)}`);return new oe(Ce,s)}case"number":{if(vt(e,tn))return new oe(tn,Le(s));if(vt(e,Ce))return new oe(Ce,!!s);if(vt(e,Ie))return new oe(Ie,s.toString());if(!sn(e,B))throw new Error(`got a number, but expected ${nn(e)}`);return new oe(B,s)}case"string":{if(vt(e,Ve))return new oe(Ve,ho(s));if(vt(e,Ce))return new oe(Ce,!!s);if(!sn(e,Ie))throw new Error(`got a string, but expected ${nn(e)}`);return new oe(Ie,s)}}if(!Array.isArray(s))throw new Error("expression must be an array or a primitive value");if(s.length===0)throw new Error("empty expression");if(typeof s[0]=="string")return od(s,e,t);for(const i of s)if(typeof i!="number")throw new Error("expected an array of numbers");if(vt(e,tn)){if(s.length!==2)throw new Error(`expected an array of two values for a size, got ${s.length}`);return new oe(tn,s)}if(vt(e,Ve)){if(s.length===3)return new oe(Ve,[...s,1]);if(s.length===4)return new oe(Ve,s);throw new Error(`expected an array of 3 or 4 values for a color, got ${s.length}`)}if(!sn(e,si))throw new Error(`got an array of numbers, but expected ${nn(e)}`);return new oe(si,s)}const C={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},qu={[C.Get]:k(X(1,1/0),ga),[C.Var]:k(X(1,1),$u),[C.Has]:k(X(1,1/0),ga),[C.Id]:k(Ju,_i),[C.Concat]:k(X(2,1/0),$(Ie)),[C.GeometryType]:k(Qu,_i),[C.LineMetric]:k(_i),[C.Resolution]:k(Qs,_i),[C.Zoom]:k(Qs,_i),[C.Time]:k(Qs,_i),[C.Any]:k(X(2,1/0),$(Ce)),[C.All]:k(X(2,1/0),$(Ce)),[C.Not]:k(X(1,1),$(Ce)),[C.Equal]:k(X(2,2),$(zn)),[C.NotEqual]:k(X(2,2),$(zn)),[C.GreaterThan]:k(X(2,2),$(B)),[C.GreaterThanOrEqualTo]:k(X(2,2),$(B)),[C.LessThan]:k(X(2,2),$(B)),[C.LessThanOrEqualTo]:k(X(2,2),$(B)),[C.Multiply]:k(X(2,1/0),ma),[C.Coalesce]:k(X(2,1/0),ma),[C.Divide]:k(X(2,2),$(B)),[C.Add]:k(X(2,1/0),$(B)),[C.Subtract]:k(X(2,2),$(B)),[C.Clamp]:k(X(3,3),$(B)),[C.Mod]:k(X(2,2),$(B)),[C.Pow]:k(X(2,2),$(B)),[C.Abs]:k(X(1,1),$(B)),[C.Floor]:k(X(1,1),$(B)),[C.Ceil]:k(X(1,1),$(B)),[C.Round]:k(X(1,1),$(B)),[C.Sin]:k(X(1,1),$(B)),[C.Cos]:k(X(1,1),$(B)),[C.Atan]:k(X(1,2),$(B)),[C.Sqrt]:k(X(1,1),$(B)),[C.Match]:k(X(4,1/0),_a,td),[C.Between]:k(X(3,3),$(B)),[C.Interpolate]:k(X(6,1/0),_a,id),[C.Case]:k(X(3,1/0),ed,nd),[C.In]:k(X(2,2),sd),[C.Number]:k(X(1,1/0),$(zn)),[C.String]:k(X(1,1/0),$(zn)),[C.Array]:k(X(1,1/0),$(B)),[C.Color]:k(X(1,4),$(B)),[C.Band]:k(X(1,3),$(B)),[C.Palette]:k(X(2,2),rd),[C.ToString]:k(X(1,1),$(Ce|B|Ie|Ve))};function ga(s,e,t){const i=s.length-1,n=new Array(i);for(let r=0;r<i;++r){const o=s[r+1];switch(typeof o){case"number":{n[r]=new oe(B,o);break}case"string":{n[r]=new oe(Ie,o);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${o}`)}r===0&&t.properties.add(String(o))}return n}function $u(s,e,t){const i=s[1];if(typeof i!="string")throw new Error("expected a string argument for var operation");return t.variables.add(i),[new oe(Ie,i)]}function Ju(s,e,t){t.featureId=!0}function Qu(s,e,t){t.geometryType=!0}function Qs(s,e,t){t.mapState=!0}function _i(s,e,t){const i=s[0];if(s.length!==1)throw new Error(`expected no arguments for ${i} operation`);return[]}function X(s,e){return function(t,i,n){const r=t[0],o=t.length-1;if(s===e){if(o!==s){const a=s===1?"":"s";throw new Error(`expected ${s} argument${a} for ${r}, got ${o}`)}}else if(o<s||o>e){const a=e===1/0?`${s} or more`:`${s} to ${e}`;throw new Error(`expected ${a} arguments for ${r}, got ${o}`)}}}function ma(s,e,t){const i=s.length-1,n=new Array(i);for(let r=0;r<i;++r){const o=fe(s[r+1],e,t);n[r]=o}return n}function $(s){return function(e,t,i){const n=e.length-1,r=new Array(n);for(let o=0;o<n;++o){const a=fe(e[o+1],s,i);r[o]=a}return r}}function ed(s,e,t){const i=s[0],n=s.length-1;if(n%2===0)throw new Error(`expected an odd number of arguments for ${i}, got ${n} instead`)}function _a(s,e,t){const i=s[0],n=s.length-1;if(n%2===1)throw new Error(`expected an even number of arguments for operation ${i}, got ${n} instead`)}function td(s,e,t){const i=s.length-1,n=Ie|B|Ce,r=fe(s[1],n,t),o=fe(s[s.length-1],e,t),a=new Array(i-2);for(let l=0;l<i-2;l+=2){try{const h=fe(s[l+2],r.type,t);a[l]=h}catch(h){throw new Error(`failed to parse argument ${l+1} of match expression: ${h.message}`)}try{const h=fe(s[l+3],o.type,t);a[l+1]=h}catch(h){throw new Error(`failed to parse argument ${l+2} of match expression: ${h.message}`)}}return[r,...a,o]}function id(s,e,t){const i=s[1];let n;switch(i[0]){case"linear":n=1;break;case"exponential":const l=i[1];if(typeof l!="number"||l<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(l)} instead`);n=l;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(i)}`)}const r=new oe(B,n);let o;try{o=fe(s[2],B,t)}catch(l){throw new Error(`failed to parse argument 1 in interpolate expression: ${l.message}`)}const a=new Array(s.length-3);for(let l=0;l<a.length;l+=2){try{const h=fe(s[l+3],B,t);a[l]=h}catch(h){throw new Error(`failed to parse argument ${l+2} for interpolate expression: ${h.message}`)}try{const h=fe(s[l+4],e,t);a[l+1]=h}catch(h){throw new Error(`failed to parse argument ${l+3} for interpolate expression: ${h.message}`)}}return[r,o,...a]}function nd(s,e,t){const i=fe(s[s.length-1],e,t),n=new Array(s.length-1);for(let r=0;r<n.length-1;r+=2){try{const o=fe(s[r+1],Ce,t);n[r]=o}catch(o){throw new Error(`failed to parse argument ${r} of case expression: ${o.message}`)}try{const o=fe(s[r+2],i.type,t);n[r+1]=o}catch(o){throw new Error(`failed to parse argument ${r+1} of case expression: ${o.message}`)}}return n[n.length-1]=i,n}function sd(s,e,t){let i=s[2];if(!Array.isArray(i))throw new Error('the second argument for the "in" operator must be an array');let n;if(typeof i[0]=="string"){if(i[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(i[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');i=i[1],n=Ie}else n=B;const r=new Array(i.length);for(let a=0;a<r.length;a++)try{const l=fe(i[a],n,t);r[a]=l}catch(l){throw new Error(`failed to parse haystack item ${a} for "in" expression: ${l.message}`)}return[fe(s[1],n,t),...r]}function rd(s,e,t){let i;try{i=fe(s[1],B,t)}catch(o){throw new Error(`failed to parse first argument in palette expression: ${o.message}`)}const n=s[2];if(!Array.isArray(n))throw new Error("the second argument of palette must be an array");const r=new Array(n.length);for(let o=0;o<r.length;o++){let a;try{a=fe(n[o],Ve,t)}catch(l){throw new Error(`failed to parse color at index ${o} in palette expression: ${l.message}`)}if(!(a instanceof oe))throw new Error(`the palette color at index ${o} must be a literal value`);r[o]=a}return[i,...r]}function k(...s){return function(e,t,i){const n=e[0];let r;for(let o=0;o<s.length;o++){const a=s[o](e,t,i);if(o==s.length-1){if(!a)throw new Error("expected last argument validator to return the parsed args");r=a}}return new Hu(t,n,...r)}}function od(s,e,t){const i=s[0],n=qu[i];if(!n)throw new Error(`unknown operator: ${i}`);return n(s,e,t)}function Gl(s){if(!s)return"";const e=s.getType();switch(e){case"Point":case"LineString":case"Polygon":return e;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return e.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return Gl(s.getGeometries()[0]);default:return""}}function Wl(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function xt(s,e,t){const i=fe(s,e,t);return $e(i)}function $e(s,e){if(s instanceof oe){if(s.type===Ve&&typeof s.value=="string"){const i=ho(s.value);return function(){return i}}return function(){return s.value}}const t=s.operator;switch(t){case C.Number:case C.String:case C.Coalesce:return ad(s);case C.Get:case C.Var:case C.Has:return ld(s);case C.Id:return i=>i.featureId;case C.GeometryType:return i=>i.geometryType;case C.Concat:{const i=s.args.map(n=>$e(n));return n=>"".concat(...i.map(r=>r(n).toString()))}case C.Resolution:return i=>i.resolution;case C.Any:case C.All:case C.Between:case C.In:case C.Not:return cd(s);case C.Equal:case C.NotEqual:case C.LessThan:case C.LessThanOrEqualTo:case C.GreaterThan:case C.GreaterThanOrEqualTo:return hd(s);case C.Multiply:case C.Divide:case C.Add:case C.Subtract:case C.Clamp:case C.Mod:case C.Pow:case C.Abs:case C.Floor:case C.Ceil:case C.Round:case C.Sin:case C.Cos:case C.Atan:case C.Sqrt:return ud(s);case C.Case:return dd(s);case C.Match:return fd(s);case C.Interpolate:return gd(s);case C.ToString:return md(s);default:throw new Error(`Unsupported operator ${t}`)}}function ad(s,e){const t=s.operator,i=s.args.length,n=new Array(i);for(let r=0;r<i;++r)n[r]=$e(s.args[r]);switch(t){case C.Coalesce:return r=>{for(let o=0;o<i;++o){const a=n[o](r);if(typeof a<"u"&&a!==null)return a}throw new Error("Expected one of the values to be non-null")};case C.Number:case C.String:return r=>{for(let o=0;o<i;++o){const a=n[o](r);if(typeof a===t)return a}throw new Error(`Expected one of the values to be a ${t}`)};default:throw new Error(`Unsupported assertion operator ${t}`)}}function ld(s,e){const i=s.args[0].value;switch(s.operator){case C.Get:return n=>{const r=s.args;let o=n.properties[i];for(let a=1,l=r.length;a<l;++a){const c=r[a].value;o=o[c]}return o};case C.Var:return n=>n.variables[i];case C.Has:return n=>{const r=s.args;if(!(i in n.properties))return!1;let o=n.properties[i];for(let a=1,l=r.length;a<l;++a){const c=r[a].value;if(!o||!Object.hasOwn(o,c))return!1;o=o[c]}return!0};default:throw new Error(`Unsupported accessor operator ${s.operator}`)}}function hd(s,e){const t=s.operator,i=$e(s.args[0]),n=$e(s.args[1]);switch(t){case C.Equal:return r=>i(r)===n(r);case C.NotEqual:return r=>i(r)!==n(r);case C.LessThan:return r=>i(r)<n(r);case C.LessThanOrEqualTo:return r=>i(r)<=n(r);case C.GreaterThan:return r=>i(r)>n(r);case C.GreaterThanOrEqualTo:return r=>i(r)>=n(r);default:throw new Error(`Unsupported comparison operator ${t}`)}}function cd(s,e){const t=s.operator,i=s.args.length,n=new Array(i);for(let r=0;r<i;++r)n[r]=$e(s.args[r]);switch(t){case C.Any:return r=>{for(let o=0;o<i;++o)if(n[o](r))return!0;return!1};case C.All:return r=>{for(let o=0;o<i;++o)if(!n[o](r))return!1;return!0};case C.Between:return r=>{const o=n[0](r),a=n[1](r),l=n[2](r);return o>=a&&o<=l};case C.In:return r=>{const o=n[0](r);for(let a=1;a<i;++a)if(o===n[a](r))return!0;return!1};case C.Not:return r=>!n[0](r);default:throw new Error(`Unsupported logical operator ${t}`)}}function ud(s,e){const t=s.operator,i=s.args.length,n=new Array(i);for(let r=0;r<i;++r)n[r]=$e(s.args[r]);switch(t){case C.Multiply:return r=>{let o=1;for(let a=0;a<i;++a)o*=n[a](r);return o};case C.Divide:return r=>n[0](r)/n[1](r);case C.Add:return r=>{let o=0;for(let a=0;a<i;++a)o+=n[a](r);return o};case C.Subtract:return r=>n[0](r)-n[1](r);case C.Clamp:return r=>{const o=n[0](r),a=n[1](r);if(o<a)return a;const l=n[2](r);return o>l?l:o};case C.Mod:return r=>n[0](r)%n[1](r);case C.Pow:return r=>Math.pow(n[0](r),n[1](r));case C.Abs:return r=>Math.abs(n[0](r));case C.Floor:return r=>Math.floor(n[0](r));case C.Ceil:return r=>Math.ceil(n[0](r));case C.Round:return r=>Math.round(n[0](r));case C.Sin:return r=>Math.sin(n[0](r));case C.Cos:return r=>Math.cos(n[0](r));case C.Atan:return i===2?r=>Math.atan2(n[0](r),n[1](r)):r=>Math.atan(n[0](r));case C.Sqrt:return r=>Math.sqrt(n[0](r));default:throw new Error(`Unsupported numeric operator ${t}`)}}function dd(s,e){const t=s.args.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=$e(s.args[n]);return n=>{for(let r=0;r<t-1;r+=2)if(i[r](n))return i[r+1](n);return i[t-1](n)}}function fd(s,e){const t=s.args.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=$e(s.args[n]);return n=>{const r=i[0](n);for(let o=1;o<t;o+=2)if(r===i[o](n))return i[o+1](n);return i[t-1](n)}}function gd(s,e){const t=s.args.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=$e(s.args[n]);return n=>{const r=i[0](n),o=i[1](n);let a,l;for(let h=2;h<t;h+=2){const c=i[h](n);let u=i[h+1](n);const d=Array.isArray(u);if(d&&(u=Zu(u)),c>=o)return h===2?u:d?_d(r,o,a,l,c,u):rn(r,o,a,l,c,u);a=c,l=u}return l}}function md(s,e){const t=s.operator,i=s.args.length,n=new Array(i);for(let r=0;r<i;++r)n[r]=$e(s.args[r]);switch(t){case C.ToString:return r=>{const o=n[0](r);return s.args[0].type===Ve?co(o):o.toString()};default:throw new Error(`Unsupported convert operator ${t}`)}}function rn(s,e,t,i,n,r){const o=n-t;if(o===0)return i;const a=e-t,l=s===1?a/o:(Math.pow(s,a)-1)/(Math.pow(s,o)-1);return i+l*(r-i)}function _d(s,e,t,i,n,r){if(n-t===0)return i;const a=da(i),l=da(r);let h=l[2]-a[2];h>180?h-=360:h<-180&&(h+=360);const c=[rn(s,e,t,a[0],n,l[0]),rn(s,e,t,a[1],n,l[1]),a[2]+rn(s,e,t,0,n,h),rn(s,e,t,i[3],n,r[3])];return kl(Uu(c))}const j={IDLE:0,LOADING:1,LOADED:2,ERROR:3};function pd(s,e,t){const i=s;let n=!0,r=!1,o=!1;const a=[Qn(i,W.LOAD,function(){o=!0,r||e()})];return i.src&&Ba?(r=!0,i.decode().then(function(){n&&e()}).catch(function(l){n&&(o?e():t())})):a.push(Qn(i,W.ERROR,t)),function(){n=!1,a.forEach(ee)}}function yd(s,e){return new Promise((t,i)=>{function n(){o(),t(s)}function r(){o(),i(new Error("Image load error"))}function o(){s.removeEventListener("load",n),s.removeEventListener("error",r)}s.addEventListener("load",n),s.addEventListener("error",r)})}function wd(s,e){return e&&(s.src=e),s.src&&Ba?new Promise((t,i)=>s.decode().then(()=>t(s)).catch(n=>s.complete&&s.width?t(s):i(n))):yd(s)}class Ed{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const i=this.cache_[t];(e++&3)===0&&!i.hasListener()&&(delete this.cache_[t],delete this.patternCache_[t],--this.cacheSize_)}}}get(e,t,i){const n=er(e,t,i);return n in this.cache_?this.cache_[n]:null}getPattern(e,t,i){const n=er(e,t,i);return n in this.patternCache_?this.patternCache_[n]:null}set(e,t,i,n,r){const o=er(e,t,i),a=o in this.cache_;this.cache_[o]=n,r&&(n.getImageState()===j.IDLE&&n.load(),n.getImageState()===j.LOADING?n.ready().then(()=>{this.patternCache_[o]=rs().createPattern(n.getImage(1),"repeat")}):this.patternCache_[o]=rs().createPattern(n.getImage(1),"repeat")),a||++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}}function er(s,e,t){const i=t?ki(t):"null";return e+":"+s+":"+i}const je=new Ed;let Ji=null;class zl extends ps{constructor(e,t,i,n,r){super(),this.hitDetectionImage_=null,this.image_=e,this.crossOrigin_=i,this.canvas_={},this.color_=r,this.imageState_=n===void 0?j.IDLE:n,this.size_=e&&e.width&&e.height?[e.width,e.height]:null,this.src_=t,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===j.LOADED){Ji||(Ji=ue(1,1,void 0,{willReadFrequently:!0})),Ji.drawImage(this.image_,0,0);try{Ji.getImageData(0,0,1,1),this.tainted_=!1}catch{Ji=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(W.CHANGE)}handleImageError_(){this.imageState_=j.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=j.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(e){return this.image_||this.initializeImage_(),this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_}getPixelRatio(e){return this.replaceColor_(e),this.canvas_[e]?e:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const e=this.size_[0],t=this.size_[1],i=ue(e,t);i.fillRect(0,0,e,t),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===j.IDLE){this.image_||this.initializeImage_(),this.imageState_=j.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&wd(this.image_,this.src_).then(e=>{this.image_=e,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(e){if(!this.color_||this.canvas_[e]||this.imageState_!==j.LOADED)return;const t=this.image_,i=ue(Math.ceil(t.width*e),Math.ceil(t.height*e)),n=i.canvas;i.scale(e,e),i.drawImage(t,0,0),i.globalCompositeOperation="multiply",i.fillStyle=Yu(this.color_),i.fillRect(0,0,n.width/e,n.height/e),i.globalCompositeOperation="destination-in",i.drawImage(t,0,0),this.canvas_[e]=n}ready(){return this.ready_||(this.ready_=new Promise(e=>{if(this.imageState_===j.LOADED||this.imageState_===j.ERROR)e();else{const t=()=>{(this.imageState_===j.LOADED||this.imageState_===j.ERROR)&&(this.removeEventListener(W.CHANGE,t),e())};this.addEventListener(W.CHANGE,t)}})),this.ready_}}function fo(s,e,t,i,n,r){let o=e===void 0?void 0:je.get(e,t,n);return o||(o=new zl(s,s&&"src"in s?s.src||void 0:e,t,i,n),je.set(e,t,n,o,r)),r&&o&&!je.getPattern(e,t,n)&&je.set(e,t,n,o,r),o}function st(s){return s?Array.isArray(s)?co(s):typeof s=="object"&&"src"in s?xd(s):s:null}function xd(s){if(!s.offset||!s.size)return je.getPattern(s.src,"anonymous",s.color);const e=s.src+":"+s.offset,t=je.getPattern(e,void 0,s.color);if(t)return t;const i=je.get(s.src,"anonymous",null);if(i.getImageState()!==j.LOADED)return null;const n=ue(s.size[0],s.size[1]);return n.drawImage(i.getImage(1),s.offset[0],s.offset[1],s.size[0],s.size[1],0,0,s.size[0],s.size[1]),fo(n.canvas,e,void 0,j.LOADED,s.color,!0),je.getPattern(e,void 0,s.color)}const Xl="10px sans-serif",be="#000",Ni="round",pt=[],yt=0,Gi="round",fn=10,gn="#000",mn="center",os="middle",$t=[0,0,0,0],_n=1,ft=new Je;let Ci=null,Cr;const vr={},Cd=function(){const e="32px ",t=["monospace","serif"],i=t.length,n="wmytzilWMYTZIL@#/&?$%10";let r,o;function a(h,c,u){let d=!0;for(let f=0;f<i;++f){const g=t[f];if(o=as(h+" "+c+" "+e+g,n),u!=g){const m=as(h+" "+c+" "+e+u+","+g,n);d=d&&m!=o}}return!!d}function l(){let h=!0;const c=ft.getKeys();for(let u=0,d=c.length;u<d;++u){const f=c[u];if(ft.get(f)<100){const[g,m,_]=f.split(`
`);a(g,m,_)?(zi(vr),Ci=null,Cr=void 0,ft.set(f,100)):(ft.set(f,ft.get(f)+1,!0),h=!1)}}h&&(clearInterval(r),r=void 0)}return function(h){const c=Rl(h);if(!c)return;const u=c.families;for(let d=0,f=u.length;d<f;++d){const g=u[d],m=c.style+`
`+c.weight+`
`+g;ft.get(m)===void 0&&(ft.set(m,100,!0),a(c.style,c.weight,g)||(ft.set(m,0,!0),r===void 0&&(r=setInterval(l,32))))}}}(),vd=function(){let s;return function(e){let t=vr[e];if(t==null){if(Ua){const i=Rl(e),n=Yl(e,"Žg");t=(isNaN(Number(i.lineHeight))?1.2:Number(i.lineHeight))*(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)}else s||(s=document.createElement("div"),s.innerHTML="M",s.style.minHeight="0",s.style.maxHeight="none",s.style.height="auto",s.style.padding="0",s.style.border="none",s.style.position="absolute",s.style.display="block",s.style.left="-99999px"),s.style.font=e,document.body.appendChild(s),t=s.offsetHeight,document.body.removeChild(s);vr[e]=t}return t}}();function Yl(s,e){return Ci||(Ci=ue(1,1)),s!=Cr&&(Ci.font=s,Cr=Ci.font),Ci.measureText(e)}function as(s,e){return Yl(s,e).width}function pa(s,e,t){if(e in t)return t[e];const i=e.split(`
`).reduce((n,r)=>Math.max(n,as(s,r)),0);return t[e]=i,i}function Rd(s,e){const t=[],i=[],n=[];let r=0,o=0,a=0,l=0;for(let h=0,c=e.length;h<=c;h+=2){const u=e[h];if(u===`
`||h===c){r=Math.max(r,o),n.push(o),o=0,a+=l,l=0;continue}const d=e[h+1]||s.font,f=as(d,u);t.push(f),o+=f;const g=vd(d);i.push(g),l=Math.max(l,g)}return{width:r,height:a,widths:t,heights:i,lineWidths:n}}function Sd(s,e,t,i,n,r,o,a,l,h,c){s.save(),t!==1&&(s.globalAlpha===void 0?s.globalAlpha=u=>u.globalAlpha*=t:s.globalAlpha*=t),e&&s.transform.apply(s,e),i.contextInstructions?(s.translate(l,h),s.scale(c[0],c[1]),Td(i,s)):c[0]<0||c[1]<0?(s.translate(l,h),s.scale(c[0],c[1]),s.drawImage(i,n,r,o,a,0,0,o,a)):s.drawImage(i,n,r,o,a,l,h,o*c[0],a*c[1]),s.restore()}function Td(s,e){const t=s.contextInstructions;for(let i=0,n=t.length;i<n;i+=2)Array.isArray(t[i+1])?e[t[i]].apply(e,t[i+1]):e[t[i]]=t[i+1]}class Ms{constructor(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=Le(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new Ms({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return N()}getImage(e){return N()}getHitDetectionImage(){return N()}getPixelRatio(e){return 1}getImageState(){return N()}getImageSize(){return N()}getOrigin(){return N()}getSize(){return N()}setDisplacement(e){this.displacement_=e}setOpacity(e){this.opacity_=e}setRotateWithView(e){this.rotateWithView_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=Le(e)}listenImageChange(e){N()}load(){N()}unlistenImageChange(e){N()}ready(){return Promise.resolve()}}class Ls extends Ms{constructor(e){super({opacity:1,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,rotation:e.rotation!==void 0?e.rotation:0,scale:e.scale!==void 0?e.scale:1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=e.fill!==void 0?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius=e.radius,this.radius2_=e.radius2,this.angle_=e.angle!==void 0?e.angle:0,this.stroke_=e.stroke!==void 0?e.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?j.LOADING:j.LOADED,this.imageState_===j.LOADING&&this.ready().then(()=>this.imageState_=j.LOADED),this.render()}clone(){const e=this.getScale(),t=new Ls({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}getAnchor(){const e=this.size_,t=this.getDisplacement(),i=this.getScaleArray();return[e[0]/2-t[0]/i[0],e[1]/2+t[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(e){this.fill_=e,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(e){var r,o;const t=(r=this.fill_)==null?void 0:r.getKey(),i=`${e},${this.angle_},${this.radius},${this.radius2_},${this.points_},${t}`+Object.values(this.renderOptions_).join(",");let n=(o=je.get(i,null,null))==null?void 0:o.getImage(1);if(!n){const a=this.renderOptions_,l=Math.ceil(a.size*e),h=ue(l,l);this.draw_(a,h,e),n=h.canvas,je.set(i,null,null,new zl(n,void 0,null,j.LOADED,null))}return n}getPixelRatio(e){return e}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e,this.render()}listenImageChange(e){}load(){}unlistenImageChange(e){}calculateLineJoinSize_(e,t,i){if(t===0||this.points_===1/0||e!=="bevel"&&e!=="miter")return t;let n=this.radius,r=this.radius2_===void 0?n:this.radius2_;if(n<r){const R=n;n=r,r=R}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=r*Math.sin(a),h=Math.sqrt(r*r-l*l),c=n-h,u=Math.sqrt(l*l+c*c),d=u/l;if(e==="miter"&&d<=i)return d*t;const f=t/2/d,g=t/2*(c/u),_=Math.sqrt((n+f)*(n+f)+g*g)-n;if(this.radius2_===void 0||e==="bevel")return _*2;const p=n*Math.sin(a),y=Math.sqrt(n*n-p*p),x=r-y,E=Math.sqrt(p*p+x*x)/p;if(E<=i){const R=E*t/2-r-n;return 2*Math.max(_,R)}return _*2}createRenderOptions(){let e=Ni,t=Gi,i=0,n=null,r=0,o,a=0;this.stroke_&&(o=st(this.stroke_.getColor()??gn),a=this.stroke_.getWidth()??_n,n=this.stroke_.getLineDash(),r=this.stroke_.getLineDashOffset()??0,t=this.stroke_.getLineJoin()??Gi,e=this.stroke_.getLineCap()??Ni,i=this.stroke_.getMiterLimit()??fn);const l=this.calculateLineJoinSize_(t,a,i),h=Math.max(this.radius,this.radius2_||0),c=Math.ceil(2*h+l);return{strokeStyle:o,strokeWidth:a,size:c,lineCap:e,lineDash:n,lineDashOffset:r,lineJoin:t,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const e=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[e,e]}draw_(e,t,i){if(t.scale(i,i),t.translate(e.size/2,e.size/2),this.createPath_(t),this.fill_){let n=this.fill_.getColor();n===null&&(n=be),t.fillStyle=st(n),t.fill()}e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineCap=e.lineCap,t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}createHitDetectionCanvas_(e){let t;if(this.fill_){let i=this.fill_.getColor(),n=0;typeof i=="string"&&(i=ki(i)),i===null?n=1:Array.isArray(i)&&(n=i.length===4?i[3]:1),n===0&&(t=ue(e.size,e.size),this.drawHitDetectionCanvas_(e,t))}return t?t.canvas:this.getImage(1)}createPath_(e){let t=this.points_;const i=this.radius;if(t===1/0)e.arc(0,0,i,0,2*Math.PI);else{const n=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(t*=2);const r=this.angle_-Math.PI/2,o=2*Math.PI/t;for(let a=0;a<t;a++){const l=r+a*o,h=a%2===0?i:n;e.lineTo(h*Math.cos(l),h*Math.sin(l))}e.closePath()}}drawHitDetectionCanvas_(e,t){t.translate(e.size/2,e.size/2),this.createPath_(t),t.fillStyle=be,t.fill(),e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class ri extends Ls{constructor(e){e=e||{radius:5},super({points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,scale:e.scale!==void 0?e.scale:1,rotation:e.rotation!==void 0?e.rotation:0,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode})}clone(){const e=this.getScale(),t=new ri({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}setRadius(e){this.radius=e,this.render()}}class Et{constructor(e){e=e||{},this.patternImage_=null,this.color_=null,e.color!==void 0&&this.setColor(e.color)}clone(){const e=this.getColor();return new Et({color:Array.isArray(e)?e.slice():e||void 0})}getColor(){return this.color_}setColor(e){if(e!==null&&typeof e=="object"&&"src"in e){const t=fo(null,e.src,"anonymous",void 0,e.offset?null:e.color?e.color:null,!(e.offset&&e.size));t.ready().then(()=>{this.patternImage_=null}),t.getImageState()===j.IDLE&&t.load(),t.getImageState()===j.LOADING&&(this.patternImage_=t)}this.color_=e}getKey(){const e=this.getColor();return e?e instanceof CanvasPattern||e instanceof CanvasGradient?U(e):typeof e=="object"&&"src"in e?e.src+":"+e.offset:ki(e).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}function ya(s,e,t,i){return t!==void 0&&i!==void 0?[t/s,i/e]:t!==void 0?t/s:i!==void 0?i/e:1}class Ps extends Ms{constructor(e){e=e||{};const t=e.opacity!==void 0?e.opacity:1,i=e.rotation!==void 0?e.rotation:0,n=e.scale!==void 0?e.scale:1,r=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:t,rotation:i,scale:n,displacement:e.displacement!==void 0?e.displacement:[0,0],rotateWithView:r,declutterMode:e.declutterMode}),this.anchor_=e.anchor!==void 0?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=e.anchorOrigin!==void 0?e.anchorOrigin:"top-left",this.anchorXUnits_=e.anchorXUnits!==void 0?e.anchorXUnits:"fraction",this.anchorYUnits_=e.anchorYUnits!==void 0?e.anchorYUnits:"fraction",this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null;const o=e.img!==void 0?e.img:null;let a=e.src;q(!(a!==void 0&&o),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&o&&(a=o.src||U(o)),q(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),q(!((e.width!==void 0||e.height!==void 0)&&e.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(e.src!==void 0?l=j.IDLE:o!==void 0&&("complete"in o?o.complete?l=o.src?j.LOADED:j.IDLE:l=j.LOADING:l=j.LOADED),this.color_=e.color!==void 0?ki(e.color):null,this.iconImage_=fo(o,a,this.crossOrigin_,l,this.color_),this.offset_=e.offset!==void 0?e.offset:[0,0],this.offsetOrigin_=e.offsetOrigin!==void 0?e.offsetOrigin:"top-left",this.origin_=null,this.size_=e.size!==void 0?e.size:null,this.initialOptions_,e.width!==void 0||e.height!==void 0){let h,c;if(e.size)[h,c]=e.size;else{const u=this.getImage(1);if(u.width&&u.height)h=u.width,c=u.height;else if(u instanceof HTMLImageElement){this.initialOptions_=e;const d=()=>{if(this.unlistenImageChange(d),!this.initialOptions_)return;const f=this.iconImage_.getSize();this.setScale(ya(f[0],f[1],e.width,e.height))};this.listenImageChange(d);return}}h!==void 0&&this.setScale(ya(h,c,e.width,e.height))}}clone(){let e,t,i;return this.initialOptions_?(t=this.initialOptions_.width,i=this.initialOptions_.height):(e=this.getScale(),e=Array.isArray(e)?e.slice():e),new Ps({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:e,width:t,height:i,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;const n=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!n)return null;e=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(e[0]*=n[0]),this.anchorYUnits_=="fraction"&&(e[1]*=n[1])}if(this.anchorOrigin_!="top-left"){if(!n)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(e[0]=-e[0]+n[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(e[1]=-e[1]+n[1])}this.normalizedAnchor_=e}const t=this.getDisplacement(),i=this.getScaleArray();return[e[0]-t[0]/i[0],e[1]+t[1]/i[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if(this.offsetOrigin_!="top-left"){const t=this.getSize(),i=this.iconImage_.getSize();if(!t||!i)return null;e=e.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(e[0]=i[0]-t[0]-e[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(e[1]=i[1]-t[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const e=this.getScaleArray();if(this.size_)return this.size_[0]*e[0];if(this.iconImage_.getImageState()==j.LOADED)return this.iconImage_.getSize()[0]*e[0]}getHeight(){const e=this.getScaleArray();if(this.size_)return this.size_[1]*e[1];if(this.iconImage_.getImageState()==j.LOADED)return this.iconImage_.getSize()[1]*e[1]}setScale(e){delete this.initialOptions_,super.setScale(e)}listenImageChange(e){this.iconImage_.addEventListener(W.CHANGE,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener(W.CHANGE,e)}ready(){return this.iconImage_.ready()}}class Te{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=e.lineDash!==void 0?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}clone(){const e=this.getColor();return new Te({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(e){this.color_=e}setLineCap(e){this.lineCap_=e}setLineDash(e){this.lineDash_=e}setLineDashOffset(e){this.lineDashOffset_=e}setLineJoin(e){this.lineJoin_=e}setMiterLimit(e){this.miterLimit_=e}setWidth(e){this.width_=e}}class he{constructor(e){e=e||{},this.geometry_=null,this.geometryFunction_=wa,e.geometry!==void 0&&this.setGeometry(e.geometry),this.fill_=e.fill!==void 0?e.fill:null,this.image_=e.image!==void 0?e.image:null,this.renderer_=e.renderer!==void 0?e.renderer:null,this.hitDetectionRenderer_=e.hitDetectionRenderer!==void 0?e.hitDetectionRenderer:null,this.stroke_=e.stroke!==void 0?e.stroke:null,this.text_=e.text!==void 0?e.text:null,this.zIndex_=e.zIndex}clone(){let e=this.getGeometry();return e&&typeof e=="object"&&(e=e.clone()),new he({geometry:e??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(e){this.renderer_=e}setHitDetectionRenderer(e){this.hitDetectionRenderer_=e}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(e){this.fill_=e}getImage(){return this.image_}setImage(e){this.image_=e}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e}getText(){return this.text_}setText(e){this.text_=e}getZIndex(){return this.zIndex_}setGeometry(e){typeof e=="function"?this.geometryFunction_=e:typeof e=="string"?this.geometryFunction_=function(t){return t.get(e)}:e?e!==void 0&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=wa,this.geometry_=e}setZIndex(e){this.zIndex_=e}}function Id(s){let e;if(typeof s=="function")e=s;else{let t;Array.isArray(s)?t=s:(q(typeof s.getZIndex=="function","Expected an `Style` or an array of `Style`"),t=[s]),e=function(){return t}}return e}let tr=null;function jl(s,e){if(!tr){const t=new Et({color:"rgba(255,255,255,0.4)"}),i=new Te({color:"#3399CC",width:1.25});tr=[new he({image:new ri({fill:t,stroke:i,radius:5}),fill:t,stroke:i})]}return tr}function bd(){const s={},e=[255,255,255,1],t=[0,153,255,1],i=3;return s.Polygon=[new he({fill:new Et({color:[255,255,255,.5]})})],s.MultiPolygon=s.Polygon,s.LineString=[new he({stroke:new Te({color:e,width:i+2})}),new he({stroke:new Te({color:t,width:i})})],s.MultiLineString=s.LineString,s.Circle=s.Polygon.concat(s.LineString),s.Point=[new he({image:new ri({radius:i*2,fill:new Et({color:t}),stroke:new Te({color:e,width:i/2})}),zIndex:1/0})],s.MultiPoint=s.Point,s.GeometryCollection=s.Polygon.concat(s.LineString,s.Point),s}function wa(s){return s.getGeometry()}const Ad="#333";class go{constructor(e){e=e||{},this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.keepUpright_=e.keepUpright,this.scale_=e.scale,this.scaleArray_=Le(e.scale!==void 0?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.repeat_=e.repeat,this.textBaseline_=e.textBaseline,this.fill_=e.fill!==void 0?e.fill:new Et({color:Ad}),this.maxAngle_=e.maxAngle!==void 0?e.maxAngle:Math.PI/4,this.placement_=e.placement!==void 0?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=e.stroke!==void 0?e.stroke:null,this.offsetX_=e.offsetX!==void 0?e.offsetX:0,this.offsetY_=e.offsetY!==void 0?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=e.padding===void 0?null:e.padding,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new go({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(e){this.overflow_=e}setFont(e){this.font_=e}setMaxAngle(e){this.maxAngle_=e}setOffsetX(e){this.offsetX_=e}setOffsetY(e){this.offsetY_=e}setPlacement(e){this.placement_=e}setRepeat(e){this.repeat_=e}setRotateWithView(e){this.rotateWithView_=e}setKeepUpright(e){this.keepUpright_=e}setFill(e){this.fill_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=Le(e!==void 0?e:1)}setStroke(e){this.stroke_=e}setText(e){this.text_=e}setTextAlign(e){this.textAlign_=e}setJustify(e){this.justify_=e}setTextBaseline(e){this.textBaseline_=e}setBackgroundFill(e){this.backgroundFill_=e}setBackgroundStroke(e){this.backgroundStroke_=e}setPadding(e){this.padding_=e}}function Md(s){return!0}function Ld(s){const e=Nl(),t=Pd(s,e),i=Wl();return function(n,r){if(i.properties=n.getPropertiesInternal(),i.resolution=r,e.featureId){const o=n.getId();o!==void 0?i.featureId=o:i.featureId=null}return e.geometryType&&(i.geometryType=Gl(n.getGeometry())),t(i)}}function Ea(s){const e=Nl(),t=s.length,i=new Array(t);for(let o=0;o<t;++o)i[o]=Rr(s[o],e);const n=Wl(),r=new Array(t);return function(o,a){if(n.properties=o.getPropertiesInternal(),n.resolution=a,e.featureId){const h=o.getId();h!==void 0?n.featureId=h:n.featureId=null}let l=0;for(let h=0;h<t;++h){const c=i[h](n);c&&(r[l]=c,l+=1)}return r.length=l,r}}function Pd(s,e){const t=s.length,i=new Array(t);for(let n=0;n<t;++n){const r=s[n],o="filter"in r?xt(r.filter,Ce,e):Md;let a;if(Array.isArray(r.style)){const l=r.style.length;a=new Array(l);for(let h=0;h<l;++h)a[h]=Rr(r.style[h],e)}else a=[Rr(r.style,e)];i[n]={filter:o,styles:a}}return function(n){const r=[];let o=!1;for(let a=0;a<t;++a){const l=i[a].filter;if(l(n)&&!(s[a].else&&o)){o=!0;for(const h of i[a].styles){const c=h(n);c&&r.push(c)}}}return r}}function Rr(s,e){const t=pn(s,"",e),i=yn(s,"",e),n=Fd(s,e),r=Od(s,e),o=Me(s,"z-index",e);if(!t&&!i&&!n&&!r&&!ii(s))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(s));const a=new he;return function(l){let h=!0;if(t){const c=t(l);c&&(h=!1),a.setFill(c)}if(i){const c=i(l);c&&(h=!1),a.setStroke(c)}if(n){const c=n(l);c&&(h=!1),a.setText(c)}if(r){const c=r(l);c&&(h=!1),a.setImage(c)}return o&&a.setZIndex(o(l)),h?null:a}}function pn(s,e,t){let i;if(e+"fill-pattern-src"in s)i=Gd(s,e+"fill-",t);else{if(s[e+"fill-color"]==="none")return r=>null;i=mo(s,e+"fill-color",t)}if(!i)return null;const n=new Et;return function(r){const o=i(r);return o===lo?null:(n.setColor(o),n)}}function yn(s,e,t){const i=Me(s,e+"stroke-width",t),n=mo(s,e+"stroke-color",t);if(!i&&!n)return null;const r=mt(s,e+"stroke-line-cap",t),o=mt(s,e+"stroke-line-join",t),a=Zl(s,e+"stroke-line-dash",t),l=Me(s,e+"stroke-line-dash-offset",t),h=Me(s,e+"stroke-miter-limit",t),c=new Te;return function(u){if(n){const d=n(u);if(d===lo)return null;c.setColor(d)}if(i&&c.setWidth(i(u)),r){const d=r(u);if(d!=="butt"&&d!=="round"&&d!=="square")throw new Error("Expected butt, round, or square line cap");c.setLineCap(d)}if(o){const d=o(u);if(d!=="bevel"&&d!=="round"&&d!=="miter")throw new Error("Expected bevel, round, or miter line join");c.setLineJoin(d)}return a&&c.setLineDash(a(u)),l&&c.setLineDashOffset(l(u)),h&&c.setMiterLimit(h(u)),c}}function Fd(s,e){const t="text-",i=mt(s,t+"value",e);if(!i)return null;const n=pn(s,t,e),r=pn(s,t+"background-",e),o=yn(s,t,e),a=yn(s,t+"background-",e),l=mt(s,t+"font",e),h=Me(s,t+"max-angle",e),c=Me(s,t+"offset-x",e),u=Me(s,t+"offset-y",e),d=Ai(s,t+"overflow",e),f=mt(s,t+"placement",e),g=Me(s,t+"repeat",e),m=Fs(s,t+"scale",e),_=Ai(s,t+"rotate-with-view",e),p=Me(s,t+"rotation",e),y=mt(s,t+"align",e),x=mt(s,t+"justify",e),w=mt(s,t+"baseline",e),E=Ai(s,t+"keep-upright",e),R=Zl(s,t+"padding",e),I=Os(s,t+"declutter-mode"),v=new go({declutterMode:I});return function(S){if(v.setText(i(S)),n&&v.setFill(n(S)),r&&v.setBackgroundFill(r(S)),o&&v.setStroke(o(S)),a&&v.setBackgroundStroke(a(S)),l&&v.setFont(l(S)),h&&v.setMaxAngle(h(S)),c&&v.setOffsetX(c(S)),u&&v.setOffsetY(u(S)),d&&v.setOverflow(d(S)),f){const A=f(S);if(A!=="point"&&A!=="line")throw new Error("Expected point or line for text-placement");v.setPlacement(A)}if(g&&v.setRepeat(g(S)),m&&v.setScale(m(S)),_&&v.setRotateWithView(_(S)),p&&v.setRotation(p(S)),y){const A=y(S);if(A!=="left"&&A!=="center"&&A!=="right"&&A!=="end"&&A!=="start")throw new Error("Expected left, right, center, start, or end for text-align");v.setTextAlign(A)}if(x){const A=x(S);if(A!=="left"&&A!=="right"&&A!=="center")throw new Error("Expected left, right, or center for text-justify");v.setJustify(A)}if(w){const A=w(S);if(A!=="bottom"&&A!=="top"&&A!=="middle"&&A!=="alphabetic"&&A!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");v.setTextBaseline(A)}return R&&v.setPadding(R(S)),E&&v.setKeepUpright(E(S)),v}}function Od(s,e){return"icon-src"in s?Dd(s,e):"shape-points"in s?kd(s,e):"circle-radius"in s?Nd(s,e):null}function Dd(s,e){const t="icon-",i=t+"src",n=Ul(s[i],i),r=ls(s,t+"anchor",e),o=Fs(s,t+"scale",e),a=Me(s,t+"opacity",e),l=ls(s,t+"displacement",e),h=Me(s,t+"rotation",e),c=Ai(s,t+"rotate-with-view",e),u=Ca(s,t+"anchor-origin"),d=va(s,t+"anchor-x-units"),f=va(s,t+"anchor-y-units"),g=Yd(s,t+"color"),m=zd(s,t+"cross-origin"),_=Xd(s,t+"offset"),p=Ca(s,t+"offset-origin"),y=hs(s,t+"width"),x=hs(s,t+"height"),w=Wd(s,t+"size"),E=Os(s,t+"declutter-mode"),R=new Ps({src:n,anchorOrigin:u,anchorXUnits:d,anchorYUnits:f,color:g,crossOrigin:m,offset:_,offsetOrigin:p,height:x,width:y,size:w,declutterMode:E});return function(I){return a&&R.setOpacity(a(I)),l&&R.setDisplacement(l(I)),h&&R.setRotation(h(I)),c&&R.setRotateWithView(c(I)),o&&R.setScale(o(I)),r&&R.setAnchor(r(I)),R}}function kd(s,e){const t="shape-",i=t+"points",n=t+"radius",r=Sr(s[i],i),o=Sr(s[n],n),a=pn(s,t,e),l=yn(s,t,e),h=Fs(s,t+"scale",e),c=ls(s,t+"displacement",e),u=Me(s,t+"rotation",e),d=Ai(s,t+"rotate-with-view",e),f=hs(s,t+"radius2"),g=hs(s,t+"angle"),m=Os(s,t+"declutter-mode"),_=new Ls({points:r,radius:o,radius2:f,angle:g,declutterMode:m});return function(p){return a&&_.setFill(a(p)),l&&_.setStroke(l(p)),c&&_.setDisplacement(c(p)),u&&_.setRotation(u(p)),d&&_.setRotateWithView(d(p)),h&&_.setScale(h(p)),_}}function Nd(s,e){const t="circle-",i=pn(s,t,e),n=yn(s,t,e),r=Me(s,t+"radius",e),o=Fs(s,t+"scale",e),a=ls(s,t+"displacement",e),l=Me(s,t+"rotation",e),h=Ai(s,t+"rotate-with-view",e),c=Os(s,t+"declutter-mode"),u=new ri({radius:5,declutterMode:c});return function(d){return r&&u.setRadius(r(d)),i&&u.setFill(i(d)),n&&u.setStroke(n(d)),a&&u.setDisplacement(a(d)),l&&u.setRotation(l(d)),h&&u.setRotateWithView(h(d)),o&&u.setScale(o(d)),u}}function Me(s,e,t){if(!(e in s))return;const i=xt(s[e],B,t);return function(n){return Sr(i(n),e)}}function mt(s,e,t){if(!(e in s))return null;const i=xt(s[e],Ie,t);return function(n){return Ul(i(n),e)}}function Gd(s,e,t){const i=mt(s,e+"pattern-src",t),n=xa(s,e+"pattern-offset",t),r=xa(s,e+"pattern-size",t),o=mo(s,e+"color",t);return function(a){return{src:i(a),offset:n&&n(a),size:r&&r(a),color:o&&o(a)}}}function Ai(s,e,t){if(!(e in s))return null;const i=xt(s[e],Ce,t);return function(n){const r=i(n);if(typeof r!="boolean")throw new Error(`Expected a boolean for ${e}`);return r}}function mo(s,e,t){if(!(e in s))return null;const i=xt(s[e],Ve,t);return function(n){return Bl(i(n),e)}}function Zl(s,e,t){if(!(e in s))return null;const i=xt(s[e],si,t);return function(n){return Sn(i(n),e)}}function ls(s,e,t){if(!(e in s))return null;const i=xt(s[e],si,t);return function(n){const r=Sn(i(n),e);if(r.length!==2)throw new Error(`Expected two numbers for ${e}`);return r}}function xa(s,e,t){if(!(e in s))return null;const i=xt(s[e],si,t);return function(n){return Kl(i(n),e)}}function Fs(s,e,t){if(!(e in s))return null;const i=xt(s[e],si|B,t);return function(n){return jd(i(n),e)}}function hs(s,e){const t=s[e];if(t!==void 0){if(typeof t!="number")throw new Error(`Expected a number for ${e}`);return t}}function Wd(s,e){const t=s[e];if(t!==void 0){if(typeof t=="number")return Le(t);if(!Array.isArray(t))throw new Error(`Expected a number or size array for ${e}`);if(t.length!==2||typeof t[0]!="number"||typeof t[1]!="number")throw new Error(`Expected a number or size array for ${e}`);return t}}function zd(s,e){const t=s[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);return t}}function Ca(s,e){const t=s[e];if(t!==void 0){if(t!=="bottom-left"&&t!=="bottom-right"&&t!=="top-left"&&t!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${e}`);return t}}function va(s,e){const t=s[e];if(t!==void 0){if(t!=="pixels"&&t!=="fraction")throw new Error(`Expected pixels or fraction for ${e}`);return t}}function Xd(s,e){const t=s[e];if(t!==void 0)return Sn(t,e)}function Os(s,e){const t=s[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);if(t!=="declutter"&&t!=="obstacle"&&t!=="none")throw new Error(`Expected declutter, obstacle, or none for ${e}`);return t}}function Yd(s,e){const t=s[e];if(t!==void 0)return Bl(t,e)}function Sn(s,e){if(!Array.isArray(s))throw new Error(`Expected an array for ${e}`);const t=s.length;for(let i=0;i<t;++i)if(typeof s[i]!="number")throw new Error(`Expected an array of numbers for ${e}`);return s}function Ul(s,e){if(typeof s!="string")throw new Error(`Expected a string for ${e}`);return s}function Sr(s,e){if(typeof s!="number")throw new Error(`Expected a number for ${e}`);return s}function Bl(s,e){if(typeof s=="string")return s;const t=Sn(s,e),i=t.length;if(i<3||i>4)throw new Error(`Expected a color with 3 or 4 values for ${e}`);return t}function Kl(s,e){const t=Sn(s,e);if(t.length!==2)throw new Error(`Expected an array of two numbers for ${e}`);return t}function jd(s,e){return typeof s=="number"?s:Kl(s,e)}const Ra={RENDER_ORDER:"renderOrder"};class Vl extends As{constructor(e){e=e||{};const t=Object.assign({},e);delete t.style,delete t.renderBuffer,delete t.updateWhileAnimating,delete t.updateWhileInteracting,super(t),this.declutter_=e.declutter?String(e.declutter):void 0,this.renderBuffer_=e.renderBuffer!==void 0?e.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(e.style),this.updateWhileAnimating_=e.updateWhileAnimating!==void 0?e.updateWhileAnimating:!1,this.updateWhileInteracting_=e.updateWhileInteracting!==void 0?e.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(e){return super.getFeatures(e)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(Ra.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(e,t){const i=this.getDeclutter();i in e.declutter||(e.declutter[i]=new Ol(9)),this.getRenderer().renderDeclutter(e,t)}setRenderOrder(e){this.set(Ra.RENDER_ORDER,e)}setStyle(e){this.style_=e===void 0?jl:e;const t=Zd(e);this.styleFunction_=e===null?void 0:Id(t),this.changed()}setDeclutter(e){this.declutter_=e?String(e):void 0,this.changed()}}function Zd(s){if(s===void 0)return jl;if(!s)return null;if(typeof s=="function"||s instanceof he)return s;if(!Array.isArray(s))return Ea([s]);if(s.length===0)return[];const e=s.length,t=s[0];if(t instanceof he){const n=new Array(e);for(let r=0;r<e;++r){const o=s[r];if(!(o instanceof he))throw new Error("Expected a list of style instances");n[r]=o}return n}if("style"in t){const n=new Array(e);for(let r=0;r<e;++r){const o=s[r];if(!("style"in o))throw new Error("Expected a list of rules with a style property");n[r]=o}return Ld(n)}return Ea(s)}class Hl extends rt{constructor(e,t,i,n){super(e),this.inversePixelTransform=t,this.frameState=i,this.context=n}}class Ud extends _s{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){N()}calculateMatrices2D(e){const t=e.viewState,i=e.coordinateToPixelTransform,n=e.pixelToCoordinateTransform;wt(i,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),dl(n,i)}forEachFeatureAtCoordinate(e,t,i,n,r,o,a,l){let h;const c=t.viewState;function u(w,E,R,I){return r.call(o,E,w?R:null,I)}const d=c.projection,f=il(e.slice(),d),g=[[0,0]];if(d.canWrapX()&&n){const w=d.getExtent(),E=Q(w);g.push([-E,0],[E,0])}const m=t.layerStatesArray,_=m.length,p=[],y=[];for(let w=0;w<g.length;w++)for(let E=_-1;E>=0;--E){const R=m[E],I=R.layer;if(I.hasRenderer()&&oo(R,c)&&a.call(l,I)){const v=I.getRenderer(),S=I.getSource();if(v&&S){const A=S.getWrapX()?f:e,O=u.bind(null,R.managed);y[0]=A[0]+g[w][0],y[1]=A[1]+g[w][1],h=v.forEachFeatureAtCoordinate(y,t,i,O,p)}if(h)return h}}if(p.length===0)return;const x=1/p.length;return p.forEach((w,E)=>w.distanceSq+=E*x),p.sort((w,E)=>w.distanceSq-E.distanceSq),p.some(w=>h=w.callback(w.feature,w.layer,w.geometry)),h}hasFeatureAtCoordinate(e,t,i,n,r,o){return this.forEachFeatureAtCoordinate(e,t,i,n,ti,this,r,o)!==void 0}getMap(){return this.map_}renderFrame(e){N()}scheduleExpireIconCache(e){je.canExpireCache()&&e.postRenderFunctions.push(Bd)}}function Bd(s,e){je.expire()}class Kd extends Ud{constructor(e){super(e),this.fontChangeListenerKey_=K(ft,Li.PROPERTYCHANGE,e.redrawText,e),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=Is+" ol-layers";const i=e.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,t){const i=this.getMap();if(i.hasListener(e)){const n=new Hl(e,void 0,t);i.dispatchEvent(n)}}disposeInternal(){ee(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(Ye.PRECOMPOSE,e);const t=e.layerStatesArray.sort((a,l)=>a.zIndex-l.zIndex);t.some(a=>a.layer instanceof Vl&&a.layer.getDeclutter())&&(e.declutter={});const n=e.viewState;this.children_.length=0;const r=[];let o=null;for(let a=0,l=t.length;a<l;++a){const h=t[a];e.layerIndex=a;const c=h.layer,u=c.getSourceState();if(!oo(h,n)||u!="ready"&&u!="undefined"){c.unrender();continue}const d=c.render(e,o);d&&(d!==o&&(this.children_.push(d),o=d),r.push(h))}this.declutter(e,r),ou(this.element_,this.children_),this.dispatchRenderEvent(Ye.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}declutter(e,t){if(e.declutter){for(let i=t.length-1;i>=0;--i){const n=t[i],r=n.layer;r.getDeclutter()&&r.renderDeclutter(e,n)}t.forEach(i=>i.layer.renderDeferred(e))}}}function ql(s){if(s instanceof As){s.setMapInternal(null);return}s instanceof ji&&s.getLayers().forEach(ql)}function $l(s,e){if(s instanceof As){s.setMapInternal(e);return}if(s instanceof ji){const t=s.getLayers().getArray();for(let i=0,n=t.length;i<n;++i)$l(t[i],e)}}class Vd extends Je{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=Hd(e);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading!==void 0?e.maxTilesLoading:16,this.pixelRatio_=e.pixelRatio!==void 0?e.pixelRatio:Za,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=qe(),this.pixelToCoordinateTransform_=qe(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=t.controls||cu(),this.interactions=t.interactions||Au({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new Gh(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(ye.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(ye.VIEW,this.handleViewChanged_),this.addChangeListener(ye.SIZE,this.handleSizeChanged_),this.addChangeListener(ye.TARGET,this.handleTargetChanged_),this.setProperties(t.values);const i=this;e.view&&!(e.view instanceof it)&&e.view.then(function(n){i.setView(new it(n))}),this.controls.addEventListener(ce.ADD,n=>{n.element.setMap(this)}),this.controls.addEventListener(ce.REMOVE,n=>{n.element.setMap(null)}),this.interactions.addEventListener(ce.ADD,n=>{n.element.setMap(this)}),this.interactions.addEventListener(ce.REMOVE,n=>{n.element.setMap(null)}),this.overlays_.addEventListener(ce.ADD,n=>{this.addOverlayInternal_(n.element)}),this.overlays_.addEventListener(ce.REMOVE,n=>{const r=n.element.getId();r!==void 0&&delete this.overlayIdIndex_[r.toString()],n.element.setMap(null)}),this.controls.forEach(n=>{n.setMap(this)}),this.interactions.forEach(n=>{n.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){$l(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,i){if(!this.frameState_||!this.renderer_)return;const n=this.getCoordinateFromPixelInternal(e);i=i!==void 0?i:{};const r=i.hitTolerance!==void 0?i.hitTolerance:0,o=i.layerFilter!==void 0?i.layerFilter:ti,a=i.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,r,a,t,null,o,null)}getFeaturesAtPixel(e,t){const i=[];return this.forEachFeatureAtPixel(e,function(n){i.push(n)},t),i}getAllLayers(){const e=[];function t(i){i.forEach(function(n){n instanceof ji?t(n.getLayers()):e.push(n)})}return t(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(e);t=t!==void 0?t:{};const n=t.layerFilter!==void 0?t.layerFilter:ti,r=t.hitTolerance!==void 0?t.hitTolerance:0,o=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,r,o,n,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const i=this.viewport_.getBoundingClientRect(),n=this.getSize(),r=i.width/n[0],o=i.height/n[1],a="changedTouches"in e?e.changedTouches[0]:e;return[(a.clientX-i.left)/r,(a.clientY-i.top)/o]}getTarget(){return this.get(ye.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return yr(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?le(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return t!==void 0?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(ye.LAYERGROUP)}setLayers(e){const t=this.getLayerGroup();if(e instanceof He){t.setLayers(e);return}const i=t.getLayers();i.clear(),i.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const n=e[t];if(!n.visible)continue;const r=n.layer.getRenderer();if(r&&!r.ready)return!0;const o=n.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(e){const t=dt(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?le(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(ye.SIZE)}getView(){return this.get(ye.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,i,n){return Wh(this.frameState_,e,t,i,n)}handleBrowserEvent(e,t){t=t||e.type;const i=new bt(t,this,e);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(e){if(!this.frameState_)return;const t=e.originalEvent,i=t.type;if(i===cr.POINTERDOWN||i===W.WHEEL||i===W.KEYDOWN){const n=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():n,o=t.target,a=r instanceof ShadowRoot?r.host===o?r.host.ownerDocument:r:r===n?n.documentElement:r;if(this.overlayContainerStopEvent_.contains(o)||!a.contains(o))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){const n=this.getInteractions().getArray().slice();for(let r=n.length-1;r>=0;r--){const o=n[r];if(o.getMap()!==this||!o.getActive()||!this.getTargetElement())continue;if(!o.handleEvent(e)||e.propagationStopped)break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let n=this.maxTilesLoading_,r=n;if(e){const o=e.viewHints;if(o[we.ANIMATING]||o[we.INTERACTING]){const a=Date.now()-e.time>8;n=a?0:8,r=a?0:2}}t.getTilesLoading()<n&&(t.reprioritize(),t.loadMoreTiles(n,r))}e&&this.renderer_&&!e.animate&&(this.renderComplete_?(this.hasListener(Ye.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(Ye.RENDERCOMPLETE,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new Ei(gt.LOADEND,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new Ei(gt.LOADSTART,this,e))));const i=this.postRenderFunctions_;if(e)for(let n=0,r=i.length;n<r;++n)i[n](this,e);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let i=0,n=this.targetChangeHandlerKeys_.length;i<n;++i)ee(this.targetChangeHandlerKeys_[i]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(W.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(W.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const i=this.targetElement_.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.unobserve(i.host),this.setSize(void 0)}const e=this.getTarget(),t=typeof e=="string"?document.getElementById(e):e;if(this.targetElement_=t,!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new Kd(this)),this.mapBrowserEventHandler_=new kh(this,this.moveTolerance_);for(const r in ie)this.mapBrowserEventHandler_.addEventListener(ie[r],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(W.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(W.WHEEL,this.boundHandleBrowserEvent_,Ka?{passive:!1}:!1);let i;if(this.keyboardEventTarget_)i=this.keyboardEventTarget_;else{const r=t.getRootNode();i=r instanceof ShadowRoot?r.host:t}this.targetChangeHandlerKeys_=[K(i,W.KEYDOWN,this.handleBrowserEvent,this),K(i,W.KEYPRESS,this.handleBrowserEvent,this)];const n=t.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.observe(n.host),this.resizeObserver_.observe(t)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(ee(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(ee(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=K(e,Li.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=K(e,W.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(ee),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new At("addlayer",e)),this.layerGroupPropertyListenerKeys_=[K(e,Li.PROPERTYCHANGE,this.render,this),K(e,W.CHANGE,this.render,this),K(e,"addlayer",this.handleLayerAdd_,this),K(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const n=e[t].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){ql(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const t=this.getSize(),i=this.getView(),n=this.frameState_;let r=null;if(t!==void 0&&fa(t)&&i&&i.isDef()){const o=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=i.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:gr(a.center,a.resolution,a.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:U(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;r.nextExtent=gr(a.nextCenter,a.nextResolution,l,t)}}this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),n&&(!this.previousExtent_||!xs(this.previousExtent_)&&!an(r.extent,this.previousExtent_))&&(this.dispatchEvent(new Ei(gt.MOVESTART,this,n)),this.previousExtent_=xn(this.previousExtent_)),this.previousExtent_&&!r.viewHints[we.ANIMATING]&&!r.viewHints[we.INTERACTING]&&!an(r.extent,this.previousExtent_)&&(this.dispatchEvent(new Ei(gt.MOVEEND,this,r)),Va(r.extent,this.previousExtent_))),this.dispatchEvent(new Ei(gt.POSTRENDER,this,r)),this.renderComplete_=(this.hasListener(gt.LOADSTART)||this.hasListener(gt.LOADEND)||this.hasListener(Ye.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new At("removelayer",t)),this.set(ye.LAYERGROUP,e)}setSize(e){this.set(ye.SIZE,e)}setTarget(e){this.set(ye.TARGET,e)}setView(e){if(!e||e instanceof it){this.set(ye.VIEW,e);return}this.set(ye.VIEW,new it);const t=this;e.then(function(i){t.setView(new it(i))})}updateSize(){const e=this.getTargetElement();let t;if(e){const n=getComputedStyle(e),r=e.offsetWidth-parseFloat(n.borderLeftWidth)-parseFloat(n.paddingLeft)-parseFloat(n.paddingRight)-parseFloat(n.borderRightWidth),o=e.offsetHeight-parseFloat(n.borderTopWidth)-parseFloat(n.paddingTop)-parseFloat(n.paddingBottom)-parseFloat(n.borderBottomWidth);!isNaN(r)&&!isNaN(o)&&(t=[Math.max(0,r),Math.max(0,o)],!fa(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&sl("No map visible because the map container's width or height are 0."))}const i=this.getSize();t&&(!i||!Wt(t,i))&&(this.setSize(t),this.updateViewportSize_(t))}updateViewportSize_(e){const t=this.getView();t&&t.setViewportSize(e)}}function Hd(s){let e=null;s.keyboardEventTarget!==void 0&&(e=typeof s.keyboardEventTarget=="string"?document.getElementById(s.keyboardEventTarget):s.keyboardEventTarget);const t={},i=s.layers&&typeof s.layers.getLayers=="function"?s.layers:new ji({layers:s.layers});t[ye.LAYERGROUP]=i,t[ye.TARGET]=s.target,t[ye.VIEW]=s.view instanceof it?s.view:new it;let n;s.controls!==void 0&&(Array.isArray(s.controls)?n=new He(s.controls.slice()):(q(typeof s.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),n=s.controls));let r;s.interactions!==void 0&&(Array.isArray(s.interactions)?r=new He(s.interactions.slice()):(q(typeof s.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),r=s.interactions));let o;return s.overlays!==void 0?Array.isArray(s.overlays)?o=new He(s.overlays.slice()):(q(typeof s.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),o=s.overlays):o=new He,{controls:n,interactions:r,keyboardEventTarget:e,overlays:o,values:t}}function Jl(s,e,t,i){const n=[];let r=Be();for(let o=0,a=t.length;o<a;++o){const l=t[o];r=Or(s,e,l[0],i),n.push((r[0]+r[2])/2,(r[1]+r[3])/2),e=l[l.length-1]}return n}function cs(s,e,t,i,n,r,o){let a,l;const h=(t-e)/i;if(h===1)a=e;else if(h===2)a=e,l=n;else if(h!==0){let c=s[e],u=s[e+1],d=0;const f=[0];for(let _=e+i;_<t;_+=i){const p=s[_],y=s[_+1];d+=Math.sqrt((p-c)*(p-c)+(y-u)*(y-u)),f.push(d),c=p,u=y}const g=n*d,m=Sh(f,g);m<0?(l=(g-f[-m-2])/(f[-m-1]-f[-m-2]),a=e+(-m-2)*i):a=e+m*i}o=o>1?o:2,r=r||new Array(o);for(let c=0;c<o;++c)r[c]=a===void 0?NaN:l===void 0?s[a+c]:De(s[a+c],s[a+i+c],l);return r}function Tr(s,e,t,i,n,r){if(t==e)return null;let o;if(n<s[e+i-1])return r?(o=s.slice(e,e+i),o[i-1]=n,o):null;if(s[t-1]<n)return r?(o=s.slice(t-i,t),o[i-1]=n,o):null;if(n==s[e+i-1])return s.slice(e,e+i);let a=e/i,l=t/i;for(;a<l;){const d=a+l>>1;n<s[(d+1)*i-1]?l=d:a=d+1}const h=s[a*i-1];if(n==h)return s.slice((a-1)*i,(a-1)*i+i);const c=s[(a+1)*i-1],u=(n-h)/(c-h);o=[];for(let d=0;d<i-1;++d)o.push(De(s[(a-1)*i+d],s[a*i+d],u));return o.push(n),o}function qd(s,e,t,i,n,r,o){if(o)return Tr(s,e,t[t.length-1],i,n,r);let a;if(n<s[i-1])return r?(a=s.slice(0,i),a[i-1]=n,a):null;if(s[s.length-1]<n)return r?(a=s.slice(s.length-i),a[i-1]=n,a):null;for(let l=0,h=t.length;l<h;++l){const c=t[l];if(e!=c){if(n<s[e+i-1])return null;if(n<=s[c-1])return Tr(s,e,c,i,n,!1);e=c}}return null}class us extends gl{constructor(e){super(),this.geometries_=e,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(ee),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const e=this.geometries_;for(let t=0,i=e.length;t<i;++t)this.changeEventsKeys_.push(K(e[t],W.CHANGE,this.changed,this))}clone(){const e=new us(ir(this.geometries_));return e.applyProperties(this),e}closestPointXY(e,t,i,n){if(n<oi(this.getExtent(),e,t))return n;const r=this.geometries_;for(let o=0,a=r.length;o<a;++o)n=r[o].closestPointXY(e,t,i,n);return n}containsXY(e,t){const i=this.geometries_;for(let n=0,r=i.length;n<r;++n)if(i[n].containsXY(e,t))return!0;return!1}computeExtent(e){xn(e);const t=this.geometries_;for(let i=0,n=t.length;i<n;++i)qa(e,t[i].getExtent());return e}getGeometries(){return ir(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let e=[];const t=this.geometries_;for(let i=0,n=t.length;i<n;++i)t[i].getType()===this.getType()?e=e.concat(t[i].getGeometriesArrayRecursive()):e.push(t[i]);return e}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=[],i=this.geometries_;let n=!1;for(let r=0,o=i.length;r<o;++r){const a=i[r],l=a.getSimplifiedGeometry(e);t.push(l),l!==a&&(n=!0)}return n?new us(t):(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getType(){return"GeometryCollection"}intersectsExtent(e){const t=this.geometries_;for(let i=0,n=t.length;i<n;++i)if(t[i].intersectsExtent(e))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(e,t){const i=this.geometries_;for(let n=0,r=i.length;n<r;++n)i[n].rotate(e,t);this.changed()}scale(e,t,i){i||(i=Nt(this.getExtent()));const n=this.geometries_;for(let r=0,o=n.length;r<o;++r)n[r].scale(e,t,i);this.changed()}setGeometries(e){this.setGeometriesArray(ir(e))}setGeometriesArray(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()}applyTransform(e){const t=this.geometries_;for(let i=0,n=t.length;i<n;++i)t[i].applyTransform(e);this.changed()}translate(e,t){const i=this.geometries_;for(let n=0,r=i.length;n<r;++n)i[n].translate(e,t);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function ir(s){return s.map(e=>e.clone())}function Ql(s,e,t,i){let n=s[e],r=s[e+1],o=0;for(let a=e+i;a<t;a+=i){const l=s[a],h=s[a+1];o+=Math.sqrt((l-n)*(l-n)+(h-r)*(h-r)),n=l,r=h}return o}class Wi extends li{constructor(e,t){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendCoordinate(e){Ze(this.flatCoordinates,e),this.changed()}clone(){const e=new Wi(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,n){return n<oi(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(jr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ur(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,i,n))}forEachSegment(e){return El(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinateAtM(e,t){return this.layout!="XYM"&&this.layout!="XYZM"?null:(t=t!==void 0?t:!1,Tr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t))}getCoordinates(){return Lt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(e,t){return cs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,this.stride)}getLength(){return Ql(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(e){const t=[];return t.length=Ss(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new Wi(t,"XY")}getType(){return"LineString"}intersectsExtent(e){return Ts(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,this.getExtent())}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Rs(this.flatCoordinates,0,e,this.stride),this.changed()}}class ds extends li{constructor(e,t,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,t);else if(t!==void 0&&i)this.setFlatCoordinates(t,e),this.ends_=i;else{const n=e,r=[],o=[];for(let l=0,h=n.length;l<h;++l){const c=n[l];Ze(r,c.getFlatCoordinates()),o.push(r.length)}const a=n.length===0?this.getLayout():n[0].getLayout();this.setFlatCoordinates(a,r),this.ends_=o}}appendLineString(e){Ze(this.flatCoordinates,e.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new ds(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,n){return n<oi(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Zr(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Br(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,i,n))}getCoordinateAtM(e,t,i){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(t=t!==void 0?t:!1,i=i!==void 0?i:!1,qd(this.flatCoordinates,0,this.ends_,this.stride,e,t,i))}getCoordinates(){return cn(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(e){return e<0||this.ends_.length<=e?null:new Wi(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLineStrings(){const e=this.flatCoordinates,t=this.ends_,i=this.layout,n=[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=t[o],h=new Wi(e.slice(r,l),i);n.push(h),r=l}return n}getFlatMidpoints(){const e=[],t=this.flatCoordinates;let i=0;const n=this.ends_,r=this.stride;for(let o=0,a=n.length;o<a;++o){const l=n[o],h=cs(t,i,l,r,.5);Ze(e,h),i=l}return e}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=yl(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,i),new ds(t,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(e){return jc(this.flatCoordinates,0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=vn(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}class Ds extends li{constructor(e,t){super(),t&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendPoint(e){Ze(this.flatCoordinates,e.getFlatCoordinates()),this.changed()}clone(){const e=new Ds(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,n){if(n<oi(this.getExtent(),e,t))return n;const r=this.flatCoordinates,o=this.stride;for(let a=0,l=r.length;a<l;a+=o){const h=Qt(e,t,r[a],r[a+1]);if(h<n){n=h;for(let c=0;c<o;++c)i[c]=r[a+c];i.length=o}}return n}getCoordinates(){return Lt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(e){const t=this.flatCoordinates.length/this.stride;return e<0||t<=e?null:new Di(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)}getPoints(){const e=this.flatCoordinates,t=this.layout,i=this.stride,n=[];for(let r=0,o=e.length;r<o;r+=i){const a=new Di(e.slice(r,r+i),t);n.push(a)}return n}getType(){return"MultiPoint"}intersectsExtent(e){const t=this.flatCoordinates,i=this.stride;for(let n=0,r=t.length;n<r;n+=i){const o=t[n],a=t[n+1];if(Fr(e,o,a))return!0}return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Rs(this.flatCoordinates,0,e,this.stride),this.changed()}}class fs extends li{constructor(e,t,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(e[0])){const n=e,r=[],o=[];for(let a=0,l=n.length;a<l;++a){const h=n[a],c=r.length,u=h.getEnds();for(let d=0,f=u.length;d<f;++d)u[d]+=c;Ze(r,h.getFlatCoordinates()),o.push(u)}t=n.length===0?this.getLayout():n[0].getLayout(),e=r,i=o}t!==void 0&&i?(this.setFlatCoordinates(t,e),this.endss_=i):this.setCoordinates(e,t)}appendPolygon(e){let t;if(!this.flatCoordinates)this.flatCoordinates=e.getFlatCoordinates().slice(),t=e.getEnds().slice(),this.endss_.push();else{const i=this.flatCoordinates.length;Ze(this.flatCoordinates,e.getFlatCoordinates()),t=e.getEnds().slice();for(let n=0,r=t.length;n<r;++n)t[n]+=i}this.endss_.push(t),this.changed()}clone(){const e=this.endss_.length,t=new Array(e);for(let n=0;n<e;++n)t[n]=this.endss_[n].slice();const i=new fs(this.flatCoordinates.slice(),this.layout,t);return i.applyProperties(this),i}closestPointXY(e,t,i,n){return n<oi(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(kc(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Nc(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,i,n))}containsXY(e,t){return Yc(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)}getArea(){return Dc(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),Er(t,0,this.endss_,this.stride,e)):t=this.flatCoordinates,wr(t,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const e=Jl(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=wl(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new Ds(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;vl(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=Er(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=zc(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),t,0,i),new fs(t,"XY",i)}getPolygon(e){if(e<0||this.endss_.length<=e)return null;let t;if(e===0)t=0;else{const r=this.endss_[e-1];t=r[r.length-1]}const i=this.endss_[e].slice(),n=i[i.length-1];if(t!==0)for(let r=0,o=i.length;r<o;++r)i[r]-=t;return new Gt(this.flatCoordinates.slice(t,n),this.layout,i)}getPolygons(){const e=this.layout,t=this.flatCoordinates,i=this.endss_,n=[];let r=0;for(let o=0,a=i.length;o<a;++o){const l=i[o].slice(),h=l[l.length-1];if(r!==0)for(let u=0,d=l.length;u<d;++u)l[u]-=r;const c=new Gt(t.slice(r,h),e,l);n.push(c),r=h}return n}getType(){return"MultiPolygon"}intersectsExtent(e){return Zc(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=pl(this.flatCoordinates,0,e,this.stride,this.endss_);if(i.length===0)this.flatCoordinates.length=0;else{const n=i[i.length-1];this.flatCoordinates.length=n.length===0?0:n[n.length-1]}this.changed()}}const Sa=qe();class ke{constructor(e,t,i,n,r,o){this.styleFunction,this.extent_,this.id_=o,this.type_=e,this.flatCoordinates_=t,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i||null,this.properties_=r,this.squaredTolerance_,this.stride_=n,this.simplifiedGeometry_}get(e){return this.properties_[e]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?Ha(this.flatCoordinates_):Or(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const e=Nt(this.getExtent());this.flatInteriorPoints_=Hr(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const e=Bc(this.flatCoordinates_,this.ends_),t=Jl(this.flatCoordinates_,0,e,2);this.flatInteriorPoints_=wl(this.flatCoordinates_,0,e,2,t)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=cs(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const e=this.flatCoordinates_;let t=0;const i=this.ends_;for(let n=0,r=i.length;n<r;++n){const o=i[n],a=cs(e,t,o,2,.5);Ze(this.flatMidpoints_,a),t=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(e){return this}simplifyTransformed(e,t){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(e){e=se(e);const t=e.getExtent(),i=e.getWorldExtent();if(t&&i){const n=ve(i)/ve(t);wt(Sa,i[0],i[3],n,-n,0,0,0),Ot(this.flatCoordinates_,0,this.flatCoordinates_.length,2,Sa,this.flatCoordinates_)}}applyTransform(e){e(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var e;return new ke(this.type_,this.flatCoordinates_.slice(),(e=this.ends_)==null?void 0:e.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=Ya((e,t)=>{if(e===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),t&&this.simplifiedGeometry_.applyTransform(t);const i=this.simplifiedGeometry_.getFlatCoordinates();let n;switch(this.type_){case"LineString":i.length=Ss(i,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,e,i,0),n=[i.length];break;case"MultiLineString":n=[],i.length=yl(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,e,i,0,n);break;case"Polygon":n=[],i.length=Kr(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(e),i,0,n);break}return n&&(this.simplifiedGeometry_=new ke(this.type_,i,n,2,this.properties_,this.id_)),this.squaredTolerance_=e,this.simplifiedGeometry_}),this}}ke.prototype.getFlatCoordinates=ke.prototype.getOrientedFlatCoordinates;class $d{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=ni,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let i=t.dataProjection?se(t.dataProjection):this.readProjection(e);t.extent&&i&&i.getUnits()==="tile-pixels"&&(i=se(i),i.setWorldExtent(t.extent)),t={dataProjection:i,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},e)}getType(){return N()}readFeature(e,t){return N()}readFeatures(e,t){return N()}readGeometry(e,t){return N()}readProjection(e){return N()}writeFeature(e,t){return N()}writeFeatures(e,t){return N()}writeGeometry(e,t){return N()}}function _o(s,e,t){const i=t?se(t.featureProjection):null,n=t?se(t.dataProjection):null;let r=s;if(i&&n&&!Jn(i,n)){e&&(r=s.clone());const o=e?i:n,a=e?n:i;o.getUnits()==="tile-pixels"?r.transform(o,a):r.applyTransform(hn(o,a))}if(e&&t&&t.decimals!==void 0){const o=Math.pow(10,t.decimals),a=function(l){for(let h=0,c=l.length;h<c;++h)l[h]=Math.round(l[h]*o)/o;return l};r===s&&(r=s.clone()),r.applyTransform(a)}return r}const Jd={Point:Di,LineString:Wi,Polygon:Gt,MultiPoint:Ds,MultiLineString:ds,MultiPolygon:fs};function Qd(s,e,t){return Array.isArray(e[0])?(vl(s,0,e,t)||(s=s.slice(),Er(s,0,e,t)),s):($r(s,0,e,t)||(s=s.slice(),ss(s,0,e,t)),s)}function eh(s,e){var r;const t=s.geometry;if(!t)return[];if(Array.isArray(t))return t.map(o=>eh({...s,geometry:o})).flat();const i=t.type==="MultiPolygon"?"Polygon":t.type;if(i==="GeometryCollection"||i==="Circle")throw new Error("Unsupported geometry type: "+i);const n=t.layout.length;return _o(new ke(i,i==="Polygon"?Qd(t.flatCoordinates,t.ends,n):t.flatCoordinates,(r=t.ends)==null?void 0:r.flat(),n,s.properties||{},s.id).enableSimplifyTransformed(),!1,e)}function po(s,e){if(!s)return null;if(Array.isArray(s)){const i=s.map(n=>po(n,e));return new us(i)}const t=Jd[s.type];return _o(new t(s.flatCoordinates,s.layout||"XY",s.ends),!1,e)}class ef extends $d{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(Xn(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(Xn(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return N()}readFeaturesFromObject(e,t){return N()}readGeometry(e,t){return this.readGeometryFromObject(Xn(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return N()}readProjection(e){return this.readProjectionFromObject(Xn(e))}readProjectionFromObject(e){return N()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return N()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return N()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return N()}}function Xn(s){if(typeof s=="string"){const e=JSON.parse(s);return e||null}return s!==null?s:null}class th extends ef{constructor(e){e=e||{},super(),this.dataProjection=se(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=se(e.featureProjection)),e.featureClass&&(this.featureClass=e.featureClass),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let i=null;e.type==="Feature"?i=e:i={type:"Feature",geometry:e,properties:null};const n=yo(i.geometry);if(this.featureClass===ke)return eh({geometry:n,id:i.id,properties:i.properties},t);const r=new ni;return this.geometryName_?r.setGeometryName(this.geometryName_):this.extractGeometryName_&&i.geometry_name&&r.setGeometryName(i.geometry_name),r.setGeometry(po(n,t)),"id"in i&&r.setId(i.id),i.properties&&r.setProperties(i.properties,!0),r}readFeaturesFromObject(e,t){const i=e;let n=null;if(i.type==="FeatureCollection"){const r=e;n=[];const o=r.features;for(let a=0,l=o.length;a<l;++a){const h=this.readFeatureFromObject(o[a],t);h&&n.push(h)}}else n=[this.readFeatureFromObject(e,t)];return n.flat()}readGeometryFromObject(e,t){return tf(e,t)}readProjectionFromObject(e){const t=e.crs;let i;if(t)if(t.type=="name")i=se(t.properties.name);else if(t.type==="EPSG")i=se("EPSG:"+t.properties.code);else throw new Error("Unknown SRS type");else i=this.dataProjection;return i}writeFeatureObject(e,t){t=this.adaptOptions(t);const i={type:"Feature",geometry:null,properties:null},n=e.getId();if(n!==void 0&&(i.id=n),!e.hasProperties())return i;const r=e.getProperties(),o=e.getGeometry();return o&&(i.geometry=Ir(o,t),delete r[e.getGeometryName()]),ii(r)||(i.properties=r),i}writeFeaturesObject(e,t){t=this.adaptOptions(t);const i=[];for(let n=0,r=e.length;n<r;++n)i.push(this.writeFeatureObject(e[n],t));return{type:"FeatureCollection",features:i}}writeGeometryObject(e,t){return Ir(e,this.adaptOptions(t))}}function yo(s,e){if(!s)return null;let t;switch(s.type){case"Point":{t=sf(s);break}case"LineString":{t=rf(s);break}case"Polygon":{t=hf(s);break}case"MultiPoint":{t=af(s);break}case"MultiLineString":{t=of(s);break}case"MultiPolygon":{t=lf(s);break}case"GeometryCollection":{t=nf(s);break}default:throw new Error("Unsupported GeoJSON type: "+s.type)}return t}function tf(s,e){const t=yo(s);return po(t,e)}function nf(s,e){return s.geometries.map(function(i){return yo(i)})}function sf(s){const e=s.coordinates;return{type:"Point",flatCoordinates:e,layout:hi(e.length)}}function rf(s){var i;const e=s.coordinates,t=e.flat();return{type:"LineString",flatCoordinates:t,ends:[t.length],layout:hi(((i=e[0])==null?void 0:i.length)||2)}}function of(s){var r,o;const e=s.coordinates,t=((o=(r=e[0])==null?void 0:r[0])==null?void 0:o.length)||2,i=[],n=vn(i,0,e,t);return{type:"MultiLineString",flatCoordinates:i,ends:n,layout:hi(t)}}function af(s){var t;const e=s.coordinates;return{type:"MultiPoint",flatCoordinates:e.flat(),layout:hi(((t=e[0])==null?void 0:t.length)||2)}}function lf(s){var r,o;const e=s.coordinates,t=[],i=((o=(r=e[0])==null?void 0:r[0])==null?void 0:o[0].length)||2,n=pl(t,0,e,i);return{type:"MultiPolygon",flatCoordinates:t,ends:n,layout:hi(i)}}function hf(s){var r,o;const e=s.coordinates,t=[],i=(o=(r=e[0])==null?void 0:r[0])==null?void 0:o.length,n=vn(t,0,e,i);return{type:"Polygon",flatCoordinates:t,ends:n,layout:hi(i)}}function Ir(s,e){s=_o(s,!0,e);const t=s.getType();let i;switch(t){case"Point":{i=mf(s);break}case"LineString":{i=uf(s);break}case"Polygon":{i=_f(s,e);break}case"MultiPoint":{i=ff(s);break}case"MultiLineString":{i=df(s);break}case"MultiPolygon":{i=gf(s,e);break}case"GeometryCollection":{i=cf(s,e);break}case"Circle":{i={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+t)}return i}function cf(s,e){return e=Object.assign({},e),delete e.featureProjection,{type:"GeometryCollection",geometries:s.getGeometriesArray().map(function(i){return Ir(i,e)})}}function uf(s,e){return{type:"LineString",coordinates:s.getCoordinates()}}function df(s,e){return{type:"MultiLineString",coordinates:s.getCoordinates()}}function ff(s,e){return{type:"MultiPoint",coordinates:s.getCoordinates()}}function gf(s,e){let t;return e&&(t=e.rightHanded),{type:"MultiPolygon",coordinates:s.getCoordinates(t)}}function mf(s,e){return{type:"Point",coordinates:s.getCoordinates()}}function _f(s,e){let t;return e&&(t=e.rightHanded),{type:"Polygon",coordinates:s.getCoordinates(t)}}class wo extends ps{constructor(e,t,i){super(),i=i||{},this.tileCoord=e,this.state=t,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(W.CHANGE)}release(){this.setState(L.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==L.EMPTY){if(this.state!==L.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}}load(){N()}getAlpha(e,t){if(!this.transition_)return 1;let i=this.transitionStarts_[e];if(!i)i=t,this.transitionStarts_[e]=i;else if(i===-1)return 1;const n=t-i+1e3/60;return n>=this.transition_?1:nl(n/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}disposeInternal(){this.release(),super.disposeInternal()}}function br(s){return s instanceof Image||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageBitmap?s:null}const pf=new Error("disposed"),yf=[256,256];class Ta extends wo{constructor(e){const t=L.IDLE;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null,this.controller_=e.controller||null}getSize(){if(this.size_)return this.size_;const e=br(this.data_);return e?[e.width,e.height]:yf}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==L.IDLE&&this.state!==L.ERROR)return;this.state=L.LOADING,this.changed();const e=this;this.loader_().then(function(t){e.data_=t,e.state=L.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=L.ERROR,e.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(pf),this.controller_=null),super.disposeInternal()}}class ih extends wo{constructor(e,t,i,n,r,o){super(e,t,o),this.crossOrigin_=n,this.src_=i,this.key=i,this.image_=new Image,n!==null&&(this.image_.crossOrigin=n),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(e){this.image_=e,this.state=L.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=L.ERROR,this.unlistenImage_(),this.image_=wf(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=L.LOADED:this.state=L.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==L.ERROR&&(this.state=L.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==L.IDLE&&(this.state=L.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=pd(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}}function wf(){const s=ue(1,1);return s.fillStyle="rgba(0,0,0,0)",s.fillRect(0,0,1,1),s.canvas}class Eo{constructor(e,t,i,n){this.minX=e,this.maxX=t,this.minY=i,this.maxY=n}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function pi(s,e,t,i,n){return n!==void 0?(n.minX=s,n.maxX=e,n.minY=t,n.maxY=i,n):new Eo(s,e,t,i)}let nr;const Mi=[];function Ia(s,e,t,i,n){s.beginPath(),s.moveTo(0,0),s.lineTo(e,t),s.lineTo(i,n),s.closePath(),s.save(),s.clip(),s.fillRect(0,0,Math.max(e,i)+1,Math.max(t,n)),s.restore()}function sr(s,e){return Math.abs(s[e*4]-210)>2||Math.abs(s[e*4+3]-.75*255)>2}function Ef(){if(nr===void 0){const s=ue(6,6,Mi);s.globalCompositeOperation="lighter",s.fillStyle="rgba(210, 0, 0, 0.75)",Ia(s,4,5,4,0),Ia(s,4,5,0,5);const e=s.getImageData(0,0,3,3).data;nr=sr(e,0)||sr(e,4)||sr(e,8),bs(s),Mi.push(s.canvas)}return nr}function ba(s,e,t,i){const n=cl(t,e,s);let r=Vo(e,i,t);const o=e.getMetersPerUnit();o!==void 0&&(r*=o);const a=s.getMetersPerUnit();a!==void 0&&(r/=a);const l=s.getExtent();if(!l||Fi(l,n)){const h=Vo(s,r,n)/r;isFinite(h)&&h>0&&(r/=h)}return r}function xf(s,e,t,i){const n=Nt(t);let r=ba(s,e,n,i);return(!isFinite(r)||r<=0)&&Ja(t,function(o){return r=ba(s,e,o,i),isFinite(r)&&r>0}),r}function Cf(s,e,t,i,n,r,o,a,l,h,c,u,d,f){const g=ue(Math.round(t*s),Math.round(t*e),Mi);if(u||(g.imageSmoothingEnabled=!1),l.length===0)return g.canvas;g.scale(t,t);function m(E){return Math.round(E*t)/t}g.globalCompositeOperation="lighter";const _=Be();l.forEach(function(E,R,I){qa(_,E.extent)});let p;const y=t/i,x=(u?1:1+Math.pow(2,-24))/y;p=ue(Math.round(Q(_)*y),Math.round(ve(_)*y),Mi),u||(p.imageSmoothingEnabled=!1),l.forEach(function(E,R,I){if(E.image.width>0&&E.image.height>0){if(E.clipExtent){p.save();const F=(E.clipExtent[0]-_[0])*y,D=-(E.clipExtent[3]-_[3])*y,b=Q(E.clipExtent)*y,V=ve(E.clipExtent)*y;p.rect(u?F:Math.round(F),u?D:Math.round(D),u?b:Math.round(F+b)-Math.round(F),u?V:Math.round(D+V)-Math.round(D)),p.clip()}const v=(E.extent[0]-_[0])*y,S=-(E.extent[3]-_[3])*y,A=Q(E.extent)*y,O=ve(E.extent)*y;p.drawImage(E.image,h,h,E.image.width-2*h,E.image.height-2*h,u?v:Math.round(v),u?S:Math.round(S),u?A:Math.round(v+A)-Math.round(v),u?O:Math.round(S+O)-Math.round(S)),E.clipExtent&&p.restore()}});const w=ai(o);return a.getTriangles().forEach(function(E,R,I){const v=E.source,S=E.target;let A=v[0][0],O=v[0][1],F=v[1][0],D=v[1][1],b=v[2][0],V=v[2][1];const M=m((S[0][0]-w[0])/r),G=m(-(S[0][1]-w[1])/r),Y=m((S[1][0]-w[0])/r),Z=m(-(S[1][1]-w[1])/r),z=m((S[2][0]-w[0])/r),H=m(-(S[2][1]-w[1])/r),T=A,ge=O;A=0,O=0,F-=T,D-=ge,b-=T,V-=ge;const Re=[[F,D,0,0,Y-M],[b,V,0,0,z-M],[0,0,F,D,Z-G],[0,0,b,V,H-G]],te=Xh(Re);if(!te)return;if(g.save(),g.beginPath(),Ef()||!u){g.moveTo(Y,Z);const Se=4,Oe=M-Y,Yt=G-Z;for(let me=0;me<Se;me++)g.lineTo(Y+m((me+1)*Oe/Se),Z+m(me*Yt/(Se-1))),me!=Se-1&&g.lineTo(Y+m((me+1)*Oe/Se),Z+m((me+1)*Yt/(Se-1)));g.lineTo(z,H)}else g.moveTo(Y,Z),g.lineTo(M,G),g.lineTo(z,H);g.clip(),g.transform(te[0],te[2],te[1],te[3],M,G),g.translate(_[0]-T,_[3]-ge);let Ee;if(p)Ee=p.canvas,g.scale(x,-x);else{const Se=l[0],Oe=Se.extent;Ee=Se.image,g.scale(Q(Oe)/Ee.width,-ve(Oe)/Ee.height)}g.drawImage(Ee,0,0),g.restore()}),p&&(bs(p),Mi.push(p.canvas)),c&&(g.save(),g.globalCompositeOperation="source-over",g.strokeStyle="black",g.lineWidth=1,a.getTriangles().forEach(function(E,R,I){const v=E.target,S=(v[0][0]-w[0])/r,A=-(v[0][1]-w[1])/r,O=(v[1][0]-w[0])/r,F=-(v[1][1]-w[1])/r,D=(v[2][0]-w[0])/r,b=-(v[2][1]-w[1])/r;g.beginPath(),g.moveTo(O,F),g.lineTo(S,A),g.lineTo(D,b),g.closePath(),g.stroke()}),g.restore()),g.canvas}const vf=10,Aa=.25;class Rf{constructor(e,t,i,n,r,o,a){this.sourceProj_=e,this.targetProj_=t;let l={};const h=a?Tc(x=>le(a,cl(x,this.targetProj_,this.sourceProj_))):hn(this.targetProj_,this.sourceProj_);this.transformInv_=function(x){const w=x[0]+"/"+x[1];return l[w]||(l[w]=h(x)),l[w]},this.maxSourceExtent_=n,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&Q(n)>=Q(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Q(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Q(this.targetProj_.getExtent()):null;const c=ai(i),u=Es(i),d=ws(i),f=ys(i),g=this.transformInv_(c),m=this.transformInv_(u),_=this.transformInv_(d),p=this.transformInv_(f),y=vf+(o?Math.max(0,Math.ceil(Math.log2(fr(i)/(o*o*256*256)))):0);if(this.addQuad_(c,u,d,f,g,m,_,p,y),this.wrapsXInSource_){let x=1/0;this.triangles_.forEach(function(w,E,R){x=Math.min(x,w.source[0][0],w.source[1][0],w.source[2][0])}),this.triangles_.forEach(w=>{if(Math.max(w.source[0][0],w.source[1][0],w.source[2][0])-x>this.sourceWorldWidth_/2){const E=[[w.source[0][0],w.source[0][1]],[w.source[1][0],w.source[1][1]],[w.source[2][0],w.source[2][1]]];E[0][0]-x>this.sourceWorldWidth_/2&&(E[0][0]-=this.sourceWorldWidth_),E[1][0]-x>this.sourceWorldWidth_/2&&(E[1][0]-=this.sourceWorldWidth_),E[2][0]-x>this.sourceWorldWidth_/2&&(E[2][0]-=this.sourceWorldWidth_);const R=Math.min(E[0][0],E[1][0],E[2][0]);Math.max(E[0][0],E[1][0],E[2][0])-R<this.sourceWorldWidth_/2&&(w.source=E)}})}l={}}addTriangle_(e,t,i,n,r,o){this.triangles_.push({source:[n,r,o],target:[e,t,i]})}addQuad_(e,t,i,n,r,o,a,l,h){const c=Wo([r,o,a,l]),u=this.sourceWorldWidth_?Q(c)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,f=this.sourceProj_.canWrapX()&&u>.5&&u<1;let g=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const _=Wo([e,t,i,n]);g=Q(_)/this.targetWorldWidth_>Aa||g}!f&&this.sourceProj_.isGlobal()&&u&&(g=u>Aa||g)}if(!g&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!Ae(c,this.maxSourceExtent_))return;let m=0;if(!g&&(!isFinite(r[0])||!isFinite(r[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)g=!0;else if(m=(!isFinite(r[0])||!isFinite(r[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),m!=1&&m!=2&&m!=4&&m!=8)return}if(h>0){if(!g){const _=[(e[0]+i[0])/2,(e[1]+i[1])/2],p=this.transformInv_(_);let y;f?y=(Ii(r[0],d)+Ii(a[0],d))/2-Ii(p[0],d):y=(r[0]+a[0])/2-p[0];const x=(r[1]+a[1])/2-p[1];g=y*y+x*x>this.errorThresholdSquared_}if(g){if(Math.abs(e[0]-i[0])<=Math.abs(e[1]-i[1])){const _=[(t[0]+i[0])/2,(t[1]+i[1])/2],p=this.transformInv_(_),y=[(n[0]+e[0])/2,(n[1]+e[1])/2],x=this.transformInv_(y);this.addQuad_(e,t,_,y,r,o,p,x,h-1),this.addQuad_(y,_,i,n,x,p,a,l,h-1)}else{const _=[(e[0]+t[0])/2,(e[1]+t[1])/2],p=this.transformInv_(_),y=[(i[0]+n[0])/2,(i[1]+n[1])/2],x=this.transformInv_(y);this.addQuad_(e,_,y,n,r,p,x,l,h-1),this.addQuad_(_,t,i,y,p,o,a,x,h-1)}return}}if(f){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(m&11)==0&&this.addTriangle_(e,i,n,r,a,l),(m&14)==0&&this.addTriangle_(e,i,t,r,a,o),m&&((m&13)==0&&this.addTriangle_(t,n,e,o,l,r),(m&7)==0&&this.addTriangle_(t,n,i,o,l,a))}calculateSourceExtent(){const e=Be();return this.triangles_.forEach(function(t,i,n){const r=t.source;on(e,r[0]),on(e,r[1]),on(e,r[2])}),e}getTriangles(){return this.triangles_}}const Sf=.5;class nh extends wo{constructor(e,t,i,n,r,o,a,l,h,c,u,d){super(r,L.IDLE,d),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=n,this.wrappedTileCoord_=o||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=e.canWrapX()?e.getExtent():void 0;const f=n.getTileCoordExtent(this.wrappedTileCoord_),g=this.targetTileGrid_.getExtent();let m=this.sourceTileGrid_.getExtent();const _=g?ei(f,g):f;if(fr(_)===0){this.state=L.EMPTY;return}const p=e.getExtent();p&&(m?m=ei(m,p):m=p);const y=n.getResolution(this.wrappedTileCoord_[0]),x=xf(e,i,_,y);if(!isFinite(x)||x<=0){this.state=L.EMPTY;return}const w=c!==void 0?c:Sf;if(this.triangulation_=new Rf(e,i,_,m,x*w,y),this.triangulation_.getTriangles().length===0){this.state=L.EMPTY;return}this.sourceZ_=t.getZForResolution(x);let E=this.triangulation_.calculateSourceExtent();if(m&&(e.canWrapX()?(E[1]=re(E[1],m[1],m[3]),E[3]=re(E[3],m[1],m[3])):E=ei(E,m)),!fr(E))this.state=L.EMPTY;else{let R=0,I=0;e.canWrapX()&&(R=Q(p),I=Math.floor((E[0]-p[0])/R)),tl(E.slice(),e,!0).forEach(S=>{const A=t.getTileRangeForExtentAndZ(S,this.sourceZ_);for(let O=A.minX;O<=A.maxX;O++)for(let F=A.minY;F<=A.maxY;F++){const D=h(this.sourceZ_,O,F,a);if(D){const b=I*R;this.sourceTiles_.push({tile:D,offset:b})}}++I}),this.sourceTiles_.length===0&&(this.state=L.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{var n;const i=t.tile;if(i&&i.getState()==L.LOADED){const r=this.sourceTileGrid_.getTileCoordExtent(i.tileCoord);r[0]+=t.offset,r[2]+=t.offset;const o=(n=this.clipExtent_)==null?void 0:n.slice();o&&(o[0]+=t.offset,o[2]+=t.offset),e.push({extent:r,clipExtent:o,image:i.getImage()})}}),this.sourceTiles_.length=0,e.length===0)this.state=L.ERROR;else{const t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),n=typeof i=="number"?i:i[0],r=typeof i=="number"?i:i[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Cf(n,r,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=L.LOADED}this.changed()}load(){if(this.state==L.IDLE){this.state=L.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{const i=t.getState();if(i==L.IDLE||i==L.LOADING){e++;const n=K(t,W.CHANGE,r=>{const o=t.getState();(o==L.LOADED||o==L.ERROR||o==L.EMPTY)&&(ee(n),e--,e===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(n)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:t},i,n){t.getState()==L.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(ee),this.sourcesListenerKeys_=null}release(){this.canvas_&&(bs(this.canvas_.getContext("2d")),Mi.push(this.canvas_),this.canvas_=null),super.release()}}class Tf{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){const e=this.pop();e instanceof _s&&e.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const i=this.entries_[e];return q(i!==void 0,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(e){const t=this.entries_[e];return q(t!==void 0,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.key_;return e}getValues(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){var t;return(t=this.entries_[e])==null?void 0:t.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){q(!(e in this.entries_),"Tried to set a value for a key that is used already");const i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_}setSize(e){this.highWaterMark=e}}function gs(s,e,t,i){return i!==void 0?(i[0]=s,i[1]=e,i[2]=t,i):[s,e,t]}function If(s,e,t){return s+"/"+e+"/"+t}function bf(s){return Af(s[0],s[1],s[2])}function Af(s,e,t){return(e<<s)+t}function Mf(s,e){const t=s[0],i=s[1],n=s[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;const r=e.getFullTileRange(t);return r?r.containsXY(i,n):!0}class sh{constructor(){Oo(this,"pushMethodArgs_",(...e)=>(this.instructions_[this.zIndex+this.offset_].push(e),this));this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(rs(),{get:(e,t)=>{if(typeof rs()[t]=="function")return this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(t),this.pushMethodArgs_},set:(e,t,i)=>(this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(t,i),!0)})}pushFunction(e){this.instructions_[this.zIndex+this.offset_].push(e)}getContext(){return this.context_}draw(e){this.instructions_.forEach(t=>{for(let i=0,n=t.length;i<n;++i){const r=t[i];if(typeof r=="function"){r(e);continue}const o=t[++i];if(typeof e[r]=="function")e[r](...o);else{if(typeof o=="function"){e[r]=o(e);continue}e[r]=o}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const Lf=5;class Pf extends En{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.staleKeys_=new Array,this.maxStaleKeys=Lf}getStaleKeys(){return this.staleKeys_}prependStaleKey(e){this.staleKeys_.unshift(e),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(e){return N()}getData(e){return null}prepareFrame(e){return N()}renderFrame(e,t){return N()}forEachFeatureAtCoordinate(e,t,i,n,r){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const t=e.target;(t.getState()===j.LOADED||t.getState()===j.ERROR)&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=j.LOADED&&t!=j.ERROR&&e.addEventListener(W.CHANGE,this.boundHandleImageChange_),t==j.IDLE&&(e.load(),t=e.getState()),t==j.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}renderDeferred(e){}disposeInternal(){delete this.layer_,super.disposeInternal()}}const Ma=[];let vi=null;function Ff(){vi=ue(1,1,void 0,{willReadFrequently:!0})}class rh extends Pf{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=qe(),this.pixelTransform=qe(),this.inversePixelTransform=qe(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(e,t,i){vi||Ff(),vi.clearRect(0,0,1,1);let n;try{vi.drawImage(e,t,i,1,1,0,0,1,1),n=vi.getImageData(0,0,1,1).data}catch{return vi=null,null}return n}getBackground(e){let i=this.getLayer().getBackground();return typeof i=="function"&&(i=i(e.viewState.resolution)),i||void 0}useContainer(e,t,i){const n=this.getLayer().getClassName();let r,o;if(e&&e.className===n&&(!i||e&&e.style.backgroundColor&&Wt(ki(e.style.backgroundColor),ki(i)))){const a=e.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===t?(this.container=e,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){r=document.createElement("div"),r.className=n;let a=r.style;a.position="absolute",a.width="100%",a.height="100%",o=ue();const l=o.canvas;r.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=r,this.context=o}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(e,t,i){const n=ai(i),r=Es(i),o=ws(i),a=ys(i);le(t.coordinateToPixelTransform,n),le(t.coordinateToPixelTransform,r),le(t.coordinateToPixelTransform,o),le(t.coordinateToPixelTransform,a);const l=this.inversePixelTransform;le(l,n),le(l,r),le(l,o),le(l,a),e.save(),e.beginPath(),e.moveTo(Math.round(n[0]),Math.round(n[1])),e.lineTo(Math.round(r[0]),Math.round(r[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()}prepareContainer(e,t){const i=e.extent,n=e.viewState.resolution,r=e.viewState.rotation,o=e.pixelRatio,a=Math.round(Q(i)/n*o),l=Math.round(ve(i)/n*o);wt(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/o,1/o,r,-a/2,-l/2),dl(this.inversePixelTransform,this.pixelTransform);const h=Mc(this.pixelTransform);if(this.useContainer(t,h,this.getBackground(e)),!this.containerReused){const c=this.context.canvas;c.width!=a||c.height!=l?(c.width=a,c.height=l):this.context.clearRect(0,0,a,l),h!==c.style.transform&&(c.style.transform=h)}}dispatchRenderEvent_(e,t,i){const n=this.getLayer();if(n.hasListener(e)){const r=new Hl(e,this.inversePixelTransform,i,t);n.dispatchEvent(r)}}preRender(e,t){this.frameState=t,!t.declutter&&this.dispatchRenderEvent_(Ye.PRERENDER,e,t)}postRender(e,t){t.declutter||this.dispatchRenderEvent_(Ye.POSTRENDER,e,t)}renderDeferredInternal(e){}getRenderContext(e){return e.declutter&&!this.deferredContext_&&(this.deferredContext_=new sh),e.declutter?this.deferredContext_.getContext():this.context}renderDeferred(e){e.declutter&&(this.dispatchRenderEvent_(Ye.PRERENDER,this.context,e),e.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(e),this.dispatchRenderEvent_(Ye.POSTRENDER,this.context,e))}getRenderTransform(e,t,i,n,r,o,a){const l=r/2,h=o/2,c=n/t,u=-c,d=-e[0]+a,f=-e[1];return wt(this.tempTransform,l,h,c,u,-i,d,f)}disposeInternal(){delete this.frameState,super.disposeInternal()}}function rr(s,e,t,i){return`${s},${If(e,t,i)}`}function or(s,e,t){if(!(t in s))return s[t]=new Set([e]),!0;const i=s[t],n=i.has(e);return n||i.add(e),!n}function Of(s,e,t){const i=s[t];return i?i.delete(e):!1}function La(s,e){const t=s.layerStatesArray[s.layerIndex];t.extent&&(e=ei(e,Mt(t.extent,s.viewState.projection)));const i=t.layer.getRenderSource();if(!i.getWrapX()){const n=i.getTileGridForProjection(s.viewState.projection).getExtent();n&&(e=ei(e,n))}return e}class Df extends rh{constructor(e,t){super(e),t=t||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision_,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=Be(),this.tempTileRange_=new Eo(0,0,0,0),this.tempTileCoord_=gs(0,0,0);const i=t.cacheSize!==void 0?t.cacheSize:512;this.tileCache_=new Tf(i),this.maxStaleKeys=i*.5}getTileCache(){return this.tileCache_}getOrCreateTile(e,t,i,n){const r=this.tileCache_,a=this.getLayer().getSource(),l=rr(a.getKey(),e,t,i);let h;if(r.containsKey(l))h=r.get(l);else{if(h=a.getTile(e,t,i,n.pixelRatio,n.viewState.projection),!h)return null;r.set(l,h)}return h}getTile(e,t,i,n){const r=this.getOrCreateTile(e,t,i,n);return r||null}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),n=le(t.pixelToCoordinateTransform,e.slice()),r=i.getExtent();if(r&&!Fi(r,n))return null;const o=t.viewState,a=i.getRenderSource(),l=a.getTileGridForProjection(o.projection),h=a.getTilePixelRatio(t.pixelRatio);for(let c=l.getZForResolution(o.resolution);c>=l.getMinZoom();--c){const u=l.getTileCoordForCoordAndZ(n,c),d=this.getTile(c,u[1],u[2],t);if(!d||d.getState()!==L.LOADED)continue;const f=l.getOrigin(c),g=Le(l.getTileSize(c)),m=l.getResolution(c);let _;if(d instanceof ih||d instanceof nh)_=d.getImage();else if(d instanceof Ta){if(_=br(d.getData()),!_)continue}else continue;const p=Math.floor(h*((n[0]-f[0])/m-u[1]*g[0])),y=Math.floor(h*((f[1]-n[1])/m-u[2]*g[1])),x=Math.round(h*a.getGutterForProjection(o.projection));return this.getImageData(_,p+x,y+x)}return null}prepareFrame(e){this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;const t=this.getLayer().getSource();if(!t)return!1;const i=t.getRevision();return this.renderedRevision_?this.renderedRevision_!==i&&(this.renderedRevision_=i,this.renderedSourceKey_===t.getKey()&&this.tileCache_.clear()):this.renderedRevision_=i,!0}enqueueTiles(e,t,i,n,r){const o=e.viewState,a=this.getLayer(),l=a.getRenderSource(),h=l.getTileGridForProjection(o.projection),c=U(l);c in e.wantedTiles||(e.wantedTiles[c]={});const u=e.wantedTiles[c],d=a.getMapInternal(),f=Math.max(i-r,h.getMinZoom(),h.getZForResolution(Math.min(a.getMaxResolution(),d?d.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):h.getResolution(0)),l.zDirection)),g=o.rotation,m=g?Qa(o.center,o.resolution,g,e.size):void 0;for(let _=i;_>=f;--_){const p=h.getTileRangeForExtentAndZ(t,_,this.tempTileRange_),y=h.getResolution(_);for(let x=p.minX;x<=p.maxX;++x)for(let w=p.minY;w<=p.maxY;++w){if(g&&!h.tileCoordIntersectsViewport([_,x,w],m))continue;const E=this.getTile(_,x,w,e);if(!E||!or(n,E,_))continue;const I=E.getKey();if(u[I]=!0,E.getState()===L.IDLE&&!e.tileQueue.isKeyQueued(I)){const v=gs(_,x,w,this.tempTileCoord_);e.tileQueue.enqueue([E,c,h.getTileCoordCenter(v),y])}}}}findStaleTile_(e,t){const i=this.tileCache_,n=e[0],r=e[1],o=e[2],a=this.getStaleKeys();for(let l=0;l<a.length;++l){const h=rr(a[l],n,r,o);if(i.containsKey(h)){const c=i.peek(h);if(c.getState()===L.LOADED)return c.endTransition(U(this)),or(t,c,n),!0}}return!1}findAltTiles_(e,t,i,n){const r=e.getTileRangeForTileCoordAndZ(t,i,this.tempTileRange_);if(!r)return!1;let o=!0;const a=this.tileCache_,h=this.getLayer().getRenderSource().getKey();for(let c=r.minX;c<=r.maxX;++c)for(let u=r.minY;u<=r.maxY;++u){const d=rr(h,i,c,u);let f=!1;if(a.containsKey(d)){const g=a.peek(d);g.getState()===L.LOADED&&(or(n,g,i),f=!0)}f||(o=!1)}return o}renderFrame(e,t){let i=!0;this.renderComplete=!0;const n=e.layerStatesArray[e.layerIndex],r=e.viewState,o=r.projection,a=r.resolution,l=r.center,h=e.pixelRatio,c=this.getLayer(),u=c.getSource(),d=u.getTileGridForProjection(o),f=d.getZForResolution(a,u.zDirection),g=d.getResolution(f),m=u.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==m&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=m):this.renderedSourceKey_=m;let _=e.extent;const p=u.getTilePixelRatio(h);this.prepareContainer(e,t);const y=this.context.canvas.width,x=this.context.canvas.height,w=n.extent&&Mt(n.extent);w&&(_=ei(_,Mt(n.extent)));const E=g*y/2/p,R=g*x/2/p,I=[l[0]-E,l[1]-R,l[0]+E,l[1]+R],v={};this.renderedTiles.length=0;const S=c.getPreload();if(e.nextExtent){const Z=d.getZForResolution(r.nextResolution,u.zDirection),z=La(e,e.nextExtent);this.enqueueTiles(e,z,Z,v,S)}const A=La(e,_);if(this.enqueueTiles(e,A,f,v,0),S>0&&setTimeout(()=>{this.enqueueTiles(e,A,f-1,v,S-1)},0),!(f in v))return this.container;const O=U(this),F=e.time;for(const Z of v[f]){const z=Z.getState();if(z===L.EMPTY)continue;const H=Z.tileCoord;if(z===L.LOADED&&Z.getAlpha(O,F)===1){Z.endTransition(O);continue}if(z!==L.IDLE&&(i=!1),z!==L.ERROR&&(this.renderComplete=!1),this.findStaleTile_(H,v)){Of(v,Z,f),e.animate=!0;continue}if(this.findAltTiles_(d,H,f+1,v))continue;const Re=d.getMinZoom();for(let te=f-1;te>=Re&&!this.findAltTiles_(d,H,te,v);--te);}const D=g/a*h/p,b=this.getRenderContext(e);wt(this.tempTransform,y/2,x/2,D,D,0,-y/2,-x/2),n.extent&&this.clipUnrotated(b,e,w),u.getInterpolate()||(b.imageSmoothingEnabled=!1),this.preRender(b,e);const V=Object.keys(v).map(Number);V.sort(_t);let M;const G=[],Y=[];for(let Z=V.length-1;Z>=0;--Z){const z=V[Z],H=u.getTilePixelSize(z,h,o),ge=d.getResolution(z)/g,Re=H[0]*ge*D,te=H[1]*ge*D,Ee=d.getTileCoordForCoordAndZ(ai(I),z),Se=d.getTileCoordExtent(Ee),Oe=le(this.tempTransform,[p*(Se[0]-I[0])/g,p*(I[3]-Se[3])/g]),Yt=p*u.getGutterForProjection(o);for(const me of v[z]){if(me.getState()!==L.LOADED)continue;const In=me.tileCoord,bn=Ee[1]-In[1],An=Math.round(Oe[0]-(bn-1)*Re),Ct=Ee[2]-In[2],Zi=Math.round(Oe[1]-(Ct-1)*te),Qe=Math.round(Oe[0]-bn*Re),et=Math.round(Oe[1]-Ct*te),ui=An-Qe,jt=Zi-et,di=V.length===1;let Ui=!1;M=[Qe,et,Qe+ui,et,Qe+ui,et+jt,Qe,et+jt];for(let ot=0,Zt=G.length;ot<Zt;++ot)if(!di&&z<Y[ot]){const _e=G[ot];Ae([Qe,et,Qe+ui,et+jt],[_e[0],_e[3],_e[4],_e[7]])&&(Ui||(b.save(),Ui=!0),b.beginPath(),b.moveTo(M[0],M[1]),b.lineTo(M[2],M[3]),b.lineTo(M[4],M[5]),b.lineTo(M[6],M[7]),b.moveTo(_e[6],_e[7]),b.lineTo(_e[4],_e[5]),b.lineTo(_e[2],_e[3]),b.lineTo(_e[0],_e[1]),b.clip())}G.push(M),Y.push(z),this.drawTile(me,e,Qe,et,ui,jt,Yt,di),Ui&&b.restore(),this.renderedTiles.unshift(me),this.updateUsedTiles(e.usedTiles,u,me)}}if(this.renderedResolution=g,this.extentChanged=!this.renderedExtent_||!an(this.renderedExtent_,I),this.renderedExtent_=I,this.renderedPixelRatio=h,this.postRender(this.context,e),n.extent&&b.restore(),b.imageSmoothingEnabled=!0,this.renderComplete){const Z=(z,H)=>{const T=U(u),ge=H.wantedTiles[T],Re=ge?Object.keys(ge).length:0;this.updateCacheSize(Re),this.tileCache_.expireCache()};e.postRenderFunctions.push(Z)}return!this.renderComplete&&!i&&(e.animate=!0),this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,e*2)}drawTile(e,t,i,n,r,o,a,l){let h;if(e instanceof Ta){if(h=br(e.getData()),!h)throw new Error("Rendering array data is not yet supported")}else h=this.getTileImage(e);if(!h)return;const c=this.getRenderContext(t),u=U(this),d=t.layerStatesArray[t.layerIndex],f=d.opacity*(l?e.getAlpha(u,t.time):1),g=f!==c.globalAlpha;g&&(c.save(),c.globalAlpha=f),c.drawImage(h,a,a,h.width-2*a,h.height-2*a,i,n,r,o),g&&c.restore(),f!==d.opacity?t.animate=!0:l&&e.endTransition(u)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,t,i){const n=U(t);n in e||(e[n]={}),e[n][i.getKey()]=!0}}const Yn={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class kf extends As{constructor(e){e=e||{};const t=Object.assign({},e),i=e.cacheSize;delete e.cacheSize,delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=i,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(Yn.PRELOAD)}setPreload(e){this.set(Yn.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(Yn.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(Yn.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}class Nf extends kf{constructor(e){super(e)}createRenderer(){return new Df(this,{cacheSize:this.getCacheSize()})}}class oh{drawCustom(e,t,i,n,r){}drawGeometry(e){}setStyle(e){}drawCircle(e,t,i){}drawFeature(e,t,i){}drawGeometryCollection(e,t,i){}drawLineString(e,t,i){}drawMultiLineString(e,t,i){}drawMultiPoint(e,t,i){}drawMultiPolygon(e,t,i){}drawPoint(e,t,i){}drawPolygon(e,t,i){}drawText(e,t,i){}setFillStrokeStyle(e,t){}setImageStyle(e,t){}setTextStyle(e,t){}}const P={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},jn=[P.FILL],Pt=[P.STROKE],Jt=[P.BEGIN_PATH],Pa=[P.CLOSE_PATH];class Tn extends oh{constructor(e,t,i,n){super(),this.tolerance=e,this.maxExtent=t,this.pixelRatio=n,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(e){const t=this.pixelRatio;return t==1?e:e.map(function(i){return i*t})}appendFlatPointCoordinates(e,t){const i=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,r=this.coordinates;let o=r.length;for(let a=0,l=e.length;a<l;a+=t)n[0]=e[a],n[1]=e[a+1],Fi(i,n)&&(r[o++]=n[0],r[o++]=n[1]);return o}appendFlatLineCoordinates(e,t,i,n,r,o){const a=this.coordinates;let l=a.length;const h=this.getBufferedMaxExtent();o&&(t+=n);let c=e[t],u=e[t+1];const d=this.tmpCoordinate_;let f=!0,g,m,_;for(g=t+n;g<i;g+=n)d[0]=e[g],d[1]=e[g+1],_=dr(h,d),_!==m?(f&&(a[l++]=c,a[l++]=u,f=!1),a[l++]=d[0],a[l++]=d[1]):_===ae.INTERSECTING?(a[l++]=d[0],a[l++]=d[1],f=!1):f=!0,c=d[0],u=d[1],m=_;return(r&&f||g===t+n)&&(a[l++]=c,a[l++]=u),l}drawCustomCoordinates_(e,t,i,n,r){for(let o=0,a=i.length;o<a;++o){const l=i[o],h=this.appendFlatLineCoordinates(e,t,l,n,!1,!1);r.push(h),t=l}return t}drawCustom(e,t,i,n,r){this.beginGeometry(e,t,r);const o=e.getType(),a=e.getStride(),l=this.coordinates.length;let h,c,u,d,f;switch(o){case"MultiPolygon":h=e.getOrientedFlatCoordinates(),d=[];const g=e.getEndss();f=0;for(let m=0,_=g.length;m<_;++m){const p=[];f=this.drawCustomCoordinates_(h,f,g[m],a,p),d.push(p)}this.instructions.push([P.CUSTOM,l,d,e,i,wr,r]),this.hitDetectionInstructions.push([P.CUSTOM,l,d,e,n||i,wr,r]);break;case"Polygon":case"MultiLineString":u=[],h=o=="Polygon"?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),f=this.drawCustomCoordinates_(h,0,e.getEnds(),a,u),this.instructions.push([P.CUSTOM,l,u,e,i,cn,r]),this.hitDetectionInstructions.push([P.CUSTOM,l,u,e,n||i,cn,r]);break;case"LineString":case"Circle":h=e.getFlatCoordinates(),c=this.appendFlatLineCoordinates(h,0,h.length,a,!1,!1),this.instructions.push([P.CUSTOM,l,c,e,i,Lt,r]),this.hitDetectionInstructions.push([P.CUSTOM,l,c,e,n||i,Lt,r]);break;case"MultiPoint":h=e.getFlatCoordinates(),c=this.appendFlatPointCoordinates(h,a),c>l&&(this.instructions.push([P.CUSTOM,l,c,e,i,Lt,r]),this.hitDetectionInstructions.push([P.CUSTOM,l,c,e,n||i,Lt,r]));break;case"Point":h=e.getFlatCoordinates(),this.coordinates.push(h[0],h[1]),c=this.coordinates.length,this.instructions.push([P.CUSTOM,l,c,e,i,void 0,r]),this.hitDetectionInstructions.push([P.CUSTOM,l,c,e,n||i,void 0,r]);break}this.endGeometry(t)}beginGeometry(e,t,i){this.beginGeometryInstruction1_=[P.BEGIN_GEOMETRY,t,0,e,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[P.BEGIN_GEOMETRY,t,0,e,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const e=this.hitDetectionInstructions;e.reverse();let t;const i=e.length;let n,r,o=-1;for(t=0;t<i;++t)n=e[t],r=n[0],r==P.END_GEOMETRY?o=t:r==P.BEGIN_GEOMETRY&&(n[2]=t,Ih(this.hitDetectionInstructions,o,t),o=-1)}fillStyleToState(e,t={}){if(e){const i=e.getColor();t.fillPatternScale=i&&typeof i=="object"&&"src"in i?this.pixelRatio:1,t.fillStyle=st(i||be)}else t.fillStyle=void 0;return t}strokeStyleToState(e,t={}){if(e){const i=e.getColor();t.strokeStyle=st(i||gn);const n=e.getLineCap();t.lineCap=n!==void 0?n:Ni;const r=e.getLineDash();t.lineDash=r?r.slice():pt;const o=e.getLineDashOffset();t.lineDashOffset=o||yt;const a=e.getLineJoin();t.lineJoin=a!==void 0?a:Gi;const l=e.getWidth();t.lineWidth=l!==void 0?l:_n;const h=e.getMiterLimit();t.miterLimit=h!==void 0?h:fn,t.lineWidth>this.maxLineWidth&&(this.maxLineWidth=t.lineWidth,this.bufferedMaxExtent_=null)}else t.strokeStyle=void 0,t.lineCap=void 0,t.lineDash=null,t.lineDashOffset=void 0,t.lineJoin=void 0,t.lineWidth=void 0,t.miterLimit=void 0;return t}setFillStrokeStyle(e,t){const i=this.state;this.fillStyleToState(e,i),this.strokeStyleToState(t,i)}createFill(e){const t=e.fillStyle,i=[P.SET_FILL_STYLE,t];return typeof t!="string"&&i.push(e.fillPatternScale),i}applyStroke(e){this.instructions.push(this.createStroke(e))}createStroke(e){return[P.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,e.lineDash?this.applyPixelRatio(e.lineDash):null,e.lineDashOffset*this.pixelRatio]}updateFillStyle(e,t){const i=e.fillStyle;(typeof i!="string"||e.currentFillStyle!=i)&&(i!==void 0&&this.instructions.push(t.call(this,e)),e.currentFillStyle=i)}updateStrokeStyle(e,t){const i=e.strokeStyle,n=e.lineCap,r=e.lineDash,o=e.lineDashOffset,a=e.lineJoin,l=e.lineWidth,h=e.miterLimit;(e.currentStrokeStyle!=i||e.currentLineCap!=n||r!=e.currentLineDash&&!Wt(e.currentLineDash,r)||e.currentLineDashOffset!=o||e.currentLineJoin!=a||e.currentLineWidth!=l||e.currentMiterLimit!=h)&&(i!==void 0&&t.call(this,e),e.currentStrokeStyle=i,e.currentLineCap=n,e.currentLineDash=r,e.currentLineDashOffset=o,e.currentLineJoin=a,e.currentLineWidth=l,e.currentMiterLimit=h)}endGeometry(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const t=[P.END_GEOMETRY,e];this.instructions.push(t),this.hitDetectionInstructions.push(t)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Va(this.maxExtent),this.maxLineWidth>0)){const e=this.resolution*(this.maxLineWidth+1)/2;Pr(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class Gf extends Tn{constructor(e,t,i,n){super(e,t,i,n),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(e,t,i){if(!this.image_||this.maxExtent&&!Fi(this.maxExtent,e.getFlatCoordinates()))return;this.beginGeometry(e,t,i);const n=e.getFlatCoordinates(),r=e.getStride(),o=this.coordinates.length,a=this.appendFlatPointCoordinates(n,r);this.instructions.push([P.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([P.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}drawMultiPoint(e,t,i){if(!this.image_)return;this.beginGeometry(e,t,i);const n=e.getFlatCoordinates(),r=[];for(let l=0,h=n.length;l<h;l+=e.getStride())(!this.maxExtent||Fi(this.maxExtent,n.slice(l,l+2)))&&r.push(n[l],n[l+1]);const o=this.coordinates.length,a=this.appendFlatPointCoordinates(r,2);this.instructions.push([P.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([P.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(e,t){const i=e.getAnchor(),n=e.getSize(),r=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=e.getHitDetectionImage(),this.image_=e.getImage(this.pixelRatio),this.height_=n[1],this.opacity_=e.getOpacity(),this.originX_=r[0],this.originY_=r[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=n[0],this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}class Wf extends Tn{constructor(e,t,i,n){super(e,t,i,n)}drawFlatCoordinates_(e,t,i,n){const r=this.coordinates.length,o=this.appendFlatLineCoordinates(e,t,i,n,!1,!1),a=[P.MOVE_TO_LINE_TO,r,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),i}drawLineString(e,t,i){const n=this.state,r=n.strokeStyle,o=n.lineWidth;if(r===void 0||o===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(e,t,i),this.hitDetectionInstructions.push([P.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,pt,yt],Jt);const a=e.getFlatCoordinates(),l=e.getStride();this.drawFlatCoordinates_(a,0,a.length,l),this.hitDetectionInstructions.push(Pt),this.endGeometry(t)}drawMultiLineString(e,t,i){const n=this.state,r=n.strokeStyle,o=n.lineWidth;if(r===void 0||o===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(e,t,i),this.hitDetectionInstructions.push([P.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,pt,yt],Jt);const a=e.getEnds(),l=e.getFlatCoordinates(),h=e.getStride();let c=0;for(let u=0,d=a.length;u<d;++u)c=this.drawFlatCoordinates_(l,c,a[u],h);this.hitDetectionInstructions.push(Pt),this.endGeometry(t)}finish(){const e=this.state;return e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&this.instructions.push(Pt),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(e){e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(Pt),e.lastStroke=this.coordinates.length),e.lastStroke=0,super.applyStroke(e),this.instructions.push(Jt)}}class Fa extends Tn{constructor(e,t,i,n){super(e,t,i,n)}drawFlatCoordinatess_(e,t,i,n){const r=this.state,o=r.fillStyle!==void 0,a=r.strokeStyle!==void 0,l=i.length;this.instructions.push(Jt),this.hitDetectionInstructions.push(Jt);for(let h=0;h<l;++h){const c=i[h],u=this.coordinates.length,d=this.appendFlatLineCoordinates(e,t,c,n,!0,!a),f=[P.MOVE_TO_LINE_TO,u,d];this.instructions.push(f),this.hitDetectionInstructions.push(f),a&&(this.instructions.push(Pa),this.hitDetectionInstructions.push(Pa)),t=c}return o&&(this.instructions.push(jn),this.hitDetectionInstructions.push(jn)),a&&(this.instructions.push(Pt),this.hitDetectionInstructions.push(Pt)),t}drawCircle(e,t,i){const n=this.state,r=n.fillStyle,o=n.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([P.SET_FILL_STYLE,be]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([P.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,pt,yt]);const a=e.getFlatCoordinates(),l=e.getStride(),h=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,l,!1,!1);const c=[P.CIRCLE,h];this.instructions.push(Jt,c),this.hitDetectionInstructions.push(Jt,c),n.fillStyle!==void 0&&(this.instructions.push(jn),this.hitDetectionInstructions.push(jn)),n.strokeStyle!==void 0&&(this.instructions.push(Pt),this.hitDetectionInstructions.push(Pt)),this.endGeometry(t)}drawPolygon(e,t,i){const n=this.state,r=n.fillStyle,o=n.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([P.SET_FILL_STYLE,be]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([P.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,pt,yt]);const a=e.getEnds(),l=e.getOrientedFlatCoordinates(),h=e.getStride();this.drawFlatCoordinatess_(l,0,a,h),this.endGeometry(t)}drawMultiPolygon(e,t,i){const n=this.state,r=n.fillStyle,o=n.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([P.SET_FILL_STYLE,be]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([P.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,pt,yt]);const a=e.getEndss(),l=e.getOrientedFlatCoordinates(),h=e.getStride();let c=0;for(let u=0,d=a.length;u<d;++u)c=this.drawFlatCoordinatess_(l,c,a[u],h);this.endGeometry(t)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const e=this.tolerance;if(e!==0){const t=this.coordinates;for(let i=0,n=t.length;i<n;++i)t[i]=Vt(t[i],e)}return super.finish()}setFillStrokeStyles_(){const e=this.state;e.fillStyle!==void 0&&this.updateFillStyle(e,this.createFill),e.strokeStyle!==void 0&&this.updateStrokeStyle(e,this.applyStroke)}}function zf(s,e,t,i,n){const r=[];let o=t,a=0,l=e.slice(t,2);for(;a<s&&o+n<i;){const[h,c]=l.slice(-2),u=e[o+n],d=e[o+n+1],f=Math.sqrt((u-h)*(u-h)+(d-c)*(d-c));if(a+=f,a>=s){const g=(s-a+f)/f,m=De(h,u,g),_=De(c,d,g);l.push(m,_),r.push(l),l=[m,_],a==s&&(o+=n),a=0}else if(a<s)l.push(e[o+n],e[o+n+1]),o+=n;else{const g=f-a,m=De(h,u,g/f),_=De(c,d,g/f);l.push(m,_),r.push(l),l=[m,_],a=0,o+=n}}return a>0&&r.push(l),r}function Xf(s,e,t,i,n){let r=t,o=t,a=0,l=0,h=t,c,u,d,f,g,m,_,p,y,x;for(u=t;u<i;u+=n){const w=e[u],E=e[u+1];g!==void 0&&(y=w-g,x=E-m,f=Math.sqrt(y*y+x*x),_!==void 0&&(l+=d,c=Math.acos((_*y+p*x)/(d*f)),c>s&&(l>a&&(a=l,r=h,o=u),l=0,h=u-n)),d=f,_=y,p=x),g=w,m=E}return l+=f,l>a?[h,u]:[r,o]}const ms={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class Yf extends Tn{constructor(e,t,i,n){super(e,t,i,n),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[be]={fillStyle:be},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const e=super.finish();return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e}drawText(e,t,i){const n=this.textFillState_,r=this.textStrokeState_,o=this.textState_;if(this.text_===""||!o||!n&&!r)return;const a=this.coordinates;let l=a.length;const h=e.getType();let c=null,u=e.getStride();if(o.placement==="line"&&(h=="LineString"||h=="MultiLineString"||h=="Polygon"||h=="MultiPolygon")){if(!Ae(this.maxExtent,e.getExtent()))return;let d;if(c=e.getFlatCoordinates(),h=="LineString")d=[c.length];else if(h=="MultiLineString")d=e.getEnds();else if(h=="Polygon")d=e.getEnds().slice(0,1);else if(h=="MultiPolygon"){const _=e.getEndss();d=[];for(let p=0,y=_.length;p<y;++p)d.push(_[p][0])}this.beginGeometry(e,t,i);const f=o.repeat,g=f?void 0:o.textAlign;let m=0;for(let _=0,p=d.length;_<p;++_){let y;f?y=zf(f*this.resolution,c,m,d[_],u):y=[c.slice(m,d[_])];for(let x=0,w=y.length;x<w;++x){const E=y[x];let R=0,I=E.length;if(g==null){const S=Xf(o.maxAngle,E,0,E.length,2);R=S[0],I=S[1]}for(let S=R;S<I;S+=u)a.push(E[S],E[S+1]);const v=a.length;m=d[_],this.drawChars_(l,v),l=v}}this.endGeometry(t)}else{let d=o.overflow?null:[];switch(h){case"Point":case"MultiPoint":c=e.getFlatCoordinates();break;case"LineString":c=e.getFlatMidpoint();break;case"Circle":c=e.getCenter();break;case"MultiLineString":c=e.getFlatMidpoints(),u=2;break;case"Polygon":c=e.getFlatInteriorPoint(),o.overflow||d.push(c[2]/this.resolution),u=3;break;case"MultiPolygon":const w=e.getFlatInteriorPoints();c=[];for(let E=0,R=w.length;E<R;E+=3)o.overflow||d.push(w[E+2]/this.resolution),c.push(w[E],w[E+1]);if(c.length===0)return;u=2;break}const f=this.appendFlatPointCoordinates(c,u);if(f===l)return;if(d&&(f-l)/2!==c.length/u){let w=l/2;d=d.filter((E,R)=>{const I=a[(w+R)*2]===c[R*u]&&a[(w+R)*2+1]===c[R*u+1];return I||--w,I})}this.saveTextStates_();const g=o.backgroundFill?this.createFill(this.fillStyleToState(o.backgroundFill)):null,m=o.backgroundStroke?this.createStroke(this.strokeStyleToState(o.backgroundStroke)):null;this.beginGeometry(e,t,i);let _=o.padding;if(_!=$t&&(o.scale[0]<0||o.scale[1]<0)){let w=o.padding[0],E=o.padding[1],R=o.padding[2],I=o.padding[3];o.scale[0]<0&&(E=-E,I=-I),o.scale[1]<0&&(w=-w,R=-R),_=[w,E,R,I]}const p=this.pixelRatio;this.instructions.push([P.DRAW_IMAGE,l,f,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,_==$t?$t:_.map(function(w){return w*p}),g,m,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]);const y=1/p,x=g?g.slice(0):null;x&&(x[1]=be),this.hitDetectionInstructions.push([P.DRAW_IMAGE,l,f,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[y,y],NaN,this.declutterMode_,this.declutterImageWithText_,_,x,m,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?be:this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]),this.endGeometry(t)}}saveTextStates_(){const e=this.textStrokeState_,t=this.textState_,i=this.textFillState_,n=this.strokeKey_;e&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));const r=this.textKey_;r in this.textStates||(this.textStates[r]={font:t.font,textAlign:t.textAlign||mn,justify:t.justify,textBaseline:t.textBaseline||os,scale:t.scale});const o=this.fillKey_;i&&(o in this.fillStates||(this.fillStates[o]={fillStyle:i.fillStyle}))}drawChars_(e,t){const i=this.textStrokeState_,n=this.textState_,r=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,h=ms[n.textBaseline],c=this.textOffsetY_*l,u=this.text_,d=i?i.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([P.DRAW_CHARS,e,t,h,n.overflow,a,n.maxAngle,l,c,r,d*l,u,o,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([P.DRAW_CHARS,e,t,h,n.overflow,a&&be,n.maxAngle,l,c,r,d*l,u,o,1/l,this.declutterMode_,this.textKeepUpright_])}setTextStyle(e,t){let i,n,r;if(!e)this.text_="";else{const o=e.getFill();o?(n=this.textFillState_,n||(n={},this.textFillState_=n),n.fillStyle=st(o.getColor()||be)):(n=null,this.textFillState_=n);const a=e.getStroke();if(!a)r=null,this.textStrokeState_=r;else{r=this.textStrokeState_,r||(r={},this.textStrokeState_=r);const m=a.getLineDash(),_=a.getLineDashOffset(),p=a.getWidth(),y=a.getMiterLimit();r.lineCap=a.getLineCap()||Ni,r.lineDash=m?m.slice():pt,r.lineDashOffset=_===void 0?yt:_,r.lineJoin=a.getLineJoin()||Gi,r.lineWidth=p===void 0?_n:p,r.miterLimit=y===void 0?fn:y,r.strokeStyle=st(a.getColor()||gn)}i=this.textState_;const l=e.getFont()||Xl;Cd(l);const h=e.getScaleArray();i.overflow=e.getOverflow(),i.font=l,i.maxAngle=e.getMaxAngle(),i.placement=e.getPlacement(),i.textAlign=e.getTextAlign(),i.repeat=e.getRepeat(),i.justify=e.getJustify(),i.textBaseline=e.getTextBaseline()||os,i.backgroundFill=e.getBackgroundFill(),i.backgroundStroke=e.getBackgroundStroke(),i.padding=e.getPadding()||$t,i.scale=h===void 0?[1,1]:h;const c=e.getOffsetX(),u=e.getOffsetY(),d=e.getRotateWithView(),f=e.getKeepUpright(),g=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=c===void 0?0:c,this.textOffsetY_=u===void 0?0:u,this.textRotateWithView_=d===void 0?!1:d,this.textKeepUpright_=f===void 0?!0:f,this.textRotation_=g===void 0?0:g,this.strokeKey_=r?(typeof r.strokeStyle=="string"?r.strokeStyle:U(r.strokeStyle))+r.lineCap+r.lineDashOffset+"|"+r.lineWidth+r.lineJoin+r.miterLimit+"["+r.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=n&&n.fillStyle?typeof n.fillStyle=="string"?n.fillStyle:"|"+U(n.fillStyle):""}this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}const jf={Circle:Fa,Default:Tn,Image:Gf,LineString:Wf,Polygon:Fa,Text:Yf};class Zf{constructor(e,t,i,n){this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=n,this.resolution_=i,this.buildersByZIndex_={}}finish(){const e={};for(const t in this.buildersByZIndex_){e[t]=e[t]||{};const i=this.buildersByZIndex_[t];for(const n in i){const r=i[n].finish();e[t][n]=r}}return e}getBuilder(e,t){const i=e!==void 0?e.toString():"0";let n=this.buildersByZIndex_[i];n===void 0&&(n={},this.buildersByZIndex_[i]=n);let r=n[t];if(r===void 0){const o=jf[t];r=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[t]=r}return r}}function Uf(s,e,t,i,n,r,o,a,l,h,c,u,d=!0){let f=s[e],g=s[e+1],m=0,_=0,p=0,y=0;function x(){m=f,_=g,e+=i,f=s[e],g=s[e+1],y+=p,p=Math.sqrt((f-m)*(f-m)+(g-_)*(g-_))}do x();while(e<t-i&&y+p<r);let w=p===0?0:(r-y)/p;const E=De(m,f,w),R=De(_,g,w),I=e-i,v=y,S=r+a*l(h,n,c);for(;e<t-i&&y+p<S;)x();w=p===0?0:(S-y)/p;const A=De(m,f,w),O=De(_,g,w);let F=!1;if(d)if(u){const G=[E,R,A,O];fl(G,0,4,2,u,G,G),F=G[0]>G[2]}else F=E>A;const D=Math.PI,b=[],V=I+i===e;e=I,p=0,y=v,f=s[e],g=s[e+1];let M;if(V){x(),M=Math.atan2(g-_,f-m),F&&(M+=M>0?-D:D);const G=(A+E)/2,Y=(O+R)/2;return b[0]=[G,Y,(S-r)/2,M,n],b}n=n.replace(/\n/g," ");for(let G=0,Y=n.length;G<Y;){x();let Z=Math.atan2(g-_,f-m);if(F&&(Z+=Z>0?-D:D),M!==void 0){let te=Z-M;if(te+=te>D?-2*D:te<-D?2*D:0,Math.abs(te)>o)return null}M=Z;const z=G;let H=0;for(;G<Y;++G){const te=F?Y-G-1:G,Ee=a*l(h,n[te],c);if(e+i<t&&y+p<r+H+Ee/2)break;H+=Ee}if(G===z)continue;const T=F?n.substring(Y-z,Y-G):n.substring(z,G);w=p===0?0:(r+H/2-y)/p;const ge=De(m,f,w),Re=De(_,g,w);b.push([ge,Re,H/2,Z,T]),r+=H}return b}const yi=Be(),Rt=[],ct=[],ut=[],St=[];function Oa(s){return s[3].declutterBox}const Da=new RegExp("[֑-ࣿיִ-﷿ﹰ-ﻼࠀ-࿿-]");function ar(s,e){return e==="start"?e=Da.test(s)?"right":"left":e==="end"&&(e=Da.test(s)?"left":"right"),ms[e]}function Bf(s,e,t){return t>0&&s.push(`
`,""),s.push(e,""),s}class Kf{constructor(e,t,i,n,r){this.overlaps=i,this.pixelRatio=t,this.resolution=e,this.alignAndScaleFill_,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=qe(),this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=r?new sh:null}getZIndexContext(){return this.zIndexContext_}createLabel(e,t,i,n){const r=e+t+i+n;if(this.labels_[r])return this.labels_[r];const o=n?this.strokeStates[n]:null,a=i?this.fillStates[i]:null,l=this.textStates[t],h=this.pixelRatio,c=[l.scale[0]*h,l.scale[1]*h],u=l.justify?ms[l.justify]:ar(Array.isArray(e)?e[0]:e,l.textAlign||mn),d=n&&o.lineWidth?o.lineWidth:0,f=Array.isArray(e)?e:String(e).split(`
`).reduce(Bf,[]),{width:g,height:m,widths:_,heights:p,lineWidths:y}=Rd(l,f),x=g+d,w=[],E=(x+2)*c[0],R=(m+d)*c[1],I={width:E<0?Math.floor(E):Math.ceil(E),height:R<0?Math.floor(R):Math.ceil(R),contextInstructions:w};(c[0]!=1||c[1]!=1)&&w.push("scale",c),n&&(w.push("strokeStyle",o.strokeStyle),w.push("lineWidth",d),w.push("lineCap",o.lineCap),w.push("lineJoin",o.lineJoin),w.push("miterLimit",o.miterLimit),w.push("setLineDash",[o.lineDash]),w.push("lineDashOffset",o.lineDashOffset)),i&&w.push("fillStyle",a.fillStyle),w.push("textBaseline","middle"),w.push("textAlign","center");const v=.5-u;let S=u*x+v*d;const A=[],O=[];let F=0,D=0,b=0,V=0,M;for(let G=0,Y=f.length;G<Y;G+=2){const Z=f[G];if(Z===`
`){D+=F,F=0,S=u*x+v*d,++V;continue}const z=f[G+1]||l.font;z!==M&&(n&&A.push("font",z),i&&O.push("font",z),M=z),F=Math.max(F,p[b]);const H=[Z,S+v*_[b]+u*(_[b]-y[V]),.5*(d+F)+D];S+=_[b],n&&A.push("strokeText",H),i&&O.push("fillText",H),++b}return Array.prototype.push.apply(w,A),Array.prototype.push.apply(w,O),this.labels_[r]=I,I}replayTextBackground_(e,t,i,n,r,o,a){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,i),e.lineTo.apply(e,n),e.lineTo.apply(e,r),e.lineTo.apply(e,t),o&&(this.alignAndScaleFill_=o[2],e.fillStyle=o[1],this.fill_(e)),a&&(this.setStrokeStyle_(e,a),e.stroke())}calculateImageOrLabelDimensions_(e,t,i,n,r,o,a,l,h,c,u,d,f,g,m,_){a*=d[0],l*=d[1];let p=i-a,y=n-l;const x=r+h>e?e-h:r,w=o+c>t?t-c:o,E=g[3]+x*d[0]+g[1],R=g[0]+w*d[1]+g[2],I=p-g[3],v=y-g[0];(m||u!==0)&&(Rt[0]=I,St[0]=I,Rt[1]=v,ct[1]=v,ct[0]=I+E,ut[0]=ct[0],ut[1]=v+R,St[1]=ut[1]);let S;return u!==0?(S=wt(qe(),i,n,1,1,u,-i,-n),le(S,Rt),le(S,ct),le(S,ut),le(S,St),kt(Math.min(Rt[0],ct[0],ut[0],St[0]),Math.min(Rt[1],ct[1],ut[1],St[1]),Math.max(Rt[0],ct[0],ut[0],St[0]),Math.max(Rt[1],ct[1],ut[1],St[1]),yi)):kt(Math.min(I,I+E),Math.min(v,v+R),Math.max(I,I+E),Math.max(v,v+R),yi),f&&(p=Math.round(p),y=Math.round(y)),{drawImageX:p,drawImageY:y,drawImageW:x,drawImageH:w,originX:h,originY:c,declutterBox:{minX:yi[0],minY:yi[1],maxX:yi[2],maxY:yi[3],value:_},canvasTransform:S,scale:d}}replayImageOrLabel_(e,t,i,n,r,o,a){const l=!!(o||a),h=n.declutterBox,c=a?a[2]*n.scale[0]/2:0;return h.minX-c<=t[0]&&h.maxX+c>=0&&h.minY-c<=t[1]&&h.maxY+c>=0&&(l&&this.replayTextBackground_(e,Rt,ct,ut,St,o,a),Sd(e,n.canvasTransform,r,i,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0}fill_(e){const t=this.alignAndScaleFill_;if(t){const i=le(this.renderedTransform_,[0,0]),n=512*this.pixelRatio;e.save(),e.translate(i[0]%n,i[1]%n),t!==1&&e.scale(t,t),e.rotate(this.viewRotation_)}e.fill(),t&&e.restore()}setStrokeStyle_(e,t){e.strokeStyle=t[1],e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],e.lineDashOffset=t[7],e.setLineDash(t[6])}drawLabelWithPointPlacement_(e,t,i,n){const r=this.textStates[t],o=this.createLabel(e,t,n,i),a=this.strokeStates[i],l=this.pixelRatio,h=ar(Array.isArray(e)?e[0]:e,r.textAlign||mn),c=ms[r.textBaseline||os],u=a&&a.lineWidth?a.lineWidth:0,d=o.width/l-2*r.scale[0],f=h*d+2*(.5-h)*u,g=c*o.height/l+2*(.5-c)*u;return{label:o,anchorX:f,anchorY:g}}execute_(e,t,i,n,r,o,a,l){const h=this.zIndexContext_;let c;this.pixelCoordinates_&&Wt(i,this.renderedTransform_)?c=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),c=Ot(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),bc(this.renderedTransform_,i));let u=0;const d=n.length;let f=0,g,m,_,p,y,x,w,E,R,I,v,S,A,O=0,F=0;const D=this.coordinateCache_,b=this.viewRotation_,V=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,M={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:b},G=this.instructions!=n||this.overlaps?0:200;let Y,Z,z,H;for(;u<d;){const T=n[u];switch(T[0]){case P.BEGIN_GEOMETRY:Y=T[1],H=T[3],Y.getGeometry()?a!==void 0&&!Ae(a,H.getExtent())?u=T[2]+1:++u:u=T[2],h&&(h.zIndex=T[4]);break;case P.BEGIN_PATH:O>G&&(this.fill_(e),O=0),F>G&&(e.stroke(),F=0),!O&&!F&&(e.beginPath(),y=NaN,x=NaN),++u;break;case P.CIRCLE:f=T[1];const Re=c[f],te=c[f+1],Ee=c[f+2],Se=c[f+3],Oe=Ee-Re,Yt=Se-te,me=Math.sqrt(Oe*Oe+Yt*Yt);e.moveTo(Re+me,te),e.arc(Re,te,me,0,2*Math.PI,!0),++u;break;case P.CLOSE_PATH:e.closePath(),++u;break;case P.CUSTOM:f=T[1],g=T[2];const In=T[3],bn=T[4],An=T[5];M.geometry=In,M.feature=Y,u in D||(D[u]=[]);const Ct=D[u];An?An(c,f,g,2,Ct):(Ct[0]=c[f],Ct[1]=c[f+1],Ct.length=2),h&&(h.zIndex=T[6]),bn(Ct,M),++u;break;case P.DRAW_IMAGE:f=T[1],g=T[2],R=T[3],m=T[4],_=T[5];let Zi=T[6];const Qe=T[7],et=T[8],ui=T[9],jt=T[10];let di=T[11];const Ui=T[12];let ot=T[13];p=T[14]||"declutter";const Zt=T[15];if(!R&&T.length>=20){I=T[19],v=T[20],S=T[21],A=T[22];const Ne=this.drawLabelWithPointPlacement_(I,v,S,A);R=Ne.label,T[3]=R;const Ut=T[23];m=(Ne.anchorX-Ut)*this.pixelRatio,T[4]=m;const Ge=T[24];_=(Ne.anchorY-Ge)*this.pixelRatio,T[5]=_,Zi=R.height,T[6]=Zi,ot=R.width,T[13]=ot}let _e;T.length>25&&(_e=T[25]);let Ns,Mn,Ln;T.length>17?(Ns=T[16],Mn=T[17],Ln=T[18]):(Ns=$t,Mn=null,Ln=null),jt&&V?di+=b:!jt&&!V&&(di-=b);let yh=0;for(;f<g;f+=2){if(_e&&_e[yh++]<ot/this.pixelRatio)continue;const Ne=this.calculateImageOrLabelDimensions_(R.width,R.height,c[f],c[f+1],ot,Zi,m,_,et,ui,di,Ui,r,Ns,!!Mn||!!Ln,Y),Ut=[e,t,R,Ne,Qe,Mn,Ln];if(l){let Ge,tt,We;if(Zt){const ne=g-f;if(!Zt[ne]){Zt[ne]={args:Ut,declutterMode:p};continue}const xe=Zt[ne];Ge=xe.args,tt=xe.declutterMode,delete Zt[ne],We=Oa(Ge)}let at,lt;if(Ge&&(tt!=="declutter"||!l.collides(We))&&(at=!0),(p!=="declutter"||!l.collides(Ne.declutterBox))&&(lt=!0),tt==="declutter"&&p==="declutter"){const ne=at&&lt;at=ne,lt=ne}at&&(tt!=="none"&&l.insert(We),this.replayImageOrLabel_.apply(this,Ge)),lt&&(p!=="none"&&l.insert(Ne.declutterBox),this.replayImageOrLabel_.apply(this,Ut))}else this.replayImageOrLabel_.apply(this,Ut)}++u;break;case P.DRAW_CHARS:const Io=T[1],bo=T[2],Gs=T[3],wh=T[4];A=T[5];const Eh=T[6],Ao=T[7],Mo=T[8];S=T[9];const Ws=T[10];I=T[11],v=T[12];const Lo=[T[13],T[13]];p=T[14]||"declutter";const xh=T[15],zs=this.textStates[v],Bi=zs.font,Ki=[zs.scale[0]*Ao,zs.scale[1]*Ao];let Vi;Bi in this.widths_?Vi=this.widths_[Bi]:(Vi={},this.widths_[Bi]=Vi);const Po=Ql(c,Io,bo,2),Fo=Math.abs(Ki[0])*pa(Bi,I,Vi);if(wh||Fo<=Po){const Ne=this.textStates[v].textAlign,Ut=(Po-Fo)*ar(I,Ne),Ge=Uf(c,Io,bo,2,I,Ut,Eh,Math.abs(Ki[0]),pa,Bi,Vi,V?0:this.viewRotation_,xh);e:if(Ge){const tt=[];let We,at,lt,ne,xe;if(S)for(We=0,at=Ge.length;We<at;++We){xe=Ge[We],lt=xe[4],ne=this.createLabel(lt,v,"",S),m=xe[2]+(Ki[0]<0?-Ws:Ws),_=Gs*ne.height+(.5-Gs)*2*Ws*Ki[1]/Ki[0]-Mo;const ht=this.calculateImageOrLabelDimensions_(ne.width,ne.height,xe[0],xe[1],ne.width,ne.height,m,_,0,0,xe[3],Lo,!1,$t,!1,Y);if(l&&p==="declutter"&&l.collides(ht.declutterBox))break e;tt.push([e,t,ne,ht,1,null,null])}if(A)for(We=0,at=Ge.length;We<at;++We){xe=Ge[We],lt=xe[4],ne=this.createLabel(lt,v,A,""),m=xe[2],_=Gs*ne.height-Mo;const ht=this.calculateImageOrLabelDimensions_(ne.width,ne.height,xe[0],xe[1],ne.width,ne.height,m,_,0,0,xe[3],Lo,!1,$t,!1,Y);if(l&&p==="declutter"&&l.collides(ht.declutterBox))break e;tt.push([e,t,ne,ht,1,null,null])}l&&p!=="none"&&l.load(tt.map(Oa));for(let ht=0,Ch=tt.length;ht<Ch;++ht)this.replayImageOrLabel_.apply(this,tt[ht])}}++u;break;case P.END_GEOMETRY:if(o!==void 0){Y=T[1];const Ne=o(Y,H,p);if(Ne)return Ne}++u;break;case P.FILL:G?O++:this.fill_(e),++u;break;case P.MOVE_TO_LINE_TO:for(f=T[1],g=T[2],Z=c[f],z=c[f+1],e.moveTo(Z,z),y=Z+.5|0,x=z+.5|0,f+=2;f<g;f+=2)Z=c[f],z=c[f+1],w=Z+.5|0,E=z+.5|0,(f==g-2||w!==y||E!==x)&&(e.lineTo(Z,z),y=w,x=E);++u;break;case P.SET_FILL_STYLE:this.alignAndScaleFill_=T[2],O&&(this.fill_(e),O=0,F&&(e.stroke(),F=0)),e.fillStyle=T[1],++u;break;case P.SET_STROKE_STYLE:F&&(e.stroke(),F=0),this.setStrokeStyle_(e,T),++u;break;case P.STROKE:G?F++:e.stroke(),++u;break;default:++u;break}}O&&this.fill_(e),F&&e.stroke()}execute(e,t,i,n,r,o){this.viewRotation_=n,this.execute_(e,t,i,this.instructions,r,void 0,void 0,o)}executeHitDetection(e,t,i,n,r){return this.viewRotation_=i,this.execute_(e,[e.canvas.width,e.canvas.height],t,this.hitDetectionInstructions,!0,n,r)}}const Ti=["Polygon","Circle","LineString","Image","Text","Default"],ah=["Image","Text"],Vf=Ti.filter(s=>!ah.includes(s));class Hf{constructor(e,t,i,n,r,o,a){this.maxExtent_=e,this.overlaps_=n,this.pixelRatio_=i,this.resolution_=t,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=qe(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(r,a)}clip(e,t){const i=this.getClipCoords(t);e.beginPath(),e.moveTo(i[0],i[1]),e.lineTo(i[2],i[3]),e.lineTo(i[4],i[5]),e.lineTo(i[6],i[7]),e.clip()}createExecutors_(e,t){for(const i in e){let n=this.executorsByZIndex_[i];n===void 0&&(n={},this.executorsByZIndex_[i]=n);const r=e[i];for(const o in r){const a=r[o];n[o]=new Kf(this.resolution_,this.pixelRatio_,this.overlaps_,a,t)}}}hasExecutors(e){for(const t in this.executorsByZIndex_){const i=this.executorsByZIndex_[t];for(let n=0,r=e.length;n<r;++n)if(e[n]in i)return!0}return!1}forEachFeatureAtCoordinate(e,t,i,n,r,o){n=Math.round(n);const a=n*2+1,l=wt(this.hitDetectionTransform_,n+.5,n+.5,1/t,-1/t,-i,-e[0],-e[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=ue(a,a,void 0,{willReadFrequently:!0}));const c=this.hitDetectionContext_;c.canvas.width!==a||c.canvas.height!==a?(c.canvas.width=a,c.canvas.height=a):h||c.clearRect(0,0,a,a);let u;this.renderBuffer_!==void 0&&(u=Be(),on(u,e),Pr(u,t*(this.renderBuffer_+n),u));const d=qf(n);let f;function g(E,R,I){const v=c.getImageData(0,0,a,a).data;for(let S=0,A=d.length;S<A;S++)if(v[d[S]]>0){if(!o||I==="none"||f!=="Image"&&f!=="Text"||o.includes(E)){const O=(d[S]-3)/4,F=n-O%a,D=n-(O/a|0),b=r(E,R,F*F+D*D);if(b)return b}c.clearRect(0,0,a,a);break}}const m=Object.keys(this.executorsByZIndex_).map(Number);m.sort(_t);let _,p,y,x,w;for(_=m.length-1;_>=0;--_){const E=m[_].toString();for(y=this.executorsByZIndex_[E],p=Ti.length-1;p>=0;--p)if(f=Ti[p],x=y[f],x!==void 0&&(w=x.executeHitDetection(c,l,i,g,u),w))return w}}getClipCoords(e){const t=this.maxExtent_;if(!t)return null;const i=t[0],n=t[1],r=t[2],o=t[3],a=[i,n,i,o,r,o,r,n];return Ot(a,0,8,2,e,a),a}isEmpty(){return ii(this.executorsByZIndex_)}execute(e,t,i,n,r,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(a?Th:_t),o=o||Ti;const h=Ti.length;for(let c=0,u=l.length;c<u;++c){const d=l[c].toString(),f=this.executorsByZIndex_[d];for(let g=0,m=o.length;g<m;++g){const _=o[g],p=f[_];if(p!==void 0){const y=a===null?void 0:p.getZIndexContext(),x=y?y.getContext():e,w=this.maxExtent_&&_!=="Image"&&_!=="Text";if(w&&(x.save(),this.clip(x,i)),!y||_==="Text"||_==="Image"?p.execute(x,t,i,n,r,a):y.pushFunction(E=>p.execute(E,t,i,n,r,a)),w&&x.restore(),y){y.offset();const E=l[c]*h+g;this.deferredZIndexContexts_[E]||(this.deferredZIndexContexts_[E]=[]),this.deferredZIndexContexts_[E].push(y)}}}}this.renderedContext_=e}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const e=this.deferredZIndexContexts_,t=Object.keys(e).map(Number).sort(_t);for(let i=0,n=t.length;i<n;++i)e[t[i]].forEach(r=>{r.draw(this.renderedContext_),r.clear()}),e[t[i]].length=0}}const lr={};function qf(s){if(lr[s]!==void 0)return lr[s];const e=s*2+1,t=s*s,i=new Array(t+1);for(let r=0;r<=s;++r)for(let o=0;o<=s;++o){const a=r*r+o*o;if(a>t)break;let l=i[a];l||(l=[],i[a]=l),l.push(((s+r)*e+(s+o))*4+3),r>0&&l.push(((s-r)*e+(s+o))*4+3),o>0&&(l.push(((s+r)*e+(s-o))*4+3),r>0&&l.push(((s-r)*e+(s-o))*4+3))}const n=[];for(let r=0,o=i.length;r<o;++r)i[r]&&n.push(...i[r]);return lr[s]=n,n}class $f extends oh{constructor(e,t,i,n,r,o,a){super(),this.context_=e,this.pixelRatio_=t,this.extent_=i,this.transform_=n,this.transformRotation_=n?Lr(Math.atan2(n[1],n[0]),10):0,this.viewRotation_=r,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=qe()}drawImages_(e,t,i,n){if(!this.image_)return;const r=Ot(e,t,i,n,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let c=0,u=r.length;c<u;c+=2){const d=r[c]-this.imageAnchorX_,f=r[c+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const g=d+this.imageAnchorX_,m=f+this.imageAnchorY_;wt(a,g,m,1,1,h,-g,-m),o.save(),o.transform.apply(o,a),o.translate(g,m),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,f,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(e,t,i,n){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const r=Ot(e,t,i,n,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);t<i;t+=n){const l=r[t]+this.textOffsetX_,h=r[t+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(l-this.textOffsetX_,h-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,l,h),this.textFillState_&&o.fillText(this.text_,l,h))}}moveToLineTo_(e,t,i,n,r){const o=this.context_,a=Ot(e,t,i,n,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;r&&(l-=2);for(let h=2;h<l;h+=2)o.lineTo(a[h],a[h+1]);return r&&o.closePath(),i}drawRings_(e,t,i,n){for(let r=0,o=i.length;r<o;++r)t=this.moveToLineTo_(e,t,i[r],n,!0);return t}drawCircle(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Ae(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=Oc(e,this.transform_,this.pixelCoordinates_),i=t[2]-t[0],n=t[3]-t[1],r=Math.sqrt(i*i+n*n),o=this.context_;o.beginPath(),o.arc(t[0],t[1],r,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(e.getCenter(),0,2,2)}}setStyle(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())}setTransform(e){this.transform_=e}drawGeometry(e){switch(e.getType()){case"Point":this.drawPoint(e);break;case"LineString":this.drawLineString(e);break;case"Polygon":this.drawPolygon(e);break;case"MultiPoint":this.drawMultiPoint(e);break;case"MultiLineString":this.drawMultiLineString(e);break;case"MultiPolygon":this.drawMultiPolygon(e);break;case"GeometryCollection":this.drawGeometryCollection(e);break;case"Circle":this.drawCircle(e);break}}drawFeature(e,t){const i=t.getGeometryFunction()(e);i&&(this.setStyle(t),this.drawGeometry(i))}drawGeometryCollection(e){const t=e.getGeometriesArray();for(let i=0,n=t.length;i<n;++i)this.drawGeometry(t[i])}drawPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawMultiPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawLineString(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Ae(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(i,0,i.length,e.getStride(),!1),t.stroke()}if(this.text_!==""){const t=e.getFlatMidpoint();this.drawText_(t,0,2,2)}}}drawMultiLineString(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getExtent();if(Ae(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,n=e.getFlatCoordinates();let r=0;const o=e.getEnds(),a=e.getStride();i.beginPath();for(let l=0,h=o.length;l<h;++l)r=this.moveToLineTo_(n,r,o[l],a,!1);i.stroke()}if(this.text_!==""){const i=e.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Ae(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoint();this.drawText_(t,0,2,2)}}}drawMultiPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Ae(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getOrientedFlatCoordinates();let n=0;const r=e.getEndss(),o=e.getStride();t.beginPath();for(let a=0,l=r.length;a<l;++a){const h=r[a];n=this.drawRings_(i,n,h,o)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoints();this.drawText_(t,0,t.length,2)}}}setContextFillState_(e){const t=this.context_,i=this.contextFillState_;i?i.fillStyle!=e.fillStyle&&(i.fillStyle=e.fillStyle,t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})}setContextStrokeState_(e){const t=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=e.lineCap&&(i.lineCap=e.lineCap,t.lineCap=e.lineCap),Wt(i.lineDash,e.lineDash)||t.setLineDash(i.lineDash=e.lineDash),i.lineDashOffset!=e.lineDashOffset&&(i.lineDashOffset=e.lineDashOffset,t.lineDashOffset=e.lineDashOffset),i.lineJoin!=e.lineJoin&&(i.lineJoin=e.lineJoin,t.lineJoin=e.lineJoin),i.lineWidth!=e.lineWidth&&(i.lineWidth=e.lineWidth,t.lineWidth=e.lineWidth),i.miterLimit!=e.miterLimit&&(i.miterLimit=e.miterLimit,t.miterLimit=e.miterLimit),i.strokeStyle!=e.strokeStyle&&(i.strokeStyle=e.strokeStyle,t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}setContextTextState_(e){const t=this.context_,i=this.contextTextState_,n=e.textAlign?e.textAlign:mn;i?(i.font!=e.font&&(i.font=e.font,t.font=e.font),i.textAlign!=n&&(i.textAlign=n,t.textAlign=n),i.textBaseline!=e.textBaseline&&(i.textBaseline=e.textBaseline,t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=n,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:n,textBaseline:e.textBaseline})}setFillStrokeStyle(e,t){if(!e)this.fillState_=null;else{const i=e.getColor();this.fillState_={fillStyle:st(i||be)}}if(!t)this.strokeState_=null;else{const i=t.getColor(),n=t.getLineCap(),r=t.getLineDash(),o=t.getLineDashOffset(),a=t.getLineJoin(),l=t.getWidth(),h=t.getMiterLimit(),c=r||pt;this.strokeState_={lineCap:n!==void 0?n:Ni,lineDash:this.pixelRatio_===1?c:c.map(u=>u*this.pixelRatio_),lineDashOffset:(o||yt)*this.pixelRatio_,lineJoin:a!==void 0?a:Gi,lineWidth:(l!==void 0?l:_n)*this.pixelRatio_,miterLimit:h!==void 0?h:fn,strokeStyle:st(i||gn)}}}setImageStyle(e){let t;if(!e||!(t=e.getSize())){this.image_=null;return}const i=e.getPixelRatio(this.pixelRatio_),n=e.getAnchor(),r=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*i,this.imageAnchorY_=n[1]*i,this.imageHeight_=t[1]*i,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation();const o=e.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/i,o[1]*this.pixelRatio_/i],this.imageWidth_=t[0]*i}setTextStyle(e){if(!e)this.text_="";else{const t=e.getFill();if(!t)this.textFillState_=null;else{const f=t.getColor();this.textFillState_={fillStyle:st(f||be)}}const i=e.getStroke();if(!i)this.textStrokeState_=null;else{const f=i.getColor(),g=i.getLineCap(),m=i.getLineDash(),_=i.getLineDashOffset(),p=i.getLineJoin(),y=i.getWidth(),x=i.getMiterLimit();this.textStrokeState_={lineCap:g!==void 0?g:Ni,lineDash:m||pt,lineDashOffset:_||yt,lineJoin:p!==void 0?p:Gi,lineWidth:y!==void 0?y:_n,miterLimit:x!==void 0?x:fn,strokeStyle:st(f||gn)}}const n=e.getFont(),r=e.getOffsetX(),o=e.getOffsetY(),a=e.getRotateWithView(),l=e.getRotation(),h=e.getScaleArray(),c=e.getText(),u=e.getTextAlign(),d=e.getTextBaseline();this.textState_={font:n!==void 0?n:Xl,textAlign:u!==void 0?u:mn,textBaseline:d!==void 0?d:os},this.text_=c!==void 0?Array.isArray(c)?c.reduce((f,g,m)=>f+=m%2?" ":g,""):c:"",this.textOffsetX_=r!==void 0?this.pixelRatio_*r:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const nt=.5;function Jf(s,e,t,i,n,r,o,a,l){const h=n,c=s[0]*nt,u=s[1]*nt,d=ue(c,u);d.imageSmoothingEnabled=!1;const f=d.canvas,g=new $f(d,nt,n,null,o,a,null),m=t.length,_=Math.floor((256*256*256-1)/m),p={};for(let x=1;x<=m;++x){const w=t[x-1],E=w.getStyleFunction()||i;if(!E)continue;let R=E(w,r);if(!R)continue;Array.isArray(R)||(R=[R]);const v=(x*_).toString(16).padStart(7,"#00000");for(let S=0,A=R.length;S<A;++S){const O=R[S],F=O.getGeometryFunction()(w);if(!F||!Ae(h,F.getExtent()))continue;const D=O.clone(),b=D.getFill();b&&b.setColor(v);const V=D.getStroke();V&&(V.setColor(v),V.setLineDash(null)),D.setText(void 0);const M=O.getImage();if(M){const z=M.getImageSize();if(!z)continue;const H=ue(z[0],z[1],void 0,{alpha:!1}),T=H.canvas;H.fillStyle=v,H.fillRect(0,0,T.width,T.height),D.setImage(new Ps({img:T,anchor:M.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:M.getOrigin(),opacity:1,size:M.getSize(),scale:M.getScale(),rotation:M.getRotation(),rotateWithView:M.getRotateWithView()}))}const G=D.getZIndex()||0;let Y=p[G];Y||(Y={},p[G]=Y,Y.Polygon=[],Y.Circle=[],Y.LineString=[],Y.Point=[]);const Z=F.getType();if(Z==="GeometryCollection"){const z=F.getGeometriesArrayRecursive();for(let H=0,T=z.length;H<T;++H){const ge=z[H];Y[ge.getType().replace("Multi","")].push(ge,D)}}else Y[Z.replace("Multi","")].push(F,D)}}const y=Object.keys(p).map(Number).sort(_t);for(let x=0,w=y.length;x<w;++x){const E=p[y[x]];for(const R in E){const I=E[R];for(let v=0,S=I.length;v<S;v+=2){g.setStyle(I[v+1]);for(let A=0,O=e.length;A<O;++A)g.setTransform(e[A]),g.drawGeometry(I[v])}}}return d.getImageData(0,0,f.width,f.height)}function Qf(s,e,t){const i=[];if(t){const n=Math.floor(Math.round(s[0])*nt),r=Math.floor(Math.round(s[1])*nt),o=(re(n,0,t.width-1)+re(r,0,t.height-1)*t.width)*4,a=t.data[o],l=t.data[o+1],c=t.data[o+2]+256*(l+256*a),u=Math.floor((256*256*256-1)/e.length);c&&c%u===0&&i.push(e[c/u-1])}return i}const eg=.5,lh={Point:lg,LineString:rg,Polygon:cg,MultiPoint:hg,MultiLineString:og,MultiPolygon:ag,GeometryCollection:sg,Circle:ig};function tg(s,e){return parseInt(U(s),10)-parseInt(U(e),10)}function ka(s,e){const t=hh(s,e);return t*t}function hh(s,e){return eg*s/e}function ig(s,e,t,i,n){const r=t.getFill(),o=t.getStroke();if(r||o){const l=s.getBuilder(t.getZIndex(),"Circle");l.setFillStrokeStyle(r,o),l.drawCircle(e,i,n)}const a=t.getText();if(a&&a.getText()){const l=s.getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i)}}function Na(s,e,t,i,n,r,o,a){const l=[],h=t.getImage();if(h){let d=!0;const f=h.getImageState();f==j.LOADED||f==j.ERROR?d=!1:f==j.IDLE&&h.load(),d&&l.push(h.ready())}const c=t.getFill();c&&c.loading()&&l.push(c.ready());const u=l.length>0;return u&&Promise.all(l).then(()=>n(null)),ng(s,e,t,i,r,o,a),u}function ng(s,e,t,i,n,r,o){const a=t.getGeometryFunction()(e);if(!a)return;const l=a.simplifyTransformed(i,n);if(t.getRenderer())ch(s,l,t,e,o);else{const c=lh[l.getType()];c(s,l,t,e,o,r)}}function ch(s,e,t,i,n){if(e.getType()=="GeometryCollection"){const o=e.getGeometries();for(let a=0,l=o.length;a<l;++a)ch(s,o[a],t,i,n);return}s.getBuilder(t.getZIndex(),"Default").drawCustom(e,i,t.getRenderer(),t.getHitDetectionRenderer(),n)}function sg(s,e,t,i,n,r){const o=e.getGeometriesArray();let a,l;for(a=0,l=o.length;a<l;++a){const h=lh[o[a].getType()];h(s,o[a],t,i,n,r)}}function rg(s,e,t,i,n){const r=t.getStroke();if(r){const a=s.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawLineString(e,i,n)}const o=t.getText();if(o&&o.getText()){const a=s.getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,i,n)}}function og(s,e,t,i,n){const r=t.getStroke();if(r){const a=s.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawMultiLineString(e,i,n)}const o=t.getText();if(o&&o.getText()){const a=s.getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,i,n)}}function ag(s,e,t,i,n){const r=t.getFill(),o=t.getStroke();if(o||r){const l=s.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawMultiPolygon(e,i,n)}const a=t.getText();if(a&&a.getText()){const l=s.getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i,n)}}function lg(s,e,t,i,n,r){const o=t.getImage(),a=t.getText(),l=a&&a.getText(),h=r&&o&&l?{}:void 0;if(o){if(o.getImageState()!=j.LOADED)return;const c=s.getBuilder(t.getZIndex(),"Image");c.setImageStyle(o,h),c.drawPoint(e,i,n)}if(l){const c=s.getBuilder(t.getZIndex(),"Text");c.setTextStyle(a,h),c.drawText(e,i,n)}}function hg(s,e,t,i,n,r){const o=t.getImage(),a=o&&o.getOpacity()!==0,l=t.getText(),h=l&&l.getText(),c=r&&a&&h?{}:void 0;if(a){if(o.getImageState()!=j.LOADED)return;const u=s.getBuilder(t.getZIndex(),"Image");u.setImageStyle(o,c),u.drawMultiPoint(e,i,n)}if(h){const u=s.getBuilder(t.getZIndex(),"Text");u.setTextStyle(l,c),u.drawText(e,i,n)}}function cg(s,e,t,i,n){const r=t.getFill(),o=t.getStroke();if(r||o){const l=s.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawPolygon(e,i,n)}const a=t.getText();if(a&&a.getText()){const l=s.getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i,n)}}class ug extends rh{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Be(),this.wrappedRenderedExtent_=Be(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(e,t,i){const n=t.extent,r=t.viewState,o=r.center,a=r.resolution,l=r.projection,h=r.rotation,c=l.getExtent(),u=this.getLayer().getSource(),d=this.getLayer().getDeclutter(),f=t.pixelRatio,g=t.viewHints,m=!(g[we.ANIMATING]||g[we.INTERACTING]),_=this.context,p=Math.round(Q(n)/a*f),y=Math.round(ve(n)/a*f),x=u.getWrapX()&&l.canWrapX(),w=x?Q(c):null,E=x?Math.ceil((n[2]-c[2])/w)+1:1;let R=x?Math.floor((n[0]-c[0])/w):0;do{let I=this.getRenderTransform(o,a,0,f,p,y,R*w);t.declutter&&(I=I.slice(0)),e.execute(_,[_.canvas.width,_.canvas.height],I,h,m,i===void 0?Ti:i?ah:Vf,i?d&&t.declutter[d]:void 0)}while(++R<E)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=ue(this.context.canvas.width,this.context.canvas.height,Ma))}resetDrawContext_(){if(this.opacity_!==1){const e=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=e,bs(this.context),Ma.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(e){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,e,!0)}renderDeferredInternal(e){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(e,t){const i=e.layerStatesArray[e.layerIndex];this.opacity_=i.opacity;const n=e.viewState;this.prepareContainer(e,t);const r=this.context,o=this.replayGroup_;let a=o&&!o.isEmpty();if(!a&&!(this.getLayer().hasListener(Ye.PRERENDER)||this.getLayer().hasListener(Ye.POSTRENDER)))return null;if(this.setDrawContext_(),this.preRender(r,e),n.projection,this.clipped_=!1,a&&i.extent&&this.clipping){const l=Mt(i.extent);a=Ae(l,e.extent),this.clipped_=a&&!Ri(l,e.extent),this.clipped_&&this.clipUnrotated(r,e,l)}return a&&this.renderWorlds(o,e,this.getLayer().getDeclutter()?!1:void 0),!e.declutter&&this.clipped_&&r.restore(),this.postRender(r,e),this.renderedRotation_!==n.rotation&&(this.renderedRotation_=n.rotation,this.hitDetectionImageData_=null),e.declutter||this.resetDrawContext_(),this.container}getFeatures(e){return new Promise(t=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=this.frameState.size.slice(),n=this.renderedCenter_,r=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,h=this.getLayer(),c=[],u=i[0]*nt,d=i[1]*nt;c.push(this.getRenderTransform(n,r,o,nt,u,d,0).slice());const f=h.getSource(),g=a.getExtent();if(f.getWrapX()&&a.canWrapX()&&!Ri(g,l)){let m=l[0];const _=Q(g);let p=0,y;for(;m<g[0];)--p,y=_*p,c.push(this.getRenderTransform(n,r,o,nt,u,d,y).slice()),m+=_;for(p=0,m=l[2];m>g[2];)++p,y=_*p,c.push(this.getRenderTransform(n,r,o,nt,u,d,y).slice()),m-=_}this.hitDetectionImageData_=Jf(i,c,this.renderedFeatures_,h.getStyleFunction(),l,r,o,ka(r,this.renderedPixelRatio_))}t(Qf(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,t,i,n,r){var d,f;if(!this.replayGroup_)return;const o=t.viewState.resolution,a=t.viewState.rotation,l=this.getLayer(),h={},c=function(g,m,_){const p=U(g),y=h[p];if(y){if(y!==!0&&_<y.distanceSq){if(_===0)return h[p]=!0,r.splice(r.lastIndexOf(y),1),n(g,l,m);y.geometry=m,y.distanceSq=_}}else{if(_===0)return h[p]=!0,n(g,l,m);r.push(h[p]={feature:g,layer:l,geometry:m,distanceSq:_,callback:n})}},u=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(e,o,a,i,c,u?(f=(d=t.declutter)==null?void 0:d[u])==null?void 0:f.all().map(g=>g.value):null)}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),i=t.getSource();if(!i)return!1;const n=e.viewHints[we.ANIMATING],r=e.viewHints[we.INTERACTING],o=t.getUpdateWhileAnimating(),a=t.getUpdateWhileInteracting();if(this.ready&&!o&&n||!a&&r)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=e.extent,h=e.viewState,c=h.projection,u=h.resolution,d=e.pixelRatio,f=t.getRevision(),g=t.getRenderBuffer();let m=t.getRenderOrder();m===void 0&&(m=tg);const _=h.center.slice(),p=Pr(l,g*u),y=p.slice(),x=[p.slice()],w=c.getExtent();if(i.getWrapX()&&c.canWrapX()&&!Ri(w,e.extent)){const b=Q(w),V=Math.max(Q(p)/2,b);p[0]=w[0]-V,p[2]=w[2]+V,il(_,c);const M=el(x[0],c);M[0]<w[0]&&M[2]<w[2]?x.push([M[0]+b,M[1],M[2]+b,M[3]]):M[0]>w[0]&&M[2]>w[2]&&x.push([M[0]-b,M[1],M[2]-b,M[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==f&&this.renderedRenderOrder_==m&&this.renderedFrameDeclutter_===!!e.declutter&&Ri(this.wrappedRenderedExtent_,p))return Wt(this.renderedExtent_,y)||(this.hitDetectionImageData_=null,this.renderedExtent_=y),this.renderedCenter_=_,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const E=new Zf(hh(u,d),p,u,d);let R;for(let b=0,V=x.length;b<V;++b)i.loadFeatures(x[b],u,c);const I=ka(u,d);let v=!0;const S=(b,V)=>{let M;const G=b.getStyleFunction()||t.getStyleFunction();if(G&&(M=G(b,u)),M){const Y=this.renderFeature(b,I,M,E,R,this.getLayer().getDeclutter(),V);v=v&&!Y}},A=ul(p),O=i.getFeaturesInExtent(A);m&&O.sort(m);for(let b=0,V=O.length;b<V;++b)S(O[b],b);this.renderedFeatures_=O,this.ready=v;const F=E.finish(),D=new Hf(p,u,d,i.getOverlaps(),F,t.getRenderBuffer(),!!e.declutter);return this.renderedResolution_=u,this.renderedRevision_=f,this.renderedRenderOrder_=m,this.renderedFrameDeclutter_=!!e.declutter,this.renderedExtent_=y,this.wrappedRenderedExtent_=p,this.renderedCenter_=_,this.renderedProjection_=c,this.renderedPixelRatio_=d,this.replayGroup_=D,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,i,n,r,o,a){if(!i)return!1;let l=!1;if(Array.isArray(i))for(let h=0,c=i.length;h<c;++h)l=Na(n,e,i[h],t,this.boundHandleStyleImageChange_,r,o,a)||l;else l=Na(n,e,i,t,this.boundHandleStyleImageChange_,r,o,a);return l}}class xo extends Vl{constructor(e){super(e)}createRenderer(){return new ug(this)}}const wi=[0,0,0],Tt=5;class uh{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,q(bh(this.resolutions_,(n,r)=>r-n),"`resolutions` must be sorted in descending order");let t;if(!e.origins){for(let n=0,r=this.resolutions_.length-1;n<r;++n)if(!t)t=this.resolutions_[n]/this.resolutions_[n+1];else if(this.resolutions_[n]/this.resolutions_[n+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,q(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=e.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=ai(i)),q(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,q(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:to,q(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map((n,r)=>{const o=new Eo(Math.min(0,n[0]),Math.max(n[0]-1,-1),Math.min(0,n[1]),Math.max(n[1]-1,-1));if(i){const a=this.getTileRangeForExtentAndZ(i,r);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):i&&this.calculateTileRanges_(i)}forEachTileCoord(e,t,i){const n=this.getTileRangeForExtentAndZ(e,t);for(let r=n.minX,o=n.maxX;r<=o;++r)for(let a=n.minY,l=n.maxY;a<=l;++a)i([t,r,a])}forEachTileCoordParentTileRange(e,t,i,n){let r,o,a,l=null,h=e[0]-1;for(this.zoomFactor_===2?(o=e[1],a=e[2]):l=this.getTileCoordExtent(e,n);h>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),r=pi(o,o,a,a,i)):r=this.getTileRangeForExtentAndZ(l,h,i),t(h,r))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,i){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const r=e[1]*2,o=e[2]*2;return pi(r,r+1,o,o+1,t)}const n=this.getTileCoordExtent(e,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,i){if(t>this.maxZoom||t<this.minZoom)return null;const n=e[0],r=e[1],o=e[2];if(t===n)return pi(r,o,r,o,i);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,t-n),h=Math.floor(r*l),c=Math.floor(o*l);if(t<n)return pi(h,h,c,c,i);const u=Math.floor(l*(r+1))-1,d=Math.floor(l*(o+1))-1;return pi(h,u,c,d,i)}const a=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,t,i)}getTileRangeForExtentAndZ(e,t,i){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,wi);const n=wi[1],r=wi[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,wi);const o=wi[1],a=wi[2];return pi(n,o,r,a,i)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),i=this.getResolution(e[0]),n=Le(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*n[0]*i,t[1]-(e[2]+.5)*n[1]*i]}getTileCoordExtent(e,t){const i=this.getOrigin(e[0]),n=this.getResolution(e[0]),r=Le(this.getTileSize(e[0]),this.tmpSize_),o=i[0]+e[1]*r[0]*n,a=i[1]-(e[2]+1)*r[1]*n,l=o+r[0]*n,h=a+r[1]*n;return kt(o,a,l,h,t)}getTileCoordForCoordAndResolution(e,t,i){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,i)}getTileCoordForXYAndResolution_(e,t,i,n,r){const o=this.getZForResolution(i),a=i/this.getResolution(o),l=this.getOrigin(o),h=Le(this.getTileSize(o),this.tmpSize_);let c=a*(e-l[0])/i/h[0],u=a*(l[1]-t)/i/h[1];return n?(c=On(c,Tt)-1,u=On(u,Tt)-1):(c=Fn(c,Tt),u=Fn(u,Tt)),gs(o,c,u,r)}getTileCoordForXYAndZ_(e,t,i,n,r){const o=this.getOrigin(i),a=this.getResolution(i),l=Le(this.getTileSize(i),this.tmpSize_);let h=(e-o[0])/a/l[0],c=(o[1]-t)/a/l[1];return n?(h=On(h,Tt)-1,c=On(c,Tt)-1):(h=Fn(h,Tt),c=Fn(c,Tt)),gs(i,h,c,r)}getTileCoordForCoordAndZ(e,t,i){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,i)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const i=Mr(this.resolutions_,e,t||0);return re(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return xl(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,i=new Array(t);for(let n=this.minZoom;n<t;++n)i[n]=this.getTileRangeForExtentAndZ(e,n);this.fullTileRanges_=i}}function dh(s){let e=s.getDefaultTileGrid();return e||(e=mg(s),s.setDefaultTileGrid(e)),e}function dg(s,e,t){const i=e[0],n=s.getTileCoordCenter(e),r=Co(t);if(!Fi(r,n)){const o=Q(r),a=Math.ceil((r[0]-n[0])/o);return n[0]+=o*a,s.getTileCoordForCoordAndZ(n,i)}return e}function fg(s,e,t,i){i=i!==void 0?i:"top-left";const n=fh(s,e,t);return new uh({extent:s,origin:Zh(s,i),resolutions:n,tileSize:t})}function gg(s){const e=s||{},t=e.extent||se("EPSG:3857").getExtent(),i={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:fh(t,e.maxZoom,e.tileSize,e.maxResolution)};return new uh(i)}function fh(s,e,t,i){e=e!==void 0?e:$c,t=Le(t!==void 0?t:to);const n=ve(s),r=Q(s);i=i>0?i:Math.max(r/t[0],n/t[1]);const o=e+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=i/Math.pow(2,l);return a}function mg(s,e,t,i){const n=Co(s);return fg(n,e,t,i)}function Co(s){s=se(s);let e=s.getExtent();if(!e){const t=180*kr.degrees/s.getMetersPerUnit();e=kt(-t,-t,t,t)}return e}const _g=/\{z\}/g,pg=/\{x\}/g,yg=/\{y\}/g,wg=/\{-y\}/g;function Eg(s,e,t,i,n){return s.replace(_g,e.toString()).replace(pg,t.toString()).replace(yg,i.toString()).replace(wg,function(){if(n===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(n-i).toString()})}function xg(s){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(s);if(t){const i=t[1].charCodeAt(0),n=t[2].charCodeAt(0);let r;for(r=i;r<=n;++r)e.push(s.replace(t[0],String.fromCharCode(r)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(s),t){const i=parseInt(t[2],10);for(let n=parseInt(t[1],10);n<=i;n++)e.push(s.replace(t[0],n.toString()));return e}return e.push(s),e}function Cg(s,e){return function(t,i,n){if(!t)return;let r;const o=t[0];if(e){const a=e.getFullTileRange(o);a&&(r=a.getHeight()-1)}return Eg(s,o,t[1],t[2],r)}}function vg(s,e){const t=s.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=Cg(s[n],e);return Rg(i)}function Rg(s){return s.length===1?s[0]:function(e,t,i){if(!e)return;const n=bf(e),r=Ii(n,s.length);return s[r](e,t,i)}}class gh extends Je{constructor(e){super(),this.projection=se(e.projection),this.attributions_=Ga(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible??!0,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0?e.wrapX:!1,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise(function(i,n){t.viewResolver=i,t.viewRejector=n})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=Ga(e),this.changed()}setState(e){this.state_=e,this.changed()}}function Ga(s){return s?typeof s=="function"?s:(Array.isArray(s)||(s=[s]),e=>s):null}class Sg extends gh{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&Le(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tmpSize=[0,0],this.key_=e.key||U(this),this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,i,n,r){return N()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:dh(e)}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,i){const n=this.getTileGridForProjection(i),r=this.getTilePixelRatio(t),o=Le(n.getTileSize(e),this.tmpSize);return r==1?o:Bu(o,r,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){const i=t!==void 0?t:this.getProjection(),n=t!==void 0?this.getTileGridForProjection(i):this.tileGrid||this.getTileGridForProjection(i);return this.getWrapX()&&i.isGlobal()&&(e=dg(n,e,i)),Mf(e,n)?e:null}clear(){}refresh(){this.clear(),super.refresh()}}class Tg extends rt{constructor(e,t){super(e),this.tile=t}}const hr={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class vo extends Sg{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===vo.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,i=U(t),n=t.getState();let r;n==L.LOADING?(this.tileLoadingKeys_[i]=!0,r=hr.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],r=n==L.ERROR?hr.TILELOADERROR:n==L.LOADED?hr.TILELOADEND:void 0),r!=null&&this.dispatchEvent(new Tg(r,t))}setTileLoadFunction(e){this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=xg(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(vg(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,i){}}class Ig extends vo{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:bg,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:ih,this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(e){return this.getProjection()&&e&&!Jn(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||Jn(t,e)))return this.tileGrid;const i=U(e);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=dh(e)),this.tileGridForProjection[i]}createTile_(e,t,i,n,r,o){const a=[e,t,i],l=this.getTileCoordForTileUrlFunction(a,r),h=l?this.tileUrlFunction(l,n,r):void 0,c=new this.tileClass(a,h!==void 0?L.IDLE:L.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(W.CHANGE,this.handleTileChange.bind(this)),c}getTile(e,t,i,n,r){const o=this.getProjection();if(!o||!r||Jn(o,r))return this.getTileInternal(e,t,i,n,o||r);const a=[e,t,i],l=this.getKey(),h=this.getTileGridForProjection(o),c=this.getTileGridForProjection(r),u=this.getTileCoordForTileUrlFunction(a,r),d=new nh(o,h,r,c,a,u,this.getTilePixelRatio(n),this.getGutter(),(f,g,m,_)=>this.getTileInternal(f,g,m,_,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return d.key=l,d}getTileInternal(e,t,i,n,r){const o=this.getKey();return this.createTile_(e,t,i,n,r,o)}setRenderReprojectionEdges(e){this.renderReprojectionEdges_!=e&&(this.renderReprojectionEdges_=e,this.changed())}setTileGridForProjection(e,t){const i=se(e);if(i){const n=U(i);n in this.tileGridForProjection||(this.tileGridForProjection[n]=t)}}}function bg(s,e){s.getImage().src=e}class Ag extends Ig{constructor(e){e=e||{};const t=e.projection!==void 0?e.projection:"EPSG:3857",i=e.tileGrid!==void 0?e.tileGrid:gg({extent:Co(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}}let Mg=!1;function Lg(s,e,t,i,n,r,o){const a=new XMLHttpRequest;a.open("GET",typeof s=="function"?s(t,i,n):s,!0),e.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=Mg,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const h=e.getType();try{let c;h=="text"||h=="json"?c=a.responseText:h=="xml"?c=a.responseXML||a.responseText:h=="arraybuffer"&&(c=a.response),c?r(e.readFeatures(c,{extent:t,featureProjection:n}),e.readProjection(c)):o()}catch{o()}}else o()},a.onerror=o,a.send()}function Wa(s,e){return function(t,i,n,r,o){Lg(s,e,t,i,n,(a,l)=>{this.addFeatures(a),r!==void 0&&r(a)},o||Pi)}}function Pg(s,e){return[[-1/0,-1/0,1/0,1/0]]}class za{constructor(e){this.rbush_=new Ol(e),this.items_={}}insert(e,t){const i={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(i),this.items_[U(t)]=i}load(e,t){const i=new Array(t.length);for(let n=0,r=t.length;n<r;n++){const o=e[n],a=t[n],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};i[n]=l,this.items_[U(a)]=l}this.rbush_.load(i)}remove(e){const t=U(e),i=this.items_[t];return delete this.items_[t],this.rbush_.remove(i)!==null}update(e,t){const i=this.items_[U(t)],n=[i.minX,i.minY,i.maxX,i.maxY];an(n,e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map(function(n){return n.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let i;for(let n=0,r=e.length;n<r;n++)if(i=t(e[n]),i)return i;return i}isEmpty(){return ii(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const t=this.rbush_.toJSON();return kt(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const t in e.items_)this.items_[t]=e.items_[t]}}const ze={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};class It extends rt{constructor(e,t,i){super(e),this.feature=t,this.features=i}}class mh extends gh{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:e.wrapX!==void 0?e.wrapX:!0}),this.on,this.once,this.un,this.loader_=Pi,this.format_=e.format||null,this.overlaps_=e.overlaps===void 0?!0:e.overlaps,this.url_=e.url,e.loader!==void 0?this.loader_=e.loader:this.url_!==void 0&&(q(this.format_,"`format` must be set when `url` is set"),this.loader_=Wa(this.url_,this.format_)),this.strategy_=e.strategy!==void 0?e.strategy:Pg;const t=e.useSpatialIndex!==void 0?e.useSpatialIndex:!0;this.featuresRtree_=t?new za:null,this.loadedExtentsRtree_=new za,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,n;Array.isArray(e.features)?n=e.features:e.features&&(i=e.features,n=i.getArray()),!t&&i===void 0&&(i=new He(n)),n!==void 0&&this.addFeaturesInternal(n),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const t=U(e);if(!this.addToIndex_(t,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(t,e);const i=e.getGeometry();if(i){const n=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(n,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new It(ze.ADDFEATURE,e))}setupChangeEvents_(e,t){t instanceof ke||(this.featureChangeKeys_[e]=[K(t,W.CHANGE,this.handleFeatureChange_,this),K(t,Li.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(e,t){let i=!0;if(t.getId()!==void 0){const n=String(t.getId());if(!(n in this.idIndex_))this.idIndex_[n]=t;else if(t instanceof ke){const r=this.idIndex_[n];r instanceof ke?Array.isArray(r)?r.push(t):this.idIndex_[n]=[r,t]:i=!1}else i=!1}return i&&(q(!(e in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[e]=t),i}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const t=[],i=[],n=[];for(let r=0,o=e.length;r<o;r++){const a=e[r],l=U(a);this.addToIndex_(l,a)&&i.push(a)}for(let r=0,o=i.length;r<o;r++){const a=i[r],l=U(a);this.setupChangeEvents_(l,a);const h=a.getGeometry();if(h){const c=h.getExtent();t.push(c),n.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(t,n),this.hasListener(ze.ADDFEATURE))for(let r=0,o=i.length;r<o;r++)this.dispatchEvent(new It(ze.ADDFEATURE,i[r]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener(ze.ADDFEATURE,function(i){t||(t=!0,e.push(i.feature),t=!1)}),this.addEventListener(ze.REMOVEFEATURE,function(i){t||(t=!0,e.remove(i.feature),t=!1)}),e.addEventListener(ce.ADD,i=>{t||(t=!0,this.addFeature(i.element),t=!1)}),e.addEventListener(ce.REMOVE,i=>{t||(t=!0,this.removeFeature(i.element),t=!1)}),this.featuresCollection_=e}clear(e){if(e){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(ee);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(i=>{this.removeFeatureInternal(i)});for(const i in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[i])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new It(ze.CLEAR);this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){const i=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(i,function(n){const r=n.getGeometry();if(r instanceof ke||r.intersectsCoordinate(e))return t(n)})}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,function(i){const n=i.getGeometry();if(n instanceof ke||n.intersectsExtent(e)){const r=t(i);if(r)return r}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),ii(this.nullGeometryFeatures_)||Ze(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,function(i){t.push(i)}),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const n=tl(e,t);return[].concat(...n.map(r=>this.featuresRtree_.getInExtent(r)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(e,t){const i=e[0],n=e[1];let r=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return t=t||ti,this.featuresRtree_.forEachInExtent(l,function(h){if(t(h)){const c=h.getGeometry(),u=a;if(a=c instanceof ke?0:c.closestPointXY(i,n,o,a),a<u){r=h;const d=Math.sqrt(a);l[0]=i-d,l[1]=n-d,l[2]=i+d,l[3]=n+d}}}),r}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){const t=this.idIndex_[e.toString()];return t!==void 0?t:null}getFeatureByUid(e){const t=this.uidIndex_[e];return t!==void 0?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const t=e.target,i=U(t),n=t.getGeometry();if(!n)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[i]=t);else{const o=n.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(o,t)):this.featuresRtree_&&this.featuresRtree_.update(o,t)}const r=t.getId();if(r!==void 0){const o=r.toString();this.idIndex_[o]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[o]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[i]=t;this.changed(),this.dispatchEvent(new It(ze.CHANGEFEATURE,t))}hasFeature(e){const t=e.getId();return t!==void 0?t in this.idIndex_:U(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&ii(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(e,t,i){const n=this.loadedExtentsRtree_,r=this.strategy_(e,t,i);for(let o=0,a=r.length;o<a;++o){const l=r[o];n.forEachInExtent(l,function(c){return Ri(c.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new It(ze.FEATURESLOADSTART)),this.loader_.call(this,l,t,i,c=>{--this.loadingExtentsCount_,this.dispatchEvent(new It(ze.FEATURESLOADEND,void 0,c))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new It(ze.FEATURESLOADERROR))}),n.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const t=this.loadedExtentsRtree_,i=t.forEachInExtent(e,function(n){if(an(n.extent,e))return n});i&&t.remove(i)}removeFeatures(e){let t=!1;for(let i=0,n=e.length;i<n;++i)t=this.removeFeatureInternal(e[i])||t;t&&this.changed()}removeFeature(e){if(!e)return;this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const t=U(e);if(!(t in this.uidIndex_))return!1;t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e);const i=this.featureChangeKeys_[t];i==null||i.forEach(ee),delete this.featureChangeKeys_[t];const n=e.getId();if(n!==void 0){const r=n.toString(),o=this.idIndex_[r];o===e?delete this.idIndex_[r]:Array.isArray(o)&&(o.splice(o.indexOf(e),1),o.length===1&&(this.idIndex_[r]=o[0]))}return delete this.uidIndex_[t],this.hasListener(ze.REMOVEFEATURE)&&this.dispatchEvent(new It(ze.REMOVEFEATURE,e)),!0}removeFromIdIndex_(e){for(const t in this.idIndex_)if(this.idIndex_[t]===e){delete this.idIndex_[t];break}}setLoader(e){this.loader_=e}setUrl(e){q(this.format_,"`format` must be set when `url` is set"),this.url_=e,this.setLoader(Wa(e,this.format_))}setOverlaps(e){this.overlaps_=e,this.changed()}}const Fg='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class Og extends Ag{constructor(e){e=e||{};let t;e.attributions!==void 0?t=e.attributions:t=[Fg];const i=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",n=e.url!==void 0?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:t,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:i,interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:19,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:n,wrapX:e.wrapX,zDirection:e.zDirection})}}const pe={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class Dg extends Je{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+iu,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(pe.ELEMENT,this.handleElementChanged),this.addChangeListener(pe.MAP,this.handleMapChanged),this.addChangeListener(pe.OFFSET,this.handleOffsetChanged),this.addChangeListener(pe.POSITION,this.handlePositionChanged),this.addChangeListener(pe.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(pe.ELEMENT)}getId(){return this.id}getMap(){return this.get(pe.MAP)||null}getOffset(){return this.get(pe.OFFSET)}getPosition(){return this.get(pe.POSITION)}getPositioning(){return this.get(pe.POSITIONING)}handleElementChanged(){Sl(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){var t;this.mapPostrenderListenerKey&&((t=this.element)==null||t.remove(),ee(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=K(e,gt.POSTRENDER,this.render,this),this.updatePixelPosition();const i=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?i.insertBefore(this.element,i.childNodes[0]||null):i.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(pe.ELEMENT,e)}setMap(e){this.set(pe.MAP,e)}setOffset(e){this.set(pe.OFFSET,e)}setPosition(e){this.set(pe.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(pe.POSITION))return;const i=this.getRect(t.getTargetElement(),t.getSize()),n=this.getElement(),r=this.getRect(n,[su(n),ru(n)]);e=e||{};const o=e.margin===void 0?20:e.margin;if(!Ri(i,r)){const a=r[0]-i[0],l=i[2]-r[2],h=r[1]-i[1],c=i[3]-r[3],u=[0,0];if(a<0?u[0]=a-o:l<0&&(u[0]=Math.abs(l)+o),h<0?u[1]=h-o:c<0&&(u[1]=Math.abs(c)+o),u[0]!==0||u[1]!==0){const d=t.getView().getCenterInternal(),f=t.getPixelFromCoordinateInternal(d);if(!f)return;const g=[f[0]+u[0],f[1]+u[1]],m=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(g),duration:m.duration,easing:m.easing})}}}getRect(e,t){const i=e.getBoundingClientRect(),n=i.left+window.pageXOffset,r=i.top+window.pageYOffset;return[n,r,n+t[0],r+t[1]]}setPositioning(e){this.set(pe.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const i=e.getPixelFromCoordinate(t),n=e.getSize();this.updateRenderedPosition(i,n)}updateRenderedPosition(e,t){const i=this.element.style,n=this.getOffset(),r=this.getPositioning();this.setVisible(!0);const o=Math.round(e[0]+n[0])+"px",a=Math.round(e[1]+n[1])+"px";let l="0%",h="0%";r=="bottom-right"||r=="center-right"||r=="top-right"?l="-100%":(r=="bottom-center"||r=="center-center"||r=="top-center")&&(l="-50%"),r=="bottom-left"||r=="bottom-center"||r=="bottom-right"?h="-100%":(r=="center-left"||r=="center-center"||r=="center-right")&&(h="-50%");const c=`translate(${l}, ${h}) translate(${o}, ${a})`;this.rendered.transform_!=c&&(this.rendered.transform_=c,i.transform=c)}getOptions(){return this.options}}const kg={SELECT:"select"};class Ng extends rt{constructor(e,t,i,n){super(e),this.selected=t,this.deselected=i,this.mapBrowserEvent=n}}const Zn={};class Ro extends Yi{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:bl,this.addCondition_=e.addCondition?e.addCondition:aa,this.removeCondition_=e.removeCondition?e.removeCondition:aa,this.toggleCondition_=e.toggleCondition?e.toggleCondition:Ml,this.multi_=e.multi?e.multi:!1,this.filter_=e.filter?e.filter:ti,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=e.style!==void 0?e.style:Gg(),this.features_=e.features||new He;let t;if(e.layers)if(typeof e.layers=="function")t=e.layers;else{const i=e.layers;t=function(n){return i.includes(n)}}else t=ti;this.layerFilter_=t,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[U(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[U(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(ce.ADD,this.boundAddFeature_),this.features_.addEventListener(ce.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(ce.ADD,this.boundAddFeature_),this.features_.removeEventListener(ce.REMOVE,this.boundRemoveFeature_))}addFeature_(e){const t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){const i=this.getMap().getAllLayers().find(function(n){if(n instanceof xo&&n.getSource()&&n.getSource().hasFeature(t))return n});i&&this.addFeatureLayerAssociation_(t,i)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}getStyle(){return this.style_}applySelectedStyle_(e){const t=U(e);t in Zn||(Zn[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const t=this.getMap().getInteractions().getArray();for(let n=t.length-1;n>=0;--n){const r=t[n];if(r!==this&&r instanceof Ro&&r.getStyle()&&r.getFeatures().getArray().lastIndexOf(e)!==-1){e.setStyle(r.getStyle());return}}const i=U(e);e.setStyle(Zn[i]),delete Zn[i]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[U(e)]}handleEvent(e){if(!this.condition_(e))return!0;const t=this.addCondition_(e),i=this.removeCondition_(e),n=this.toggleCondition_(e),r=!t&&!i&&!n,o=e.map,a=this.getFeatures(),l=[],h=[];if(r){zi(this.featureLayerAssociation_),o.forEachFeatureAtPixel(e.pixel,(c,u)=>{if(!(!(c instanceof ni)||!this.filter_(c,u)))return this.addFeatureLayerAssociation_(c,u),h.push(c),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let c=a.getLength()-1;c>=0;--c){const u=a.item(c),d=h.indexOf(u);d>-1?h.splice(d,1):(a.remove(u),l.push(u))}h.length!==0&&a.extend(h)}else{o.forEachFeatureAtPixel(e.pixel,(c,u)=>{if(!(!(c instanceof ni)||!this.filter_(c,u)))return(t||n)&&!a.getArray().includes(c)?(this.addFeatureLayerAssociation_(c,u),h.push(c)):(i||n)&&a.getArray().includes(c)&&(l.push(c),this.removeFeatureLayerAssociation_(c)),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let c=l.length-1;c>=0;--c)a.remove(l[c]);a.extend(h)}return(h.length>0||l.length>0)&&this.dispatchEvent(new Ng(kg.SELECT,h,l,e)),!0}}function Gg(){const s=bd();return Ze(s.Polygon,s.LineString),Ze(s.GeometryCollection,s.LineString),function(e){return e.getGeometry()?s[e.getGeometry().getType()]:null}}const Wg=document.getElementById("popup"),zg=document.getElementById("popup-content"),Xa=document.getElementById("popup-closer"),ks={1:new he({stroke:new Te({color:"blue",width:5})}),2:new he({stroke:new Te({color:"green",width:5})}),3:new he({stroke:new Te({color:"orange",width:5})}),4:new he({stroke:new Te({color:"red",width:5})}),5:new he({stroke:new Te({color:"magenta",width:5})}),Point:new he({image:new ri({radius:7,fill:new Et({color:"purple"}),stroke:new Te({color:"black",width:1})})}),Selected:new he({image:new ri({radius:7,fill:new Et({color:"white"}),stroke:new Te({color:"black",width:1})})})},Xg=function(s){return ks[s.get("f-scale")]},Yg={type:"FeatureCollection",crs:{type:"name",properties:{name:"EPSG:4326"}},features:[{type:"Feature",properties:{"datetime-start":"2023-03-25T00:57:00Z","f-scale":"4",scale:"EF",source:[{"NWS Storm Survey":null}],id:"RV2362023USA",countries:["US"],fatalities:17,"path-width":1320,"path-length":59.23,wind:195,injuries:165,states:["MS"],comments:`This long track, violent tornado began over northern Issaquena County near Grant Rd, downing multiple trees and damaging two older outbuildings. It tracked northeastward, producing tree damage as it crossed the Steele Bayou Canal before crossing into Sharkey County. At this point, the tornado began to substantially increase in size and intensity. A very high percentage of trees were snapped along the path through a wooded area south of Bear Lake Rd. It was in this wooded area where the first indications of EF3 to EF4 damage were noted, with at least one tree and root ball and several more large tree pieces fully displaced into the downstream field. From this point along the path in Sharkey County, there was a well defined confluence zone in damage along the center of the tornado track.
On the western outskirts of the city of Rolling Fork, homes began to be impacted with significant roof damage along Bear Lake Rd. Several tall wooden utility transmission poles were snapped along Bear Lake Rd and MS Highway 826. Along Pinkins Rd, each structure along the road, including several manufactured homes and two site built homes, was demolished. Structures on the west end of the road were scattered radially southeastward, and structures on the east end of the road were scattered northward. An occupant of one of the mobile homes was critically injured during the tornado and eventually passed away nearly four weeks later. Debarking was observed on several hardwood trees, with only stubs of the main branches of some trees remaining. Crossing MS 826 and along Fleetwood Rd, an older metal building was swept away, a small home was destroyed and numerous manufactured homes were destroyed.
As the tornado moved into the western side of Rolling Fork, the tornadic wind field was broad, encompassing the area from Race St, where exterior damage occurred to the Sharkey Issaquena Hospital, to Bear Lake Rd on the south end where several utility poles were snapped. The corridor of greatest damage on the west side of the city, rated high end EF3, extended from 7th St between Martin Ave and Joor Ave to 3rd St between Southern Ave and Lewis Ave. In this area, multiple homes lost most exterior walls, several more lost roofs and some walls, and even more received at least minor damage. Two fatalities occurred along 7th St when a trailer truck was tossed into a home. Through this corridor, additional debarking of trees was noted near the center of the path. Brief and minor weakening occurred as the tornado moved east of 3rd St and began to approach Deer Creek, with EF2 damage still common. Along the creek, the fire station, Rolling Fork Elementary School, and South Delta High School all sustained roof and other exterior damage.
After the tornado crossed Deer Creek and began to move into the downtown area of Rolling Fork, reintensification occurred. Additional EF4 damage was noted in the block between Sharkey St and Worthington Ave and north of Collette Ave where a home and a duplex apartment were entirely demolished, with the foundation of the duplex partially swept. Large metal buildings at an agriculture business at the intersection of East St and West Ave were destroyed. A fatality occurred when a mobile home along Worthington Ave was destroyed. On Parkway Ave, a Masonic lodge was leveled and a gas station was substantially damaged.
The tornado then crossed Rolling Fork Creek, damaging and destroying several structures along McLaurin St and China St. A water tower east of Hicks Ave, which was in service at the time of the tornado, was felled in a southeastward direction, perpendicular to the tornado path. In the downtown area, the roof was removed from the Rolling Fork US Post Office, portions of Rolling Fork City Hall, and portions of the Rolling Fork Police Department. The Sharkey County Courthouse received damage to the roof and some windows, with the cupola removed. Additional EF4 damage was observed as the tornado crossed Walnut St, with multiple homes and businesses having all or most walls downed. One building in this corridor was compromised by two tossed tractor trailers and another was compromised by a southward facing metal door. A fatality occurred when a mobile home off Sidney Alexander St north of Walnut St was destroyed.
The tornado reached its peak intensity as it approached US Highway 61 just north of Walnut St. Multiple brick homes along Mulberry St were leveled, with debris remaining on the foundations. A discount retail chain store was completely destroyed, with much of the debris swept to the downstream side of the foundation and rowed along the tornado path. Two people died at this location. A gift/floral shop was destroyed, with most debris swept from the foundation. Additional businesses, including a lumber/hardware store, two restaurants, a furniture store, and an insurance agency were also destroyed in this area. One occupant of a truck traveling along US 61 was killed when the tornado tossed his vehicle from the highway to near the lumber/hardware store. A mobile/manufactured home park on the east side of US 61 was devastated, with all 30-35 homes destroyed. Considerable debris from these homes was rowed 300-400 yards downstream along the tornado path into an adjacent field and stand of trees. Six occupants of these homes died in the tornado.
The tornado remained strong to violent as it continued northeast of Rolling Fork across mainly open fields. Through these fields, aerial imagery revealed multiple areas of ground scarring. The tornado crossed Matthews Rd near a catfish farm, where several utility poles were snapped near the ground and covered in 1 to 2 inches of mud. Some of the poles were tossed into nearby ponds. Prolific tree damage occurred along Sandy Bayou, with a few buildings along the outer edges of the path damaged and a tractor trailer flipped. Another area of EF4 damage was observed from Widow Bayou and E River Rd northeastward through Dogwood Rd and Linsey Rd. Through this corridor, extraordinary hardwood tree damage occurred with most trees completely mangled and debarking noted. There was additional evidence of trees or large parts of trees being tossed or dragged a short distance. Several utility poles were snapped, with some tossed a short distance. An outbuilding type structure off Dogwood Rd was blown away, with a school bus from the property tossed into nearby trees. Ground scarring and cycloidal marks were observed in the field between Dogwood Rd and Linsey Rd, along with mulched tree debris which was rowed into a narrow line along the center of the tornado path. Tree damage continued across Keith Rd and Charlie Pitt Rd as the tornado approached MS Highway 14.
East of Anguilla along MS Highway 14, a frame home was completely destroyed. Near the home, several power poles were snapped or broken. Tree damage was extensive with large areas mowed down. A tenth of a mile east, a mobile home was rolled into nearby trees. Moving into Humphreys County, along Prudent Rd, most of the roof was taken off of a home, where the garage collapsed along with a portion of the front porch. One vehicle was flipped and another was moved. A metal workshop was destroyed and structural beams were bent. Along the road, several power poles were snapped and thrown a couple hundred feet into a nearby field. As the tornado approached and crossed Seven Mile Rd, intensity increased. Here, several metal buildings were heavily damaged or destroyed with structural beams bent. Grain bins had sides collapsed and the tops blown off. A small brick home was completely destroyed with all of the exterior walls collapsed. The home next door had a large portion of the roof removed and part of a wall had collapsed. Debris from the home was thrown several hundred feet into a nearby field. Vehicles were moved out of the garage and a large grain storage cart was thrown into the field as well.
For several miles, the tornado traveled along MS Highway 149 moving toward Silver City where large areas of hardwood trees were snapped and uprooted. Multiple center pivot irrigation systems were flipped. A mobile home was completely destroyed when it was rolled into a nearby field. A portion of the roof was blown off a school. A community along the same road had several homes with significant roof damage, and at least one home had decking material partially removed. Several homes and a large metal building were severely damaged when portions of the roof were blown off. A second metal building was completely destroyed with large structural posts bent.
As the tornado came into Silver City from the west along Highway 149, an apartment complex was heavily damaged. Several buildings had sections of the roof removed and one building had portions of the western walls partially collapsed. A fatality occurred in one of the single story apartment buildings. In the nearby neighborhood, numerous homes had roof damage. At least two frame homes were destroyed where one or more exterior walls collapsed. A large number of old hardwood trees were snapped or uprooted. As the storm moved east toward US 49W, more trees were snapped and uprooted. Several homes and a church near the intersection of MS Highway 14 and US 49W had areas of the roof damaged or removed. Four mobile homes were completely destroyed. One person died when a mobile home was tossed into a house, and a child died in one of the mobile homes that was destroyed. Numerous trees were snapped and uprooted, a few of which fell on homes. The rating in the Silver City area ranged from EF1-EF2.
The tornado continued to track east where mostly tree damage occurred. In rural portions of Holmes County northeast of Tchula, there was substantial tree damage with swaths of snapped and uprooted trees. Several center pivot irrigation systems were overturned and grain bins were flipped or destroyed. The tornado continued to move northeast before dissipating in a wooded area north of Randall Road.`,"datetime-end":"2023-03-25T02:08:00Z"},geometry:{type:"LineString",coordinates:[[-90.999299222,32.841397587],[-90.986510449,32.845219483],[-90.969417376,32.856522091],[-90.954993359,32.866687564],[-90.949774058,32.870090032],[-90.93603265,32.875377967],[-90.931188581,32.877582169],[-90.926225153,32.87967932],[-90.91961619,32.883193233],[-90.912923247,32.887848485],[-90.904117738,32.893005574],[-90.896297782,32.895968313],[-90.894070797,32.897195338],[-90.888012872,32.899531214],[-90.885818825,32.900456801],[-90.883847402,32.90133959],[-90.880966709,32.903260526],[-90.877529458,32.90552934],[-90.876266138,32.906747607],[-90.874973469,32.907752588],[-90.87309576,32.908784335],[-90.871969124,32.909372897],[-90.871579645,32.909806242],[-90.871063319,32.910202555],[-90.870076267,32.910771127],[-90.869746355,32.910879212],[-90.867571757,32.912186818],[-90.856970483,32.916876569],[-90.845276051,32.92232529],[-90.823643137,32.932905077],[-90.815109689,32.936253672],[-90.797942719,32.943317207],[-90.784871859,32.949580386],[-90.77468787,32.954222898],[-90.768200111,32.957368951],[-90.76397429,32.958931962],[-90.759563278,32.961019198],[-90.757312905,32.961914886],[-90.749092471,32.96594013],[-90.747568977,32.966772758],[-90.745747757,32.967362344],[-90.74391849,32.967983431],[-90.741314971,32.96949785],[-90.736966426,32.972105981],[-90.734313721,32.973496594],[-90.732194776,32.974671173],[-90.723071612,32.979560581],[-90.721334882,32.980655205],[-90.717736995,32.98303453],[-90.71468023,32.985451737],[-90.711727506,32.987149541],[-90.704000061,32.99123849],[-90.696481225,32.994775019],[-90.69067047,32.996897329],[-90.684378578,33.000934312],[-90.675798394,33.005535963],[-90.665839443,33.010637381],[-90.640767239,33.023213382],[-90.630510471,33.029698965],[-90.622978828,33.03280216],[-90.601177833,33.045150898],[-90.578818939,33.055744428],[-90.570858143,33.059521101],[-90.563069008,33.06293795],[-90.554056785,33.066552473],[-90.551215417,33.067941383],[-90.549779765,33.068616831],[-90.549043498,33.068953992],[-90.548679388,33.06913381],[-90.54826901,33.069319247],[-90.542734272,33.072024337],[-90.53745896,33.074867263],[-90.534530995,33.076773223],[-90.530308757,33.07954478],[-90.52811005,33.08065654],[-90.526335169,33.081528554],[-90.522558619,33.083429842],[-90.518095423,33.085827742],[-90.515690831,33.087184679],[-90.513192047,33.088430386],[-90.511078466,33.089540512],[-90.508704252,33.090592523],[-90.506446291,33.091744991],[-90.504212011,33.092850581],[-90.493095539,33.101880659],[-90.456317089,33.120195386],[-90.422092102,33.138506294],[-90.380974942,33.158161784],[-90.360718899,33.167358659],[-90.323167973,33.181134205],[-90.28909319,33.197331619],[-90.277634793,33.201981985],[-90.232831173,33.217062557],[-90.223561459,33.219503928],[-90.184594326,33.235586558],[-90.172921353,33.239750328],[-90.113698178,33.263293436],[-90.112582379,33.263580508]]}},{type:"Feature",properties:{"datetime-start":"2023-03-25T01:19:00Z","f-scale":"1",scale:"EF",source:[{"NWS Storm Survey":null}],id:"RV2372023USA",countries:["US"],fatalities:0,"path-width":70,"path-length":.26,wind:95,injuries:0,states:["TN"],comments:"A short-lived tornado touched down near Jim Hardister Road in southeast Haywood County on the evening of Friday, March 24, 2023. This tornado primarily uprooted and/or snapped trees, but roof damage was noted to a house, barn, and outbuilding. The tornado continued to a manufactured home, shifting it off the block piers. The last sign of tornado damage occurred just to the northeast at another residence where numerous trees were uprooted and/or snapped, including one that fell onto the residence and caused significant roof damage. The tornado likely lifted up in a field shortly after. Peak winds were estimated at 95 mph.","datetime-end":"2023-03-25T01:20:00Z"},geometry:{type:"LineString",coordinates:[[-89.197633217,35.424771927],[-89.193459699,35.42629314]]}},{type:"Feature",properties:{"datetime-start":"2023-03-25T01:25:00Z","f-scale":"1",scale:"EF",source:[{"NWS Storm Survey":null}],id:"RV2382023USA",countries:["US"],fatalities:0,"path-width":100,"path-length":8.39,wind:95,injuries:0,states:["MS"],comments:"The tornado developed along Three Wheeler Road in extreme southern Panola County. This tornado caused intermittent tree damage as it moved northeast across Cole Road and Crowder Pope Road. Additional tree damage was noted along Gleaton Road and Main Street on the southwest side of Pope. A structure sustained minor roof damage in this area. Numerous trees were uprooted across eastern Pope with one large tree falling on a home and causing structural damage. The tornado continued to move northeast across Green Road, causing damage to trees and an outbuilding near Interstate 55 and Hentz Road. This tornado lifted shortly after crossing the Interstate. Peak winds were estimated at 95 mph.","datetime-end":"2023-03-25T01:34:00Z"},geometry:{type:"LineString",coordinates:[[-90.045831144,34.162451765],[-90.022013128,34.170938288],[-89.997478597,34.18378533],[-89.975574378,34.1957911],[-89.92356098,34.228725157]]}},{type:"Feature",properties:{"datetime-start":"2023-03-25T01:38:00Z","f-scale":"1",scale:"EF",source:[{"NWS Storm Survey":null}],id:"RV2392023USA",countries:["US"],fatalities:0,"path-width":150,"path-length":6.18,wind:110,injuries:0,states:["MS"],comments:"The tornado formed near the intersection of Eureka Road and Crouch Road, moving northeast and affecting the areas along Holmes Road and Henderson Road. Numerous trees were snapped or uprooted along this path with minor roof damage observed and a few snapped utility poles. This tornado then crossed both Dees Road and Highway 315 where significant tree damage was observed. Minor damage occurred to trees and a few outbuildings along Joiner Road where the tornado finally lifted. Peak winds were estimated at 110 mph.","datetime-end":"2023-03-25T01:44:00Z"},geometry:{type:"LineString",coordinates:[[-89.848241365,34.238136088],[-89.819788492,34.257043943],[-89.814209497,34.259384957],[-89.808973825,34.2622934],[-89.804682291,34.265272676],[-89.80081991,34.268819296],[-89.797644174,34.27286226],[-89.793947161,34.277638742],[-89.789833581,34.282366006],[-89.784984147,34.286798356],[-89.78026346,34.28949311],[-89.77528528,34.291620487],[-89.766101396,34.293251439]]}},{type:"Feature",properties:{"datetime-start":"2023-03-25T01:47:00Z","f-scale":"1",scale:"EF",source:[{"NWS Storm Survey":null}],id:"RV2402023USA",countries:["US"],fatalities:0,"path-width":125,"path-length":3.94,wind:100,injuries:0,states:["MS"],comments:"The tornado produced minor damage near the intersection of Shady Grove Road and Perkins Road in extreme eastern Panola County. It then moved east-northeast into Lafayette County. Peak winds in Panola County were estimated at 85 mph. This tornado moved from Panola County into LaFayette County. The tornado generally followed County Road 317 and caused sporadic, but significant, tree damage from Murphy Ridge Road to County Road 362. Minor structural damage was noted along the path, mainly to barns and outbuildings. Peak winds in LaFayette County were estimated at 100 mph.","datetime-end":"2023-03-25T01:51:00Z"},geometry:{type:"LineString",coordinates:[[-89.730889438,34.321942619],[-89.7223922,34.325132431],[-89.716727375,34.326620968],[-89.705826877,34.327258905],[-89.695870517,34.32818036],[-89.688832401,34.33002324],[-89.680678485,34.333425374],[-89.674155353,34.336685623],[-89.667031406,34.343560081]]}},{type:"Feature",properties:{"datetime-start":"2023-03-25T02:12:00Z","f-scale":"3",scale:"EF",source:[{"NWS Storm Survey":null}],id:"RV2412023USA",countries:["US"],fatalities:3,"path-width":1250,"path-length":29.43,wind:155,injuries:5,states:["MS"],comments:"This long track tornado began just southwest of Black Hawk in a wooded area with widespread tree damage, including snapped and uprooted trees. Satellite imagery indicates major tree damage of EF2 intensity. It continued northeast before crossing Highway 430, CR 235, and Highway 17. In this area, numerous residential structures were damaged, including 2 homes that were destroyed, with both losing outer walls and another with collapsed brick on the exterior with the interior slab exposed. Large farming equipment was also blown over on the side. No injuries were reported in this area. The tornado was strongest just northeast of here at EF3 intensity, around 155mph, where Black Hawk Independent Church, Historic Blackhawk School and parsonage were completely destroyed. Both the school and church had stood for nearly 100 years. The church steeple was gone with the bell thrown out and not seen by the survey team. The slab to the church remained intact with a few exterior walls standing. A nearby well building made of cinder block masonry stood mostly untouched outside of minor damage to the roof and doorway. The tornado then continued to the northeast before crossing Highway 17 where widespread tree damage and some structural damage continued. It then continued northeast, just north of Highway 243, before crossing Highway 218 and Nebo Rd, where widespread tree damage occurred. Some areas beyond this were inaccessible due to fallen trees. Satellite imagery indicates potential EF2 to EF3 tree damage in the nearby wooded area. The tornado crossed CR 144, CR 163, CR 211, Good Hope Rd and Spring Lake Rd between Burkhead Lake, Spring Lake and Water Lake. In this area, the tornado was an estimated one half to three quarters of a mile wide and caused EF2 to EF3 tree damage to the forested areas. Some damage was noted to structures along these inaccessible areas. It then crossed Enon Rd, where damage was noted to a home, and Highway 35, where widespread tree damage, major roof, and minor siding damage occurred to a mobile home. One mobile home just north of Highway 35 was thrown off the blocks and into a nearby wooded area some 50 yards away. In this location, 3 fatalities occurred. An 18 wheeler tractor trailer was also blown over on the side. Just to the northeast, satellite imagery indicates a structure had major damage, with the majority of it destroyed. The tornado then crossed CR 278 and CR 61, with minor tree damage, but the majority of the more intense tree damage as viewed within satellite imagery occurred in inaccessible areas just to the north. It then crossed Gum Branch Rd before crossing Interstate 55, where ground surveys and satellite imagery indicated the tornado was nearly a half mile wide. The tornado then crossed Highway 51, Stafford Wells Rd and Highway 407, where major roof damage occurred to residential homes consistent with EF2 intensity. The tornado then crossed Highway 82, where numerous power lines were downed, causing high end EF1 to low end EF2 damage. The tornado then crossed the intersection of Bethlehem Community Rd and Bethlehem Church Rd, where EF2 damage occurred. Three outbuildings were destroyed. A home had major roof damage, and another structure moved off the foundation. The tornado then crossed Hammond Rd, causing major tree damage in the wooded areas. The tornado then caused low end EF2 damage just south of Robinson-Thompson Rd, where an outbuilding was destroyed and a nearby 100 year old home had minor to moderate roof and siding damage but was left standing. The tornado lifted as it crossed Robinson-Thompson Rd.","datetime-end":"2023-03-25T02:42:00Z"},geometry:{type:"LineString",coordinates:[[-90.041791607,33.312330212],[-90.03870706599997,33.31299817500002],[-90.03802956099997,33.313657283],[-90.036835163,33.315055392],[-90.034882515,33.316496615],[-90.031979185,33.318231596],[-90.031461519,33.31902951],[-90.030778735,33.320117934],[-90.028981655,33.321104097],[-90.024378985,33.322939676],[-90.023050027,33.323471799],[-90.020898895,33.324436633],[-90.019188987,33.325470932],[-90.015664564,33.327089031],[-90.006921323,33.332255184],[-90.00620115,33.332697777],[-90.005366983,33.333215999],[-90.004300134,33.333967276],[-90.00391859,33.334243471],[-90.003484072,33.334504539],[-90.003331857,33.334622188],[-90.003196405,33.334709584],[-90.002938913,33.334861406],[-90.002695502,33.335030034],[-90.001367138,33.335651324],[-90.000544371,33.336012107],[-89.99971825,33.336421068],[-89.998291315,33.337076521],[-89.997190268,33.337604241],[-89.99656062,33.337964455],[-89.995825695,33.338373967],[-89.994473861,33.33882101],[-89.994048061,33.339113996],[-89.992350893,33.340162125],[-89.989990549,33.341751942],[-89.989281105,33.342129506],[-89.988901572,33.342395031],[-89.988552885,33.342625825],[-89.98812239,33.342834211],[-89.987796502,33.343057162],[-89.987469272,33.343236418],[-89.987014638,33.343458246],[-89.985709743,33.344088999],[-89.983864384,33.344961738],[-89.982377099,33.345906169],[-89.981392728,33.346513377],[-89.980570631,33.347055604],[-89.980004685,33.347485798],[-89.979338156,33.347923832],[-89.978353785,33.348660979],[-89.976674722,33.349791333],[-89.976169126,33.350173343],[-89.975526737,33.3506853],[-89.97338097,33.351619586],[-89.971732752,33.352605393],[-89.970182435,33.353594549],[-89.968220399,33.35434397],[-89.967047392,33.354725016],[-89.966256141,33.35491601],[-89.965790107,33.355066677],[-89.9654783,33.355234706],[-89.964649497,33.355823366],[-89.963264136,33.356639979],[-89.962792068,33.356846091],[-89.962128564,33.357117239],[-89.9616632,33.357350234],[-89.961204543,33.357572027],[-89.960223852,33.35804803],[-89.958489804,33.358790692],[-89.956790625,33.359656562],[-89.952423989,33.361744474],[-89.946086359,33.364463254],[-89.944328842,33.365256264],[-89.94334313,33.36572613],[-89.942749021,33.365987104],[-89.941176576,33.366762739],[-89.939103533,33.367766556],[-89.9375509,33.368473593],[-89.93620943,33.369121786],[-89.935023893,33.369695232],[-89.933881272,33.370333635],[-89.932215357,33.370941344],[-89.930815244,33.371443099],[-89.9297665,33.371716375],[-89.928562188,33.372068049],[-89.927903706,33.372327883],[-89.927337048,33.372633824],[-89.926533056,33.373186527],[-89.925569472,33.373878102],[-89.924434898,33.37439944],[-89.922953648,33.375250036],[-89.921516651,33.375884105],[-89.920927906,33.376162966],[-89.920477295,33.376369032],[-89.919785285,33.376643413],[-89.918685403,33.377113432],[-89.912906099,33.379459472],[-89.910379997,33.380765179],[-89.908751972,33.381452172],[-89.90808142,33.381741095],[-89.907507427,33.382146481],[-89.906359442,33.382619055],[-89.905899443,33.382813908],[-89.90540994,33.383018838],[-89.904920437,33.38321033],[-89.901898313,33.384592864],[-89.899911408,33.385165434],[-89.89330903,33.387291233],[-89.883079458,33.391661004],[-89.882190306,33.392071942],[-89.881151892,33.392548942],[-89.879726298,33.393205092],[-89.878272748,33.393886947],[-89.877544529,33.394295635],[-89.873621236,33.395725274],[-89.869825275,33.3972283],[-89.867839367,33.398174627],[-89.86607244,33.398846889],[-89.863093177,33.399716411],[-89.861563918,33.400264151],[-89.860587594,33.400569805],[-89.859694428,33.400934918],[-89.85936988,33.401067032],[-89.85901717,33.401265201],[-89.857566061,33.402068772],[-89.856694343,33.402448313],[-89.854284598,33.403575948],[-89.85354565,33.403977874],[-89.852515346,33.40452478],[-89.852291046,33.404686557],[-89.851912184,33.404913547],[-89.851219504,33.405290276],[-89.850558339,33.405611027],[-89.849613531,33.405920581],[-89.848379715,33.406429411],[-89.845901354,33.407040675],[-89.844254478,33.407514234],[-89.842608942,33.408488212],[-89.841348304,33.409162154],[-89.840713962,33.409509198],[-89.839105977,33.410018567],[-89.838576912,33.410300118],[-89.837873502,33.410550883],[-89.836989044,33.411033938],[-89.836482777,33.411594234],[-89.835713654,33.41229194],[-89.835298247,33.41249848],[-89.834980069,33.412651566],[-89.834485872,33.412850269],[-89.83387567,33.413069681],[-89.833040162,33.413343386],[-89.832145645,33.413720639],[-89.831117018,33.414030724],[-89.829828217,33.414358718],[-89.828847869,33.41465089],[-89.827880262,33.41494418],[-89.826683326,33.415421613],[-89.826135485,33.415602959],[-89.825930967,33.415667885],[-89.825701638,33.415738409],[-89.824953302,33.416017702],[-89.824217035,33.416243823],[-89.823564588,33.416558376],[-89.822727068,33.416867891],[-89.821969344,33.417106883],[-89.820591359,33.417529455],[-89.819515793,33.417912286],[-89.818459674,33.418220677],[-89.817919879,33.418332055],[-89.817076324,33.418539141],[-89.816469475,33.418700331],[-89.815666153,33.418955549],[-89.814760237,33.41907924],[-89.814164116,33.419296957],[-89.813319891,33.419461504],[-89.812479689,33.419669706],[-89.810021444,33.420853427],[-89.807480051,33.422468633],[-89.801769628,33.424735244],[-89.79758437,33.426753411],[-89.796877608,33.427125569],[-89.796469242,33.427316964],[-89.793732718,33.428413278],[-89.792280302,33.42909434],[-89.791405901,33.429412205],[-89.790135875,33.429984134],[-89.788625792,33.430726741],[-89.787267923,33.431756979],[-89.785517112,33.432580713],[-89.784108281,33.433184518],[-89.783458516,33.43341675],[-89.782820821,33.433709976],[-89.782010123,33.434091058],[-89.7806945,33.43468422],[-89.778651327,33.435838078],[-89.776852235,33.436769211],[-89.77578941,33.437303041],[-89.773683205,33.438195549],[-89.772322655,33.438723775],[-89.769084558,33.439408673],[-89.766801328,33.44038565],[-89.765816957,33.440710188],[-89.764734686,33.440902112],[-89.763840839,33.441319532],[-89.76082752999997,33.443276072],[-89.75812922799997,33.444549553],[-89.75672643299998,33.44561040000002],[-89.755275358,33.44665333],[-89.75327711199998,33.44722626499998],[-89.75096773000001,33.44788647799999],[-89.748958755,33.44879510200002],[-89.74716167499997,33.449310954],[-89.74544774399999,33.45084394700001],[-89.74324565,33.452562656],[-89.74057417,33.45318926099998],[-89.732732506,33.458144376],[-89.72612622600002,33.461186526],[-89.72027901000001,33.46337157200003],[-89.717639716,33.46493648],[-89.71582520200002,33.465963514],[-89.71230882600003,33.46742013800002],[-89.71071559400002,33.467950423],[-89.706861259,33.46978737799998],[-89.704645755,33.47092175],[-89.69873722900002,33.47409627500002],[-89.69336476500001,33.476633365],[-89.68976523999999,33.477890695999974],[-89.68636688100003,33.47967710299997],[-89.68339767600003,33.480917611],[-89.666089381,33.48688611900002],[-89.66335084600001,33.487458788000026],[-89.64889118299999,33.492477205],[-89.64427216000001,33.492841665000014],[-89.64319391200002,33.49312350600002],[-89.64208616000002,33.49337626800002],[-89.63989747699998,33.49404284000002],[-89.633873236,33.49652566399999],[-89.62884677599999,33.49787664799999],[-89.608672469,33.503956395],[-89.600228875,33.506738623],[-89.592846392,33.509826655]]}},{type:"Feature",properties:{"datetime-start":"2023-03-25T02:38:00Z","f-scale":"1",scale:"EF",source:[{"NWS Storm Survey":null}],id:"RV2422023USA",countries:["US"],fatalities:0,"path-width":125,"path-length":.73,wind:90,injuries:1,states:["MS"],comments:"The short-lived tornado initially touched down just southwest of County Road 222. Numerous trees were snapped and uprooted at the beginning of the path. The tornado traveled northeast and damaged an outbuilding and patio at a residence. Numerous trees were uprooted on the same property. This tornado traveled up County Road 180 causing minor roof damage to several homes. The tornado lifted just north of the intersection of County Roads 180 and 222. A lone injury occurred in the same area as a tree fell on a moving vehicle with a male passenger inside. Peak winds were estimated at 90 mph.","datetime-end":"2023-03-25T02:39:00Z"},geometry:{type:"LineString",coordinates:[[-88.870617709,34.472118319],[-88.858343921,34.475090142]]}},{type:"Feature",properties:{"datetime-start":"2023-03-25T02:45:00Z","f-scale":"1",scale:"EF",source:[{"NWS Storm Survey":null}],id:"RV2432023USA",countries:["US"],fatalities:0,"path-width":250,"path-length":14.66,wind:100,injuries:0,states:["MS"],comments:"The tornado initially touched down just east of the Lee and Union County border at the intersection of County Roads 251 and 2250. A house sustained minor roof damage and had its carport destroyed. The majority of the track was highlighted by snapped and/or uprooted trees, outbuilding damage, and minor roof damage to several homes. The most significant damage occurred near the railroad tracks on Main Street in Guntown, where two large sheds were destroyed and an adjacent house had its wall shifted. The tornado then tracked northeastward to the north side of Five County Sportsman Lake where several trees were damaged. Intermittent damage continued into the northeast portion of the county before dissipating near the Prentiss and Lee County line. Peak winds were estimated at 100 mph.","datetime-end":"2023-03-25T02:57:00Z"},geometry:{type:"LineString",coordinates:[[-88.786215183,34.402063837],[-88.543485996,34.471153953]]}},{type:"Feature",properties:{"datetime-start":"2023-03-25T03:38:00Z","f-scale":"3",scale:"EF",source:[{"NWS Storm Survey":null}],id:"RV2442023USA",countries:["US"],fatalities:2,"path-width":1600,"path-length":36.56,wind:155,injuries:55,states:["MS"],comments:"The tornado began near County Roads 173 and 182 southwest of Egypt in far eastern Chickasaw County. It traveled northeast across County Road 179, causing numerous snapped and uprooted trees. This tornado moved into Monroe County as it crossed Highway 45 near the intersection of Old Houston Road. Peak winds were estimated at 95 mph in Chickasaw County. This tornado crossed into Monroe County from Chickasaw County near the Highway 45 and Old Houston Road intersection, rapidly intensifying as it approached Egypt and Tumblin Roads. Several structures sustained significant damage, including the total destruction of a couple of single-wide, manufactured homes. Numerous trees and utility poles were heavily damaged in the area and roof damage was noted on several homes. Several injuries were reported in this area. The tornado continued to move northeast, crossing White Rock Road and causing widespread, significant tree damage, and roof damage to several homes in the path. The tornado strengthened further as it approached McAllister Road. Several homes in the area of McAllister and Herndon Roads suffered significant damage with missing roofs and collapsed walls. A single-wide, manufactured home on Herndon Road was separated from its frame and completely destroyed, resulting in 2 fatalities and multiple significant injuries. Tree damage was severe with many hardwood trees snapped or uprooted. Additional home and widespread, significant tree damage was observed along Whatley Road near the intersection with Highway 45 East south of New Wren. The tornado was nearly one mile wide at this point. One manufactured home was destroyed with debris blown 200 yards down to the highway. A church was destroyed and several homes suffered significant damage. Several homes sustained severe damage along Little Coontail Road, including the complete destruction of multiple manufactured homes. A boat was tossed more than 50 yards and an SUV was thrown into a tree. Some of this damage along Highway 45 East and Little Coontail Road was rated EF3. Farther east along Coontail Road, damage to homes was less significant and was generally confined to minor roof damage. However, severe tree damage continued. The tornado then moved into more wooded, wetland areas, crossing Highway 278 where it intersects with the Tennessee Tombigbee Waterway. Widespread, significant damage to homes and trees was observed all throughout the northern half of Amory. Several locations in Amory sustained damage rated as EF3. The tornado continued to cause damage to trees and homes as it moved across the Amory Golf Course, then affecting Myrtle and Elliott Roads. A few homes suffered significant roof damage to the south of Smithville near Parham Store Road and Williams Young Road and widespread tree damage continued. The tornado path began to narrow as the storm moved into northern Monroe County with tree damage found along Highway 23 and State Line Road. Peak winds were estimated at 155 mph in Monroe County. A tornado crossed from northern Monroe County into southern Itawamba County. Tree damage became more intermittent as the tornado moved into southern Itawamba County with additional trees down across State Line Road. The tornado finally lifted as it approached Wilson Road. Peak winds were estimated at 90 mph in Itawamba County.","datetime-end":"2023-03-25T04:09:00Z"},geometry:{type:"LineString",coordinates:[[-88.757587272,33.852736471],[-88.747459251,33.854375895],[-88.740335304,33.85644295],[-88.73106559,33.86178855],[-88.722053367,33.867917759],[-88.693385918,33.892572691],[-88.660426933,33.918217657],[-88.632961113,33.931891817],[-88.596568901,33.942715637],[-88.568416435,33.953538081],[-88.526531059,33.976317675],[-88.489452202,33.993967663],[-88.453746635,34.012752333],[-88.392635185,34.044619838],[-88.376842339,34.05770481],[-88.355556328,34.072494086],[-88.306804497,34.089555427],[-88.214107353,34.129351852]]}},{type:"Feature",properties:{"datetime-start":"2023-03-25T03:54:00Z","f-scale":"2",scale:"EF",source:[{"NWS Storm Survey":null}],id:"RV2452023USA",countries:["US"],fatalities:0,"path-width":300,"path-length":3.82,wind:120,injuries:0,states:["AL"],comments:"The tornado touched down near the intersection of Sweetwater Avenue and Huntsville Road in southeast Florence. The tornado nearly paralleled Sweetwater Creek as it tracked northward. Along Sweetwater Creek and Sweetwater Avenue, numerous trees were uprooted and snapped and structures and small outbuildings were damaged. There was also minor room damage to a single family home. As the tornado crossed Highway 43, more trees and minor structure damage was observed near Mall Road and north of Hough Road. The tornado approached Hunter Ridge subdivision northeast of Florence and south of Saint Florian along County Road 61, removing part of a roof at the back of the neighborhood. The tornado then moved northeast into the Plantation Springs subdivision, damaging roofs to two homes on the southeastern corner of Plantation Springs Drive around the Blackberry Trail Golf Course. The tornado then strengthened to its strongest and widest point between Cottonwood Trail and Karley Lane, producing the most widespread structure damage along its path here. About half of the roofs of several homes were destroyed, and the backside of the homes sustained severe damage as the tornado moved through the area. At this point, the tornado was about 100 yards wide, and produced peak winds of 120 mph at this location. The last house on the northeast corner of Plantation Springs Drive sustained the worst damage near the golf course, with more than half the roof destroyed and two rooms with walls collapsed at this location. The tornado lifted shortly after this point.","datetime-end":"2023-03-25T04:02:00Z"},geometry:{type:"LineString",coordinates:[[-87.655273046,34.808577414],[-87.655219117,34.810369437],[-87.654489557,34.811408877],[-87.652622739,34.813258695],[-87.65206484,34.814474267],[-87.6510888,34.819006679],[-87.640692273,34.830327912],[-87.627721395,34.851078963],[-87.624760237,34.854547868],[-87.622614469,34.855974127]]}},{type:"Feature",properties:{"datetime-start":"2023-03-25T04:14:00Z","f-scale":"1",scale:"EF",source:[{"NWS Storm Survey":null}],id:"RV2462023USA",countries:["US"],fatalities:0,"path-width":120,"path-length":4.07,wind:95,injuries:0,states:["AL"],comments:"A National Weather Service and Lauderdale County Emergency Management Agency damage assessment team surveyed damage consistent with an EF-1 tornado near Anderson. Peak winds were estimated at 97 mph. The main damage indicators for this assessment were from uprooted or snapped trees and minor structural damage, mainly to roofs. The tornado touched down off County Road (CR) 49, near the West Fork of Anderson Creek and tracked east-northeast along Highway 64. Along Highway 64, between CR 508 and CR 93, numerous trees were uprooted with a couple of snapped trees that fell on at least one home. Near CR 508, one home sustained roof damage with greater than 20% loss of roofing materials. Additionally, a small garage was completely destroyed when the garage door caved in. The tornado began tracking more northeast as it passed CR 93. More trees were uprooted and sporadic limb damage was noted through CR 207 as the tornado lifted.","datetime-end":"2023-03-25T04:18:00Z"},geometry:{type:"LineString",coordinates:[[-87.290362263,34.968497611],[-87.284525776,34.971592312],[-87.276972676,34.974757226],[-87.262724782,34.974757226],[-87.244442845,34.978343981],[-87.224358464,34.987978211]]}},{type:"Feature",properties:{"datetime-start":"2023-03-25T04:44:00Z","f-scale":"1",scale:"EF",source:[{"NWS Storm Survey":null}],id:"RV2472023USA",countries:["US"],fatalities:0,"path-width":275,"path-length":5.19,wind:110,injuries:0,states:["AL"],comments:"National Weather Service meteorologists surveyed damage in northeast Marion County and determined that it was consistent with an EF1 tornado, with maximum winds near 110 mph. The tornado touched down along the Horseshoe Bend area of Bear Creek. The tornado tracked eastward where it produced its most significant damage along Highway 172 and Highway 241, where numerous pine trees were snapped. Additional trees were uprooted as the tornado approached Highway 13, where it also caused damage to a house and barn on County Road 65. The tornado dissipated along the banks of the Upper Bear Creek Reservoir.","datetime-end":"2023-03-25T04:49:00Z"},geometry:{type:"LineString",coordinates:[[-87.765998017,34.278358837],[-87.761482057,34.279357681],[-87.75659151,34.28006411],[-87.75364108,34.280445311],[-87.750765752,34.280826511],[-87.743598889,34.281101329],[-87.736013602,34.282714756],[-87.725239129,34.286242412],[-87.705602925,34.286990692],[-87.676623249,34.287051222]]}},{type:"Feature",properties:{"datetime-start":"2023-03-25T04:59:00Z","f-scale":"2",scale:"EF",source:[{"NWS Storm Survey":null}],id:"RV2482023USA",countries:["US"],fatalities:0,"path-width":300,"path-length":3.96,wind:120,injuries:0,states:["TN"],comments:"The tornado formed on Amana Avenue with minor roof and shingle damage to single family homes. It tracked due east into the Fairgrounds where it uplifted reinforced roofing to horse stalls, and destroyed a large outdoor shed approximately 80 ft. by 30 ft. that had several 4x4 support beams anchored with concrete snapped near the base. The tornado then rolled a large horse trailer next to the building approximately 80 yards. It continued to snap trees and power lines heading east. As it approached Hedgemont Avenue, several residential and commercial structures had roofing and siding damage. The tornado crossed Main Avenue South and snapped several bradford pear trees, then crossed Highway 231. At the Lincoln Medical Center, power poles were snapped, debris collided with the front of the building, several cars were lifted and had their windows blown out, and an exterior wall was disconnected but not collapsed. The HVAC system was also toppled on the roof. After damaging Lincoln Medical Center, the tornado went through open fields and wooded areas where numerous trees were snapped and uprooted. Before lifting, an awning that was reinforced with 4x4s in concrete was flipped. Just west of Winchester Highway, the tornado lifted.","datetime-end":"2023-03-25T05:05:00Z"},geometry:{type:"LineString",coordinates:[[-86.589845416,35.135001953],[-86.579288241,35.145424826],[-86.571106568,35.148499874],[-86.563939705,35.149973652],[-86.555270806,35.149482395],[-86.54205288,35.151587759],[-86.528792038,35.148991136],[-86.519608155,35.150675442],[-86.511454239,35.149728024]]}},{type:"Feature",properties:{"datetime-start":"2023-03-25T05:00:00Z","f-scale":"1",scale:"EF",source:[{"Park/Forest Service":null}],id:"RV2492023USA",countries:["US"],fatalities:0,"path-width":130,"path-length":2.76,wind:95,injuries:0,states:["AL"],comments:"An official from the Bankhead National Forest reported tornado damage to the National Weather Service (NWS) in a remote area. After reviewing high resolution satellite data through the United States Geological Survey (USGS), the NWS has determined an EF-1 tornado occurred. Damage indicators were mostly noted as hard wood tree uproots. Satellite imagery showed large swath of trees uprooted as evidenced by Worldview (35 cm) imagery. Tree fall patterns indicates convergence and falls partly perpendicular to storm track. Based on this information, the tornado touched down near Northwest Road and Thompson Creek and lifted near Braziel Creek.","datetime-end":"2023-03-25T05:06:00Z"},geometry:{type:"LineString",coordinates:[[-87.472984192,34.339989262],[-87.458221313,34.339705778],[-87.453243134,34.341123187],[-87.445775864,34.342398835],[-87.43539035,34.343957933],[-87.42534816,34.344524871]]}},{type:"Feature",properties:{"datetime-start":"2023-03-25T05:23:00Z","f-scale":"2",scale:"EF",source:[{"NWS Storm Survey":null}],id:"RV2502023USA",countries:["US"],fatalities:1,"path-width":175,"path-length":13.53,wind:115,injuries:0,states:["AL"],comments:"The tornado likely first touched down between County Road 203 and Highway 157 in far eastern Lawrence County. Minor roof damage to chicken houses was noted at this location before the tornado crossed the highway. Sporadic tree damage was observed near the Highway 36 and CR 200 intersection. Peak wind speeds of 74 mph were estimated. The tornado then moved into Morgan County toward Danville. A tornado tracked out of far east central Lawrence County into Morgan County. Minor damage was noted around Danville High School with the football scoreboard partially destroyed. The tornado intensified as it tracked east-northeast toward Targum Road. Uprooted trees, minor damage to a home, and a destroyed carport were observed. Tracking east, the tornado uprooted and snapped a significant number of trees along Iron Man Road and Forest Chapel Road. While there was heavy structural damage to single-family homes, the bulk of the damage was due to trees falling on houses. The tornado remained on the ground uprooting trees and tracking toward Vaughn Bridge Road. Near the Vaughn Bridge and Vest Road intersection, the tornado lifted and snapped the anchoring system of a single-wide mobile home. This caused the unit to overturn and roll, destroying the home. One fatality was reported at this location. Given the degree of damage, and strapping of anchors to the I-beam, the damage indicator held consistent with expected wind speed values. As the tornado tracked east, numerous trees were uprooted causing structural damage along Highway 31 and further east on Sparkman Street and through Bethel Road. The tornado likely lifted before the Bethel Road and I-65 intersection.","datetime-end":"2023-03-25T05:29:00Z"},geometry:{type:"LineString",coordinates:[[-87.134841827,34.401569149],[-87.117074874,34.407340677],[-87.093342689,34.41555468],[-87.065018561,34.423413876],[-87.038711455,34.428051162],[-87.017637339,34.439121202],[-87.011757937,34.441173998],[-87.008067218,34.443757618],[-87.005470839,34.444819356],[-87.002295104,34.444235401],[-86.999674585,34.444421206],[-86.975641993,34.45149915],[-86.965235022,34.457107995],[-86.962190715,34.456957605],[-86.961182204,34.457205306],[-86.960881797,34.457576856],[-86.960002032,34.458001483],[-86.958263961,34.458549956],[-86.950925437,34.458585341],[-86.944187728,34.458939192],[-86.927236167,34.46024843],[-86.91390827,34.464697914]]}},{type:"Feature",properties:{"datetime-start":"2023-03-25T05:24:00Z","f-scale":"1",scale:"EF",source:[{"NWS Storm Survey":null}],id:"RV2512023USA",countries:["US"],fatalities:0,"path-width":240,"path-length":15.26,wind:90,injuries:0,states:["TN"],comments:`A National Weather Service and Franklin County Emergency Management Agency damage assessment determined the sporadic damage in northern Franklin County was caused by an EF-1 tornado with a peak wind speed of 88 mph.
The tornado touched down west of Estill Springs near the Harris Chapel and Eastbrook Drive area. Here, several uprooted trees or downed large branches were observed. Minor structural damage to a single family home roof was noted too. The tornado tracked east, likely lifting at times, across Tims Ford Lake. Tree damage and minor roof damage to small farm buildings occurred along Cobb Road and adjacent to Peabody Road. As the tornado tracked east, again ascending at times, toward the Highway 64 and Old Alto Highway corridor, more tree uproots were noted. Softwood tree snaps were observed near the Highway 64 and Yellow Branch Road area, which prompted the EF-1 rating. Only minor limb damage was observed further east on Highway 64 heading toward the county line.`,"datetime-end":"2023-03-25T05:39:00Z"},geometry:{type:"LineString",coordinates:[[-86.170792212,35.225809452],[-86.16306745,35.229315067],[-86.160320868,35.231137927],[-86.153969397,35.234783524],[-86.148476233,35.236466052],[-86.144699682,35.238008339],[-86.140236486,35.239410392],[-86.136288275,35.241092824],[-86.132340063,35.242354625],[-86.123585333,35.245999718],[-86.115860571,35.247121252],[-86.085991491,35.249504461],[-86.067452063,35.24992502],[-86.027111639,35.253850131],[-85.989174475,35.266465273],[-85.973896612,35.269408524],[-85.966000189,35.271650929],[-85.912467898,35.280250814]]}},{type:"Feature",properties:{"datetime-start":"2023-03-25T05:33:00Z","f-scale":"2",scale:"EF",source:[{"NWS Storm Survey":null}],id:"RV2522023USA",countries:["US"],fatalities:0,"path-width":125,"path-length":4.94,wind:120,injuries:0,states:["AL"],comments:`A tornado touched down on Highway 55 in Falkville and tracked generally northeastward. Initially, the tornado snapped trees and a small power pole in a yard on Highway 55. Farther to the northeast, the tornado did considerable roof damage to a barn at a residence on Chappell Road, and uprooted trees near the intersection of Chappell Road and Bert Stinson Road. The tornado then tracked along a largely wooded area, before snapping and uprooting trees on Nature Trail. There, the tornado also created roof damage to a small log cabin style home.
Farther to the northeast, in a heavily wooded area to the north of Nature Trail, the tornado uprooted and snapped a long swath of trees nearly continuously before emerging into an open field, where it continued to snap and uproot trees along its path. In the open field, the tornado completely destroyed a large pole barn that contained 4x4 posts, some of which were anchored into the ground with cement. The walls of the barn were made of exterior metal sheeting with 2x4 wooden studs, which were toe-nailed into the 4x4 posts, and accompanied by a metal truss system. The barn contained 10,500lb hay bales which were blown downstream. A very large, old oak tree was uprooted adjacent to the barn. The width at its base was estimated to be 5 feet.
The tornado continued to track generally to the northeast, snapping and uprooting trees along Wilson Mountain Road, which continued along the northeast adjacent and along Blankenship Narrell Drive. On Cottonwood Lane, trees were uprooted and snapped. One tree fell on an RV at a residence. From there, the tornado moved into a largely inaccessible heavily wooded area.`,"datetime-end":"2023-03-25T05:36:00Z"},geometry:{type:"LineString",coordinates:[[-86.871327833,34.36701716],[-86.79871507,34.405974476]]}},{type:"Feature",properties:{"datetime-start":"2023-03-25T05:47:00Z","f-scale":"1",scale:"EF",source:[{"NWS Storm Survey":null}],id:"RV2532023USA",countries:["US"],fatalities:0,"path-width":325,"path-length":2.09,wind:95,injuries:0,states:["AL"],comments:`A National Weather Service damage survey assessed tornado damage in northeastern Morgan County. Damage was consistent with an EF-1 tornado with a peak wind speed of 94 mph.
Many damage indicators were in the form of uprooted trees and minor structural damage. The tornado touched down near the Highway 32 and Crisco Circle intersection. Tracking east-northeast, numerous trees were uprooted along Rescue Road. Near Rescue Road and Highway 231, an unanchored shed was destroyed. The tornado crossed the highway and uprooted many more trees along Old Silo Road and also damaged the roof to chicken houses. The tornado lifted just west of the Morgan-Marshall County line.`,"datetime-end":"2023-03-25T05:50:00Z"},geometry:{type:"LineString",coordinates:[[-86.600327003,34.47584726],[-86.598267067,34.475776505],[-86.594061363,34.475564237],[-86.590628136,34.475918016],[-86.587538231,34.476059528],[-86.579040993,34.477616137],[-86.576981056,34.478252923],[-86.57620858,34.478323677],[-86.575521934,34.478252923],[-86.572861183,34.478040662],[-86.564192283,34.478960458]]}},{type:"Feature",properties:{"datetime-start":"2023-03-25T06:28:00Z","f-scale":"1",scale:"EF",source:[{"NWS Storm Survey":null}],id:"RV2542023USA",countries:["US"],fatalities:0,"path-width":250,"path-length":8.51,wind:90,injuries:0,states:["AL"],comments:`Aerial surveillance provided by Jackson County Emergency Management Agency (EMA), supplemented by a ground survey of National Weather Service personnel and DeKalb County EMA confirmed an EF-1 tornado near the Flat Rock area.
The tornado touched down southwest of CR 81, north of Flat Rock near Fabius Poultry. Multiple chicken houses sustained roof damage at this location. The tornado tracked east toward CR 81 where numerous softwood trees were uprooted. The final damage point was east of Highway 117 where a possible ground scar was noted. Damage was then reported along and between Highway 71 and CR 326 to the county line. Uprooted trees and minor structure damage was observed in this location. The tornado tracked from Jackson into DeKalb County where it caused minor roof damage to a single-family home and uprooted several trees. As it tracked east to Highway 75, power poles were tilted, and additional trees were uprooted before the tornado lifted just east of Highway 75.`,"datetime-end":"2023-03-25T06:36:00Z"},geometry:{type:"LineString",coordinates:[[-85.739261291,34.785636147],[-85.738681934,34.785636147],[-85.737952373,34.785671393],[-85.737501762,34.785741885],[-85.736943862,34.785865246],[-85.736836574,34.785865246],[-85.736579082,34.785953361],[-85.735849521,34.78600623],[-85.735227249,34.786041475],[-85.734218738,34.786111967],[-85.733746669,34.786111967],[-85.733038566,34.786147213],[-85.732223174,34.786059098],[-85.730120323,34.786076721],[-85.729197643,34.785900492],[-85.72829642,34.785882869],[-85.721515796,34.78519557],[-85.719069621,34.784631629],[-85.718833587,34.784490643],[-85.693225132,34.785388947],[-85.65677284,34.788744312],[-85.643115465,34.794205538],[-85.631442491,34.794628446],[-85.591617052,34.793853114]]}}]},_h=new mh({features:new th().readFeatures(Yg)});var Xe=new ni;_h.getFeatures().forEach(s=>{s.getGeometry().transform("EPSG:4326","EPSG:3857"),s.get("f-scale")=="4"&&(Xe=s)});var zt=Xe.get("datetime-start"),jg=Xe.get("datetime-end"),Pe=Xe.getGeometry().getFirstCoordinate(),Fe=Xe.getGeometry().getLastCoordinate(),Xt=(Date.parse(jg)-Date.parse(zt))/6e4;console.log(Xt);var Zg=(Date.parse("2023-03-25T01:19:00Z")-Date.parse(zt))/6e4,Ug=(Date.parse("2023-03-25T01:27:00Z")-Date.parse(zt))/6e4,Bg=(Date.parse("2023-03-25T01:37:00Z")-Date.parse(zt))/6e4,Kg=(Date.parse("2023-03-25T01:42:00Z")-Date.parse(zt))/6e4,Vg=(Date.parse("2023-03-25T01:48:00Z")-Date.parse(zt))/6e4,Hg=(Date.parse("2023-03-25T01:51:00Z")-Date.parse(zt))/6e4,qg=(Date.parse("2023-03-25T02:05:00Z")-Date.parse(zt))/6e4,Un=Zg/Xt,$g=[(1-Un)*Pe[0]+Un*Fe[0],(1-Un)*Pe[1]+Un*Fe[1]],Bn=Ug/Xt,Jg=[(1-Bn)*Pe[0]+Bn*Fe[0],(1-Bn)*Pe[1]+Bn*Fe[1]],Kn=Bg/Xt,Qg=[(1-Kn)*Pe[0]+Kn*Fe[0],(1-Kn)*Pe[1]+Kn*Fe[1]],Vn=Kg/Xt,e0=[(1-Vn)*Pe[0]+Vn*Fe[0],(1-Vn)*Pe[1]+Vn*Fe[1]],Hn=Vg/Xt,t0=[(1-Hn)*Pe[0]+Hn*Fe[0],(1-Hn)*Pe[1]+Hn*Fe[1]],qn=Hg/Xt,i0=[(1-qn)*Pe[0]+qn*Fe[0],(1-qn)*Pe[1]+qn*Fe[1]],$n=qg/Xt,n0=[(1-$n)*Pe[0]+$n*Fe[0],(1-$n)*Pe[1]+$n*Fe[1]];const s0={type:"FeatureCollection",crs:{type:"name",properties:{name:"EPSG:4326"}},features:[{type:"Feature",properties:{id:"1",occurance:"2023-03-25T01:19:00Z",description:"Beginning of available WTVA Footage."},geometry:{type:"Point",coordinates:Xe.getGeometry().getClosestPoint($g)}},{type:"Feature",properties:{id:"2",occurance:"2023-03-25T01:27:00Z",description:"Focus on EF4 in Rolling Fork. Referred to as Ongoing Threat. Warning of Storm Arrival Time Directed to Winona, Grenada, Eupora, Bruce, MS area."},geometry:{type:"Point",coordinates:Xe.getGeometry().getClosestPoint(Jg)}},{type:"Feature",properties:{id:"3",occurance:"2023-03-25T01:37:00Z",description:"Check on EF4, referred to as 'Near Belzoni', not expected to reach Winona, MS but caution advised. Visible Debris signature over Silver City, MS. Extended time estimates provided."},geometry:{type:"Point",coordinates:Xe.getGeometry().getClosestPoint(Qg)}},{type:"Feature",properties:{id:"4",occurance:"2023-03-25T01:42:00Z",description:"Upgrade from lead warning to tornado emergency. First confirmed injury report from Rolling Fork, MS. Field Meteorologists rerouted to more effective positions."},geometry:{type:"Point",coordinates:Xe.getGeometry().getClosestPoint(e0)}},{type:"Feature",properties:{id:"5",occurance:"2023-03-25T01:48:00Z",description:"Live storm chaser footage, with appropriate disclaimers. Reassessment of EF4 movement speed in line with NWS reports. Was 60mph, may have decreased to 45mph."},geometry:{type:"Point",coordinates:Xe.getGeometry().getClosestPoint(t0)}},{type:"Feature",properties:{id:"6",occurance:"2023-03-25T01:51:00Z",description:"Tornado speed reassessment confirmed. Actual wind speeds closest to 50-55mph. Estimated arrival times adjusted accordingly."},geometry:{type:"Point",coordinates:Xe.getGeometry().getClosestPoint(i0)}},{type:"Feature",properties:{id:"7",occurance:"2023-03-25T02:05:00Z",description:"Wider map zoom. Focus on confirmed damage from Silver City. Emphasis on Tornado Safety Procedures given to Winona and Kilmichael, MS."},geometry:{type:"Point",coordinates:Xe.getGeometry().getClosestPoint(n0)}}]},r0=new xo({source:_h,style:Xg}),o0=new mh({features:new th().readFeatures(s0),style:ks.Point}),ph=new xo({source:o0,style:function(){return ks.Point}}),So=new Dg({element:Wg,autoPan:{animation:{duration:250}}});Xa.onclick=function(){return So.setPosition(void 0),Xa.blur(),To.getFeatures().clear(),!1};const To=new Ro({condition:bl,layers:[ph],style:function(){return ks.Point}});To.on("select",function(s){const e=s.selected[0],t=e.getGeometry().getCoordinates(),i=e.get("id"),n=e.get("occurance"),r=e.get("description");zg.innerHTML="<p><b>Point ID: </b>"+i+"<br><b>Time of Point: </b>"+n+"<br><b>Description: </b>"+r+"</p>",So.setPosition(t)});const Ar=new Vd({layers:[new Nf({source:new Og}),r0,ph],overlays:[So],target:"map",view:new it({center:[0,0],zoom:2})});var a0=[-10299995651937777e-9,383427101815915e-8,-9398015226401512e-9,4202031631136171e-9];Ar.getView().fit(a0,Ar.getSize());Ar.addInteraction(To);
//# sourceMappingURL=index-Cmny0e66.js.map
